äº†è§£äº†ï¼å•é¡Œå¯èƒ½å‡ºåœ¨å¹¾å€‹åœ°æ–¹ï¼Œè®“æˆ‘å¹«ä½  debugï¼š

## å•é¡Œåˆ†æ

### **å¯èƒ½åŸå› 1ï¼šScript åŸ·è¡Œæ™‚æ©Ÿå•é¡Œ**

`window.open()` å¯èƒ½å› ç‚ºç€è¦½å™¨çš„å½ˆå‡ºè¦–çª—å°é–æˆ–åŸ·è¡Œé †åºå•é¡Œæ²’æœ‰æˆåŠŸé–‹å•Ÿã€‚

### **å¯èƒ½åŸå› 2ï¼šå…©å€‹å°å‘åŒæ™‚åŸ·è¡Œ**

`window.open()` é‚„æ²’å®Œæˆï¼Œ`window.location.href` å°±å·²ç¶“åŸ·è¡Œäº†ã€‚

## è§£æ±ºæ–¹æ¡ˆï¼šåŠ å¼·ç‰ˆæ–¹æ¡ˆA

```csharp
// æ¬Šé™ç®¡ç†å°å‘ URL
public ActionResult AP_ACCESS_SYS()
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = "2",
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        if (response_.Result_code == "0000")
        {
            // ğŸ‘‡ æ”¹é€²ç‰ˆï¼šç¢ºä¿æ–°è¦–çª—é–‹å•Ÿå¾Œæ‰è™•ç†ç•¶å‰é é¢
            string script = $@"
            <!DOCTYPE html>
            <html>
            <head>
                <title>å°å‘ä¸­...</title>
            </head>
            <body>
                <div style='text-align:center; padding:50px; font-family:Microsoft JhengHei;'>
                    <h3>æ­£åœ¨é–‹å•Ÿæ¬Šé™ç®¡ç†é é¢...</h3>
                    <p>å¦‚æœæœªè‡ªå‹•é–‹å•Ÿï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨å½ˆå‡ºè¦–çª—è¨­å®š</p>
                </div>
                <script>
                    (function() {{
                        // é–‹å•Ÿæ–°è¦–çª—
                        var newWindow = window.open('{response_.Url}', '_blank');
                        
                        // ç­‰å¾…ä¸€ä¸‹è®“æ–°è¦–çª—é–‹å•Ÿ
                        setTimeout(function() {{
                            // æª¢æŸ¥æ–°è¦–çª—æ˜¯å¦æˆåŠŸé–‹å•Ÿ
                            if (newWindow) {{
                                // æˆåŠŸé–‹å•Ÿï¼Œé—œé–‰ç•¶å‰è¦–çª—æˆ–è¿”å›ä¸Šä¸€é 
                                window.close();
                                // å¦‚æœç„¡æ³•é—œé–‰ï¼ˆä¸æ˜¯ç”± script é–‹å•Ÿçš„è¦–çª—ï¼‰ï¼Œå‰‡è¿”å›ä¸Šä¸€é 
                                setTimeout(function() {{
                                    if (!window.closed) {{
                                        window.history.back();
                                    }}
                                }}, 100);
                            }} else {{
                                // æœªæˆåŠŸé–‹å•Ÿï¼Œé¡¯ç¤ºé€£çµè®“ä½¿ç”¨è€…æ‰‹å‹•é»æ“Š
                                alert('è«‹å…è¨±å½ˆå‡ºè¦–çª—ï¼Œæˆ–é»æ“Šç¢ºå®šå¾Œæ‰‹å‹•é–‹å•Ÿé€£çµ');
                                window.location.href = '{response_.Url}';
                            }}
                        }}, 500);
                    }})();
                </script>
            </body>
            </html>";
            return Content(script, "text/html");
        }
        else
        {
            return Content($@"
            <!DOCTYPE html>
            <html>
            <body>
                <script>
                    alert('å–å¾—æ¬Šé™ç®¡ç†é€£çµå¤±æ•—ï¼š{response_.Msg}');
                    window.history.back();
                </script>
            </body>
            </html>", "text/html");
        }
    }
    catch (Exception ex)
    {
        return Content($@"
        <!DOCTYPE html>
        <html>
        <body>
            <script>
                alert('å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š{ex.Message}');
                window.history.back();
            </script>
        </body>
        </html>", "text/html");
    }
}

// ç³»çµ±é é¢ç®¡ç†å°å‘
public ActionResult AP_ACCESS_SYS_FUNC()
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = "1",
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        if (response_.Result_code == "0000")
        {
            string script = $@"
            <!DOCTYPE html>
            <html>
            <head>
                <title>å°å‘ä¸­...</title>
            </head>
            <body>
                <div style='text-align:center; padding:50px; font-family:Microsoft JhengHei;'>
                    <h3>æ­£åœ¨é–‹å•Ÿé é¢åŠŸèƒ½ç®¡ç†...</h3>
                    <p>å¦‚æœæœªè‡ªå‹•é–‹å•Ÿï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨å½ˆå‡ºè¦–çª—è¨­å®š</p>
                </div>
                <script>
                    (function() {{
                        var newWindow = window.open('{response_.Url}', '_blank');
                        
                        setTimeout(function() {{
                            if (newWindow) {{
                                window.close();
                                setTimeout(function() {{
                                    if (!window.closed) {{
                                        window.history.back();
                                    }}
                                }}, 100);
                            }} else {{
                                alert('è«‹å…è¨±å½ˆå‡ºè¦–çª—ï¼Œæˆ–é»æ“Šç¢ºå®šå¾Œæ‰‹å‹•é–‹å•Ÿé€£çµ');
                                window.location.href = '{response_.Url}';
                            }}
                        }}, 500);
                    }})();
                </script>
            </body>
            </html>";
            return Content(script, "text/html");
        }
        else
        {
            return Content($@"
            <!DOCTYPE html>
            <html>
            <body>
                <script>
                    alert('å–å¾—é é¢åŠŸèƒ½ç®¡ç†é€£çµå¤±æ•—ï¼š{response_.Msg}');
                    window.history.back();
                </script>
            </body>
            </html>", "text/html");
        }
    }
    catch (Exception ex)
    {
        return Content($@"
        <!DOCTYPE html>
        <html>
        <body>
            <script>
                alert('å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š{ex.Message}');
                window.history.back();
            </script>
        </body>
        </html>", "text/html");
    }
}
```

## æ”¹é€²é‡é»

### **1. å®Œæ•´çš„ HTML çµæ§‹**

```html
<!DOCTYPE html>
<html>
<head>...</head>
<body>...</body>
</html>
```

ç¢ºä¿ç€è¦½å™¨æ­£ç¢ºè§£æ scriptã€‚

### **2. åŠ å…¥ä½¿ç”¨è€…æç¤º**

```html
<div style='text-align:center; padding:50px;'>
    <h3>æ­£åœ¨é–‹å•Ÿæ¬Šé™ç®¡ç†é é¢...</h3>
</div>
```

è®“ä½¿ç”¨è€…çŸ¥é“æ­£åœ¨è™•ç†ä¸­ã€‚

### **3. æª¢æŸ¥æ–°è¦–çª—æ˜¯å¦æˆåŠŸé–‹å•Ÿ**

```javascript
var newWindow = window.open('{response_.Url}', '_blank');

if (newWindow) {
    // æˆåŠŸé–‹å•Ÿ
} else {
    // è¢«å°é–ï¼Œé¡¯ç¤º alert ä¸¦ç›´æ¥å°å‘
    alert('è«‹å…è¨±å½ˆå‡ºè¦–çª—...');
    window.location.href = '{response_.Url}';
}
```

### **4. å»¶é²è™•ç†**

```javascript
setTimeout(function() {
    // ç¢ºä¿æ–°è¦–çª—é–‹å•Ÿå¾Œå†é—œé–‰ç•¶å‰è¦–çª—
}, 500);
```

## å¦‚æœé‚„æ˜¯ä¸è¡Œï¼Œç”¨é€™å€‹ Debug ç‰ˆæœ¬

```csharp
public ActionResult AP_ACCESS_SYS()
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = "2",
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        // ğŸ‘‡ åŠ å…¥ Debug è³‡è¨Š
        if (response_.Result_code == "0000")
        {
            string script = $@"
            <!DOCTYPE html>
            <html>
            <head>
                <title>å°å‘ä¸­...</title>
            </head>
            <body>
                <div style='text-align:center; padding:50px; font-family:Microsoft JhengHei;'>
                    <h3>æ­£åœ¨é–‹å•Ÿæ¬Šé™ç®¡ç†é é¢...</h3>
                    <p>ç›®æ¨™URLï¼š{response_.Url}</p>
                    <p>Result Codeï¼š{response_.Result_code}</p>
                    <p><a href='{response_.Url}' target='_blank'>å¦‚æœæœªè‡ªå‹•é–‹å•Ÿï¼Œè«‹é»æ­¤æ‰‹å‹•é–‹å•Ÿ</a></p>
                </div>
                <script>
                    console.log('æº–å‚™é–‹å•Ÿæ–°è¦–çª—');
                    console.log('URL:', '{response_.Url}');
                    
                    var newWindow = window.open('{response_.Url}', '_blank');
                    console.log('æ–°è¦–çª—ç‰©ä»¶:', newWindow);
                    
                    setTimeout(function() {{
                        if (newWindow) {{
                            console.log('æ–°è¦–çª—æˆåŠŸé–‹å•Ÿï¼Œæº–å‚™é—œé–‰ç•¶å‰é é¢');
                            window.close();
                            setTimeout(function() {{
                                if (!window.closed) {{
                                    console.log('ç„¡æ³•é—œé–‰ç•¶å‰è¦–çª—ï¼Œè¿”å›ä¸Šä¸€é ');
                                    window.history.back();
                                }}
                            }}, 100);
                        }} else {{
                            console.log('æ–°è¦–çª—è¢«å°é–');
                            alert('è«‹å…è¨±å½ˆå‡ºè¦–çª—ï¼Œæˆ–ä½¿ç”¨ä¸‹æ–¹é€£çµæ‰‹å‹•é–‹å•Ÿ');
                        }}
                    }}, 500);
                </script>
            </body>
            </html>";
            return Content(script, "text/html");
        }
        else
        {
            // é¡¯ç¤ºéŒ¯èª¤è³‡è¨Š
            return Content($@"
            <!DOCTYPE html>
            <html>
            <body>
                <h3>å–å¾—é€£çµå¤±æ•—</h3>
                <p>Result Code: {response_.Result_code}</p>
                <p>è¨Šæ¯: {response_.Msg}</p>
                <p><a href='javascript:history.back()'>è¿”å›ä¸Šä¸€é </a></p>
            </body>
            </html>", "text/html");
        }
    }
    catch (Exception ex)
    {
        return Content($@"
        <!DOCTYPE html>
        <html>
        <body>
            <h3>ç™¼ç”ŸéŒ¯èª¤</h3>
            <p>éŒ¯èª¤è¨Šæ¯: {ex.Message}</p>
            <p>å †ç–Š: {ex.StackTrace}</p>
            <p><a href='javascript:history.back()'>è¿”å›ä¸Šä¸€é </a></p>
        </body>
        </html>", "text/html");
    }
}
```

## æ¸¬è©¦æ­¥é©Ÿ

1. å¾ç›®éŒ„æ¨¹é»æ“Šé€£çµ
1. æª¢æŸ¥ç€è¦½å™¨ Console (F12 é–‹ç™¼è€…å·¥å…·)
1. çœ‹çœ‹æœ‰æ²’æœ‰éŒ¯èª¤è¨Šæ¯
1. ç¢ºèª `response_.Url` çš„å€¼æ˜¯å¦æ­£ç¢º
1. æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦å°é–å½ˆå‡ºè¦–çª—

è©¦è©¦çœ‹é€™å€‹ç‰ˆæœ¬ï¼Œå¦‚æœé‚„æœ‰å•é¡Œï¼Œè«‹å‘Šè¨´æˆ‘ Console ä¸­é¡¯ç¤ºäº†ä»€éº¼è¨Šæ¯ï¼â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹