æˆ‘äº†è§£å•é¡Œäº†ï¼ä½ æƒ³è¦åœ¨**æ–°åˆ†é é–‹å•Ÿ TOKEN URL** çš„åŒæ™‚ï¼Œ**ç•¶å‰é é¢åœç•™åœ¨åŸæœ¬çš„ä½ç½®**ï¼Œè€Œä¸æ˜¯å°å‘åˆ° Main é é¢ã€‚

å•é¡Œåœ¨æ–¼ `window.location.href` æœƒç«‹å³æ”¹è®Šç•¶å‰é é¢ï¼Œå°è‡´ä½¿ç”¨è€…é«”é©—ä¸ä½³ã€‚

## è§£æ±ºæ–¹æ¡ˆ

æœ‰å¹¾ç¨®æ–¹å¼å¯ä»¥è™•ç†ï¼š

### **æ–¹æ¡ˆAï¼šåªé–‹æ–°åˆ†é ï¼Œç•¶å‰é é¢ä¸å‹•ï¼ˆæ¨è–¦ï¼‰**

```csharp
// æ¬Šé™ç®¡ç†å°å‘ URL
public ActionResult AP_ACCESS_SYS()
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = "2",
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        if (response_.Result_code == "0000")
        {
            // ğŸ‘‡ åªé–‹æ–°åˆ†é ï¼Œç•¶å‰é é¢é—œé–‰è‡ªå·±ï¼ˆå›åˆ°ä¸Šä¸€é çš„æ•ˆæœï¼‰
            string script = $@"
            <script>
               window.open('{response_.Url}', '_blank');
               window.close(); // é—œé–‰ç•¶å‰åˆ†é 
               // å¦‚æœç„¡æ³•é—œé–‰ï¼ˆå› ç‚ºä¸æ˜¯ç”± script é–‹å•Ÿçš„ï¼‰ï¼Œå‰‡è¿”å›ä¸Šä¸€é 
               if (!window.closed) {{
                   window.history.back();
               }}
            </script>";
            return Content(script, "text/html");
        }
        else
        {
            return Content($"<script>alert('å–å¾—æ¬Šé™ç®¡ç†é€£çµå¤±æ•—ï¼š{response_.Msg}'); window.history.back();</script>", "text/html");
        }
    }
    catch (Exception ex)
    {
        return Content($"<script>alert('å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š{ex.Message}'); window.history.back();</script>", "text/html");
    }
}

// ç³»çµ±é é¢ç®¡ç†å°å‘
public ActionResult AP_ACCESS_SYS_FUNC()
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = "1",
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        if (response_.Result_code == "0000")
        {
            string script = $@"
            <script>
               window.open('{response_.Url}', '_blank');
               window.close();
               if (!window.closed) {{
                   window.history.back();
               }}
            </script>";
            return Content(script, "text/html");
        }
        else
        {
            return Content($"<script>alert('å–å¾—é é¢åŠŸèƒ½ç®¡ç†é€£çµå¤±æ•—ï¼š{response_.Msg}'); window.history.back();</script>", "text/html");
        }
    }
    catch (Exception ex)
    {
        return Content($"<script>alert('å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š{ex.Message}'); window.history.back();</script>", "text/html");
    }
}
```

### **æ–¹æ¡ˆBï¼šç”¨ AJAX æ–¹å¼å‘¼å«ï¼Œå®Œå…¨ä¸é›¢é–‹ç•¶å‰é é¢**

å¦‚æœä½ æ˜¯å¾ç›®éŒ„æ¨¹é»æ“Šé€²å…¥ï¼Œå¯ä»¥æ”¹ç”¨ AJAXï¼š

**ä¿®æ”¹ Controller å›å‚³ JSONï¼š**

```csharp
// æ¬Šé™ç®¡ç†å°å‘ URL - JSON ç‰ˆæœ¬
[HttpPost]
public JsonResult GetAccessUrl(string type)
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = type, // "1" æˆ– "2"
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        if (response_.Result_code == "0000")
        {
            return Json(new { success = true, url = response_.Url });
        }
        else
        {
            return Json(new { success = false, message = response_.Msg });
        }
    }
    catch (Exception ex)
    {
        return Json(new { success = false, message = ex.Message });
    }
}
```

**å‰ç«¯ JavaScriptï¼ˆåœ¨ç›®éŒ„æ¨¹æˆ–æŒ‰éˆ•é»æ“Šäº‹ä»¶ï¼‰ï¼š**

```javascript
// æ¬Šé™ç®¡ç†
$('#btn-access-sys').click(function() {
    $.ajax({
        url: '@Url.Action("GetAccessUrl", "SYS")',
        type: 'POST',
        data: { type: "2" },
        dataType: 'json',
        success: function(response) {
            if (response.success) {
                window.open(response.url, '_blank');
            } else {
                alert('å–å¾—æ¬Šé™ç®¡ç†é€£çµå¤±æ•—ï¼š' + response.message);
            }
        },
        error: function() {
            alert('å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤');
        }
    });
});

// é é¢ç®¡ç†
$('#btn-func-sys').click(function() {
    $.ajax({
        url: '@Url.Action("GetAccessUrl", "SYS")',
        type: 'POST',
        data: { type: "1" },
        dataType: 'json',
        success: function(response) {
            if (response.success) {
                window.open(response.url, '_blank');
            } else {
                alert('å–å¾—é é¢åŠŸèƒ½ç®¡ç†é€£çµå¤±æ•—ï¼š' + response.message);
            }
        },
        error: function() {
            alert('å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤');
        }
    });
});
```

### **æ–¹æ¡ˆCï¼šç›´æ¥ Redirect åˆ°æ–°åˆ†é  URL**

å¦‚æœä½ çš„ç›®æ¨™æ˜¯è®“ä½¿ç”¨è€…ç›´æ¥è·³è½‰éå»ï¼š

```csharp
public ActionResult AP_ACCESS_SYS()
{
    try
    {
        var req_para = new HI_APACCESS.Models.M_SYS.GetUrlRequsetModel()
        {
            SysID = "HI_APACCESS",
            Type = "2",
            Environment = "DEV"
        };

        string json_input = JsonConvert.SerializeObject(req_para);
        string response = new HI_APACCESS_DLL.APACCESS().GetFunctionAndAccessUrl(json_input);
        HI_APACCESS.Models.M_SYS.GetUrlResponseModel response_ = JsonConvert.DeserializeObject<HI_APACCESS.Models.M_SYS.GetUrlResponseModel>(response);

        if (response_.Result_code == "0000")
        {
            // ç›´æ¥å°å‘åˆ° TOKEN URLï¼ˆç•¶å‰é é¢è·³è½‰ï¼‰
            return Redirect(response_.Url);
        }
        else
        {
            TempData["ErrorMessage"] = $"å–å¾—æ¬Šé™ç®¡ç†é€£çµå¤±æ•—ï¼š{response_.Msg}";
            return RedirectToAction("Main", "Home");
        }
    }
    catch (Exception ex)
    {
        TempData["ErrorMessage"] = $"å°å‘æ¬Šé™ç®¡ç†ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š{ex.Message}";
        return RedirectToAction("Main", "Home");
    }
}
```

## æˆ‘çš„å»ºè­°

**æ¨è–¦ä½¿ç”¨æ–¹æ¡ˆBï¼ˆAJAX æ–¹å¼ï¼‰**ï¼Œå› ç‚ºï¼š

âœ… **ä½¿ç”¨è€…é«”é©—æœ€å¥½** - ç•¶å‰é é¢å®Œå…¨ä¸å‹•ï¼Œåªé–‹æ–°åˆ†é   
âœ… **ä¸æœƒæœ‰ã€Œç©ºç™½é é¢ã€** - ä¸æœƒå‡ºç¾åŸ·è¡Œ script çš„éæ¸¡é é¢  
âœ… **æ›´å½ˆæ€§** - å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å‘¼å«ï¼Œä¸é™æ–¼ç›®éŒ„æ¨¹  
âœ… **éŒ¯èª¤è™•ç†æ›´å„ªé›…** - ç”¨ alert æç¤ºï¼Œä¸æœƒè·³é 

å¦‚æœä½ çš„ç›®éŒ„æ¨¹æ˜¯é€éé€£çµ `<a href="...">` é»æ“Šé€²å…¥ï¼Œé‚£å¯ä»¥ç”¨æ–¹æ¡ˆAã€‚

ä½ æ¯”è¼ƒæƒ³ç”¨å“ªä¸€ç¨®æ–¹å¼ï¼Ÿæˆ‘å¯ä»¥å¹«ä½ èª¿æ•´ç´°ç¯€ï¼ğŸ˜Šâ€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹