å¥½ ğŸ‘ æˆ‘ç”¨ä½ é€™å€‹ Info_List ç•¶ç¯„ä¾‹ï¼ŒæŠŠ åŠŸèƒ½4 (GetFuncBtn) å’Œ åŠŸèƒ½5 (CheckBtnEnabled) ä¸²èµ·ä¾†ï¼Œä¸¦é€ä¸€è§£é‡‹ä½ çš„å•é¡Œã€‚






ğŸ”¹ éœ€æ±‚æ•´ç† (æ ¹æ“šä½ èªªçš„è¦å‰‡)
	â€¢	001 ç¾¤çµ„ï¼šæ–°å¢(ä¸Šæ–¹)ã€ä¿®æ”¹(åˆ—)ã€åˆªé™¤(åˆ—)
	â€¢	å…¶ä»–ç¾¤çµ„ï¼šåªæœ‰æ–°å¢(ä¸Šæ–¹)
	â€¢	æŸ¥è©¢(ä¸Šæ–¹)ï¼šæ‰€æœ‰ç¾¤çµ„éƒ½èƒ½ç”¨

â¸»

ğŸ”¹ åŠŸèƒ½4 SQL çš„å®šä½

åŠŸèƒ½4 (GetFuncBtn) å›å‚³çš„æ˜¯ ã€ŒæŸç¾¤çµ„åœ¨æŸé é¢å¯ä»¥ç”¨çš„æŒ‰éˆ•æ¸…å–®ã€ã€‚
ğŸ‘‰ æ‰€ä»¥ä½ç½® (BtnLocation) åªæ˜¯æ¨™è¨˜ã€Œé€™å€‹æŒ‰éˆ•è¦æ”¾åœ¨å·¥å…·åˆ—(Top) é‚„æ˜¯è³‡æ–™åˆ—(Row)ã€ã€‚

èˆ‰ä¾‹ï¼š
	â€¢	BtnLocation=Top â†’ å‡ºç¾åœ¨é é¢å·¥å…·åˆ—ä¸Šæ–¹
	â€¢	BtnLocation=Row â†’ å‡ºç¾åœ¨è³‡æ–™è¡¨æ¯ä¸€åˆ—

â¸»

ğŸ”¹ OnClick çš„å•é¡Œ
	1.	onclick åœ¨è³‡æ–™è¡¨å…§å°±å­˜ å‡½å¼åç¨± (å¸¶åƒæ•¸çš„æ¨¡æ¿)ã€‚
	â€¢	ä¾‹å¦‚ï¼šconfirmDelete('{0}')
	â€¢	ç³»çµ±åœ¨ç•«é¢ç”Ÿæˆæ™‚æŠŠ {0} ä»£æ›æˆ item.FILE_NAME æˆ–å…¶ä»–å‹•æ…‹å€¼ã€‚
	2.	å¦‚æœæ–°å¢è·ŸæŸ¥è©¢è¦å‚³ä¸åŒåƒæ•¸ â†’ åœ¨ DB å°±å­˜ä¸åŒçš„ OnClick å®šç¾©ï¼š
	â€¢	Info_Insert('{0}')
	â€¢	performSearch('{0}', '{1}')
	3.	Action / Controller ä¸åŒ â†’ åœ¨ AP_RFUNC è¡¨è£¡é¢ ç›´æ¥å­˜ Controllerã€Action åç¨±ï¼Œç•«é¢ä¸Šç”¨ Html.BeginForm å°±èƒ½ç”Ÿæˆæ­£ç¢ºçš„è·¯å¾‘ã€‚

â¸»

ğŸ”¹ æ”¹ç‰ˆç¯„ä¾‹ (å¥—ç”¨åˆ° Info_List)

Model (ViewModel åŒ…ä¸€å€‹æ¸…å–®)

public class InfoListViewModel
{
    public IEnumerable<M_POS_IMG.M_POS_INFO> Data { get; set; }
    public List<GetFuncBtnModel.ResultData> AuthorizedButtons { get; set; }
}


â¸»

Controller

[HttpGet]
public ActionResult Info_List(string filetype, string selectedPositem, string Select_key, 
    [Bind] Models.M_POS_IMG.Select Select = Models.M_POS_IMG.Select.nodata, int PageNo = 1)
{
    filetype = "A";
    var queryResult = F_Common.GetPosInfo_ABE<M_POS_IMG.M_POS_INFO>(APG_NO, filetype, selectedPositem);

    var filterResult = queryResult.AsQueryable();
    if (Select != Models.M_POS_IMG.Select.nodata && !string.IsNullOrEmpty(Select_key))
    {
        switch (Select)
        {
            case Models.M_POS_IMG.Select.FILE_NAME:
                filterResult = filterResult.Where(x => x.FILE_NAME.Contains(Select_key));
                break;
            case Models.M_POS_IMG.Select.FILE_FORMAT:
                filterResult = filterResult.Where(x => x.FILE_FORMAT.Contains(Select_key));
                break;
            case Models.M_POS_IMG.Select.CASE_UNIT:
                filterResult = filterResult.Where(x => x.CASE_UNIT.Contains(Select_key));
                break;
        }
    }

    // ğŸ”¹ åŠŸèƒ½4ï¼šå–å‡ºå¯ç”¨æŒ‰éˆ•æ¸…å–®
    var btnReq = new GetFuncBtnModel.GetFuncBtnRequest
    {
        SysID = "HI_POSIMG",
        GroupID = APG_NO,
        FuncID = "INFO_LIST",
        Environment = "TEST"
    };
    string json = JsonConvert.SerializeObject(btnReq);
    string raw = new APACCESS().GetFuncBtn(json);
    var btnRes = JsonConvert.DeserializeObject<GetFuncBtnModel.GetFuncBtnResponse>(raw);

    var vm = new InfoListViewModel
    {
        Data = filterResult.ToPagedList(PageNo, 25),
        AuthorizedButtons = btnRes?.Result ?? new List<GetFuncBtnModel.ResultData>()
    };

    ViewBag.posItem = F_POSIMG_INFO.Get_DropDownList_PosItem();
    ViewBag.Select = Select;
    ViewBag.Select_key = Select_key;

    return View(vm);
}


â¸»

View (åªä¿ç•™é‡é»)

@model InfoListViewModel
@{
    var emp_APG_NO = (ViewContext.Controller as POSFILE_APPLY.Controllers.POSFILE_APPLYBaseController).APG_NO;
}

<!-- ğŸ”¹ Top å·¥å…·åˆ— -->
<div class="toolbar">
    @foreach (var btn in Model.AuthorizedButtons.Where(b => b.BtnLocation == "Top"))
    {
        if (!string.IsNullOrEmpty(btn.Controller) && !string.IsNullOrEmpty(btn.Action))
        {
            using (Html.BeginForm(btn.Action, btn.Controller, FormMethod.Get))
            {
                <button type="submit" id="@btn.BtnID" class="btn btn-primary">@btn.BtnName</button>
            }
        }
        else if (!string.IsNullOrEmpty(btn.BtnOnclick))
        {
            <button type="button" id="@btn.BtnID" class="btn btn-secondary"
                    onclick="@btn.BtnOnclick.Replace("{0}", "someValue")">
                @btn.BtnName
            </button>
        }
    }

    <!-- æŸ¥è©¢ â†’ å…¨éƒ¨ç¾¤çµ„å…±ç”¨ -->
    <button type="submit" class="btn btn-warning" onclick="performSearch()">æŸ¥è©¢</button>
</div>

<!-- ğŸ”¹ è³‡æ–™è¡¨ -->
<table class="table">
    <thead>
        <tr>
            <th>æ“ä½œ</th>
            <th>æª”æ¡ˆåç¨±</th>
            <th>æª”æ¡ˆæ ¼å¼</th>
            ...
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Data)
        {
            <tr>
                <td>
                    @foreach (var btn in Model.AuthorizedButtons.Where(b => b.BtnLocation == "Row"))
                    {
                        if (!string.IsNullOrEmpty(btn.Controller) && !string.IsNullOrEmpty(btn.Action))
                        {
                            using (Html.BeginForm(btn.Action, btn.Controller, new { filename = item.FILE_NAME }, FormMethod.Post))
                            {
                                <button type="submit" id="@btn.BtnID" class="btn btn-sm btn-primary">@btn.BtnName</button>
                            }
                        }
                        else if (!string.IsNullOrEmpty(btn.BtnOnclick))
                        {
                            <button type="button" id="@btn.BtnID" class="btn btn-sm btn-danger"
                                    onclick="@btn.BtnOnclick.Replace("{0}", item.FILE_NAME)">
                                @btn.BtnName
                            </button>
                        }
                    }
                </td>
                <td>@item.FILE_NAME</td>
                <td>@item.FILE_FORMAT</td>
            </tr>
        }
    </tbody>
</table>


â¸»

ğŸ”¹ æœ€å¾Œå›ç­”ä½ çš„å•é¡Œ
	1.	ä½ç½®åªæ˜¯ç”¨ä¾†åˆ†é¡è¿´åœˆ â†’ Top (ä¸Šæ–¹å·¥å…·åˆ—)ï¼ŒRow (æ¯ä¸€åˆ—)ã€‚
	2.	OnClick åƒæ•¸ â†’ åœ¨ DB è¨­å®šæ¨¡æ¿ MyFunc('{0}')ï¼ŒView ä»£æ›æˆå¯¦éš›å€¼ã€‚
	3.	ä¸åŒ Action/Controller â†’ åœ¨ DB å­˜ Controller/Actionï¼ŒView ç”¨ Html.BeginForm ç”¢ç”Ÿã€‚
	4.	åŠŸèƒ½5 vs Hi_Btn â†’ Hi_Btn æ˜¯ç°¡åŒ–ç‰ˆ (å–®ä¸€é¡†æŒ‰éˆ•åˆ¤æ–·)ï¼ŒåŠŸèƒ½4 æ˜¯æ¸…å–®ç‰ˆ (ä¸€é å¤šé¡†)ã€‚
	â€¢	å¦‚æœæŒ‰éˆ•å¾ˆå°‘ â†’ ç”¨åŠŸèƒ½5 + Hi_Btnã€‚
	â€¢	å¦‚æœæŒ‰éˆ•å¤šåˆè¦å‹•æ…‹é•·å‡ºä¾† â†’ ç”¨åŠŸèƒ½4ã€‚

â¸»

è¦ä¸è¦æˆ‘å¹«ä½ ç•«ä¸€å¼µ Info_List é é¢å°ç…§åœ–ï¼š001 ç¾¤çµ„è·Ÿå…¶ä»–ç¾¤çµ„å„è‡ªèƒ½çœ‹åˆ°å“ªäº›æŒ‰éˆ•ï¼Œè®“ä½ ä¸€çœ¼ç†è§£å·®åˆ¥ï¼Ÿ