äº†è§£ ğŸ‘
ä½ ç›®å‰å·²ç¶“å®Œæˆäº† ç¬¬å…­å€‹åŠŸèƒ½ (GetFunctionAndAccessUrl)ï¼Œä¸¦ä¸”è¦åŠƒå¥½ DLL çš„æ¶æ§‹ï¼š
	â€¢	æ¯å€‹ API åŠŸèƒ½éƒ½è¦æœ‰ Factory èˆ‡ Model
	â€¢	ä¸»é¡åˆ¥ APACCESS æä¾›éœæ…‹æ–¹æ³•å‘¼å«
	â€¢	SQL æŸ¥è©¢å›å‚³æ¬„ä½åç¨±è¦ç”¨ AS å°æ‡‰åˆ° Response æ ¼å¼
	â€¢	Core / Framework å…©å€‹ DLL éƒ½è¦æ”¯æ´

æˆ‘å¹«ä½ æŠŠ å‰©ä¸‹äº”å€‹åŠŸèƒ½ åƒç…§ä½ ç¬¬å…­å€‹çš„å¯«æ³•ï¼Œæ•´ç†å‡ºæ¸…æ¥šçš„ æ¶æ§‹è¨­è¨ˆç¨¿ï¼Œè®“ä½ å¯ä»¥ç›´æ¥ç…§é€™å€‹æ¨¡å¼é–‹ç™¼ã€‚

â¸»

â‘  GetUserNameAndGroup

Request

public class GetUserNameAndGroupRequest
{
    public string SysID { get; set; }
    public string UserAD { get; set; }
    public string Environment { get; set; }
}

Response

public class GetUserNameAndGroupResponse
{
    public string Result_code { get; set; }
    public string Msg { get; set; }
    public ResultData Result { get; set; }

    public class ResultData
    {
        public string UserID { get; set; }
        public string UserName { get; set; }
        public string GroupID { get; set; }
        public string GroupName { get; set; }
        public List<string> ParentGroupID { get; set; }
        public List<string> ChildGroupID { get; set; }
        public bool SensitiveDataAccess { get; set; }
        public string OrganName { get; set; }
        public string PostName { get; set; }
    }
}

SQL

SELECT DISTINCT
    B.U_ID AS UserID,
    B.U_NAME AS UserName,
    A.APG_NO AS GroupID,
    A.APG_NAME AS GroupName,
    A.PARENT_APG_NO,
    (SELECT STRING_AGG(APG_NO, ',') FROM AP_GROUP WHERE PARENT_APG_NO = A.APG_NO AND SYS_ID = A.SYS_ID) AS ChildGroupID,
    A.SENSITIVE_DATA_ACCESS AS SensitiveDataAccess,
    M.ORGAN_CAP AS OrganName,
    M.POST_NAME AS PostName
FROM [HI_TMMAIN].[dbo].[AP_GROUP] A
LEFT JOIN [AP_USER] B ON A.APG_NO = B.APG_NO
LEFT JOIN [VW_M1EMP_MAST] M ON B.U_ID = M.EMP_NO
WHERE A.SYS_ID=@SysID AND B.U_ID=@UserAD


â¸»

â‘¡ GetGroupAllUser

Request

public class GetGroupAllUserRequest
{
    public string SysID { get; set; }
    public string GroupID { get; set; }
    public bool IsIncludeChildGroups { get; set; }
    public string Environment { get; set; }
}

Response

public class GetGroupAllUserResponse
{
    public string Result_code { get; set; }
    public string Msg { get; set; }
    public ResultData Result { get; set; }

    public class ResultData
    {
        public List<string> UserADList { get; set; }
    }
}

SQL

SELECT DISTINCT U_ID
FROM [HI_TMMAIN].[dbo].[AP_USER] A
LEFT JOIN [AP_GROUP] B ON A.APG_NO = B.APG_NO
WHERE A.SYS_ID=@SysID
AND (
    B.APG_NO=@GroupID
    OR (@IsIncludeChildGroups=1 AND B.PARENT_APG_NO=@GroupID)
)


â¸»

â‘¢ GetTree

Request

public class GetTreeRequest
{
    public string SysID { get; set; }
    public string GroupID { get; set; }
    public string Environment { get; set; }
}

Response

public class GetTreeResponse
{
    public string Result_code { get; set; }
    public string Msg { get; set; }
    public List<ResultData> Result { get; set; }

    public class ResultData
    {
        public string FuncID { get; set; }
        public string FuncName { get; set; }
        public string Controller { get; set; }
        public string Action { get; set; }
        public int Sort { get; set; }
        public string ParentID { get; set; }
        public string Level { get; set; }
    }
}

SQL

SELECT DISTINCT
    a.FUNC_ID AS FuncID,
    a.FUNC_NA AS FuncName,
    a.VIEW_H AS Controller,
    a.VIEW_HB AS Action,
    a.SORT_NO AS Sort,
    a.PARENT_ID AS ParentID,
    CASE WHEN a.PARENT_ID='HOME' THEN '0' ELSE '1' END AS Level
FROM [HI_TMMAIN].[dbo].[AP_FUNC] a
LEFT JOIN [AP_USER_FUNC_CONFIG] b ON a.FUNC_ID = b.FUNC_ID
WHERE a.SYS_ID=@SysID AND b.APG_NO=@GroupID


â¸»

â‘£ GetFuncBtn

Request

public class GetFuncBtnRequest
{
    public string SysID { get; set; }
    public string GroupID { get; set; }
    public string FuncID { get; set; }
    public string Environment { get; set; }
}

Response

public class GetFuncBtnResponse
{
    public string Result_code { get; set; }
    public string Msg { get; set; }
    public List<ResultData> Result { get; set; }

    public class ResultData
    {
        public string BtnID { get; set; }
        public string BtnName { get; set; }
        public string Controller { get; set; }
        public string Action { get; set; }
        public string BtnLocation { get; set; }
        public string BtnOnclick { get; set; }
    }
}

SQL

(é¸æ“‡ç‰ˆæœ¬1ï¼Œæ¯”è¼ƒåˆç†ï¼šå¾ AP_USER_RFUNC_CONFIG æ§åˆ¶ç¾¤çµ„çš„æŒ‰éˆ•æ¬Šé™)

SELECT DISTINCT
    a.BTNID AS BtnID,
    a.BTN_NAME AS BtnName,
    a.CONTROLLER AS Controller,
    a.ACTION AS Action,
    a.LOC AS BtnLocation,
    a.ONCLICK AS BtnOnclick
FROM [HI_TMMAIN].[dbo].[AP_RFUNC] a
LEFT JOIN [AP_USER_RFUNC_CONFIG] b ON a.FUNC_ID = b.FUNC_ID
WHERE a.SYS_ID=@SysID AND b.APG_NO=@GroupID AND a.FUNC_ID=@FuncID


â¸»

â‘¤ CheckBtnEnabled

Request

public class CheckBtnEnabledRequest
{
    public string SysID { get; set; }
    public string GroupID { get; set; }
    public string FuncID { get; set; }
    public string BtnID { get; set; }
    public string Environment { get; set; }
}

Response

public class CheckBtnEnabledResponse
{
    public bool Result { get; set; }
}

SQL

SELECT 1
FROM [HI_TMMAIN].[dbo].[AP_USER_RFUNC_CONFIG] A
LEFT JOIN [AP_RFUNC] B ON A.FUNC_ID = B.FUNC_ID
WHERE A.SYS_ID=@SysID AND A.APG_NO=@GroupID AND A.FUNC_ID=@FuncID AND B.BTNID=@BtnID

(æŸ¥åˆ° = true, æ²’æœ‰ = false)

â¸»

å»ºè­°çš„ DLL çµæ§‹

HI_APACCESS_DLL_CORE
 â””â”€ Models
     â”œâ”€ GetUserNameAndGroupModel.cs
     â”œâ”€ GetGroupAllUserModel.cs
     â”œâ”€ GetTreeModel.cs
     â”œâ”€ GetFuncBtnModel.cs
     â”œâ”€ CheckBtnEnabledModel.cs
     â””â”€ GetFunctionAndAccessUrlModel.cs (å·²å®Œæˆ)
 â””â”€ Factory
     â”œâ”€ FGetUserNameAndGroup.cs
     â”œâ”€ FGetGroupAllUser.cs
     â”œâ”€ FGetTree.cs
     â”œâ”€ FGetFuncBtn.cs
     â”œâ”€ FCheckBtnEnabled.cs
     â””â”€ FGetFunctionAndAccessUrl.cs (å·²å®Œæˆ)
 â””â”€ APACCESS.cs (ä¸»éœæ…‹é¡åˆ¥ï¼Œçµ±ä¸€å…¥å£)


â¸»

è¦ä¸è¦æˆ‘å¹«ä½ å…ˆ å¯«å¥½ä¸€å€‹å®Œæ•´ç¯„ä¾‹ (æ¯”å¦‚ GetUserNameAndGroup çš„ Factory + Model + ä¸»é¡åˆ¥å‘¼å«)ï¼Œé€™æ¨£ä½ å°±å¯ä»¥ç›´æ¥ copy & paste ç…§è‘—é–‹ç™¼å‰©ä¸‹çš„ï¼Ÿ