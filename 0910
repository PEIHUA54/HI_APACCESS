æˆ‘çœ‹æ¸…æ¥šäº† ğŸ‘
ä½ ç¾åœ¨çš„ç¨‹å¼å·²ç¶“ä¸€åŠèµ°æ–°é‚è¼¯ï¼ˆå‘¼å« DLL åŠŸèƒ½ 1 GetUserNameAndGroupï¼‰ï¼Œä½†é‚„ä¿ç•™äº†èˆŠçš„ GetEmpNoByADï¼Œæ‰€ä»¥æ‰æœƒæ··äº‚ã€‚

æˆ‘å¹«ä½ æ•´ç†å‡ºä¾†æ‡‰è©²æ€éº¼æ”¹ï¼š

â¸»

æ”¹æ³•å»ºè­°

1. Get_å“¡å·¥AD â†’ ä¿ç•™ä¸å‹•

é€™å€‹æ–¹æ³•é‚„æ˜¯è² è²¬ å¾ HttpContext å–å‡ºç›®å‰ç™»å…¥çš„ ADï¼Œæ²’å•é¡Œï¼Œä¿ç•™ã€‚

â¸»

2. Get_å“¡å·¥ç·¨è™Ÿ â†’ æ”¹æˆåªå‘¼å« DLLï¼ˆåŠŸèƒ½ 1ï¼‰

æ—¢ç„¶ DLL åŠŸèƒ½ 1 å·²ç¶“å¯ä»¥æŠŠ AD â†’ å“¡ç·¨ï¼Œå°±ä¸éœ€è¦å†é€éèˆŠ SQL æŸ¥ã€‚

/// <summary>
/// æ¬Šé™ç®¡ç†-å–å¾—å“¡å·¥ç·¨è™Ÿ (å‘¼å« DLL åŠŸèƒ½1)
/// </summary>
/// <returns>å“¡ç·¨</returns>
internal static string Get_å“¡å·¥ç·¨è™Ÿ(string ad = null)
{
    var req = new M_AP.GetUserNameAndGroupRequestModel
    {
        SysID = "HI_POSIMG",
        UserAD = string.IsNullOrEmpty(ad) ? Get_å“¡å·¥AD() : ad, // æœ‰å‚³åƒæ•¸å°±ç”¨åƒæ•¸ï¼Œæ²’å‚³å°±æŠ“ HttpContext
        Environment = "TEST",
    };

    string json_input = JsonConvert.SerializeObject(req);
    string response = new APACCESS().GetUserNameAndGroup(json_input);
    var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

    // æ²’æ‰¾åˆ°å°±å›å‚³è¼¸å…¥çš„ ADï¼Œé¿å…æ•´å€‹æ›æ‰
    return res?.Result?.UserID ?? req.UserAD;
}


â¸»

3. Get_å“¡å·¥åŸºæœ¬è³‡æ–™ â†’ ä¹Ÿæ˜¯èµ° DLL åŠŸèƒ½ 1

é€™è£¡è·Ÿä½ å¯«çš„å·®ä¸å¤šï¼Œä½†å»ºè­°æŠŠ PostNo ä¹Ÿå¸¶é€²ä¾†ï¼ˆä»¥é˜²å¾Œé¢è¦ç”¨ï¼‰ã€‚

/// <summary>
/// å–å¾—å“¡å·¥åŸºæœ¬è³‡æ–™ (å‘¼å« DLL åŠŸèƒ½1)
/// </summary>
internal static VM_Employee.VM_å“¡å·¥éƒ¨é–€è·ç¨± Get_å“¡å·¥åŸºæœ¬è³‡æ–™(string ad = null)
{
    var req = new M_AP.GetUserNameAndGroupRequestModel
    {
        SysID = "HI_POSIMG",
        UserAD = string.IsNullOrEmpty(ad) ? Get_å“¡å·¥AD() : ad,
        Environment = "TEST"
    };

    string json_input = JsonConvert.SerializeObject(req);
    string response = new APACCESS().GetUserNameAndGroup(json_input);
    var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

    if (res?.Result == null) return null;

    return new VM_Employee.VM_å“¡å·¥éƒ¨é–€è·ç¨±
    {
        AD = req.UserAD,
        EMP_NO = res.Result.UserID,
        EMP_NAME = res.Result.UserName,
        POST_NO = res.Result.PostNo,
        POST_NAME = res.Result.PostName,
        ORGAN_NO = res.Result.OrganNo,
        ORGAN_CAP = res.Result.OrganName,
        APG_NO = res.Result.GroupID
    };
}


â¸»

4. åˆªæ‰ GetEmpNoByAD

å› ç‚º DLL åŠŸèƒ½ 1 å·²ç¶“å–ä»£å®ƒäº†ï¼Œé€™å€‹æ–¹æ³•å¯ä»¥å®Œå…¨ç§»é™¤ï¼Œé¿å…ä¹‹å¾Œæœ‰äººèª¤ç”¨ã€‚

â¸»

âœ… é€™æ¨£æ”¹å®Œï¼š
	â€¢	ä½ è¼¸å…¥ AD â†’ DLL å¹«ä½ è½‰æˆå“¡ç·¨ã€‚
	â€¢	æ²’è¼¸å…¥ AD â†’ è‡ªå‹•æŠ“ HttpContext çš„ç™»å…¥å¸³è™Ÿï¼Œå†è½‰å“¡ç·¨ã€‚
	â€¢	åŸºæœ¬è³‡æ–™ â†’ å…¨éƒ¨é€é DLL åŠŸèƒ½ 1 å–å¾—ï¼Œä¸æœƒå†èµ°èˆŠ SQLã€‚

â¸»

è¦ä¸è¦æˆ‘é †ä¾¿å¹«ä½ æ•´ç†ä¸€ä»½ æ–°çš„ SVS_å“¡å·¥åŸºæœ¬è³‡æ–™.cs å®Œæ•´æª”æ¡ˆï¼ˆå»æ‰å¤šé¤˜çš„èˆŠæ–¹æ³•ï¼‰ï¼Ÿ