æ”¶åˆ°ï¼æˆ‘æŠŠã€Œé 001 æª¢è¦– 001 ç¾¤æ™‚ï¼Œæ‰€æœ‰ã€ç®¡ç†ä½¿ç”¨è€…ã€æŒ‰éˆ•éƒ½ä¸èƒ½å‡ºç¾ã€ä¸€èµ·ç´é€²ä¾†ï¼Œä¸¦ä¿®æ­£ä½ ç¨‹å¼è£¡é¡è‰²èˆ‡å”¯è®€é‚è¼¯ã€‚ä»¥ä¸‹åªçµ¦éœ€è¦æ›¿æ›/æ–°å¢çš„ç‰‡æ®µï¼Œæ¯æ®µéƒ½æœ‰è¨»è§£æ¨™æ˜æ”¾å“ªè£¡ã€ç‚ºä½•ä¿®æ”¹ã€‚

â¸»

1) å…¥å£ï¼šçµ±ä¸€åˆ¤æ–·ï¼ˆæ”¾åœ¨å…¨åŸŸè®Šæ•¸é™„è¿‘ï¼‰

// âœ… æ–°å¢ï¼šçµ±ä¸€çš„ä½¿ç”¨è€…ç®¡ç†æ¬Šé™åˆ¤æ–·ï¼ˆèª°èƒ½åœ¨ç›®å‰æ‰€é¸ç¾¤çµ„é€²è¡Œã€Œç®¡ç†ä½¿ç”¨è€…ã€ï¼‰
function canManageUsersHere() {
    // 001 ç™»å…¥ â†’ ä»»ä½•ç¾¤éƒ½å¯ä»¥ç®¡ç†ä½¿ç”¨è€…ï¼ˆæœ€é«˜æ¬Šé™ï¼‰
    if (currentGroupID === '001') return true;
    // é 001 ç™»å…¥ â†’ åªèƒ½ç®¡ç†ã€Œé 001 ç¾¤ã€çš„ä½¿ç”¨è€…
    return currentGroup !== '001';
}


â¸»

2) applyRoleGateï¼šé 001 åªèƒ½ç®¡ç†ä½¿ç”¨è€…ã€æ¬Šé™å€å”¯è®€ï¼ˆæ•´æ®µæ›¿æ›ï¼‰

// ğŸ”§ ç™»å…¥èº«åˆ†å…¨åŸŸæ¬Šé™æ§åˆ¶ï¼ˆé 001 â†’ åªèƒ½ç®¡ç†ä½¿ç”¨è€…ï¼›ç¾¤çµ„/é é¢/æŒ‰éˆ•æ¬Šé™å…¨éƒ¨å”¯è®€ï¼‰
function applyRoleGate() {
    const isAdmin = (currentGroupID === '001');

    if (!isAdmin) {
        // éš±è—ã€Œç¾¤çµ„ç¶­è­·ï¼é é¢æ¬Šé™æ“ä½œï¼æ‰¹æ¬¡åŒ¯å…¥æ¬Šé™ã€ç­‰
        $('#editGroupBtn, #deleteGroupBtn, #saveAllBtn, #insGroupBtn').hide();

        // æ¬Šé™æ“ä½œ API å…¨éƒ¨ no-opï¼ˆé é¢/æŒ‰éˆ•æ¬Šé™å”¯è®€ï¼‰
        window.togglePagePermissionByClick = function () { };
        window.togglePagePermission = function () { };
        window.selectAllButtons = function () { };
        window.clearAllButtons = function () { };
        window.toggleButtonPermissionByClick = function () { };
        window.toggleButtonPermission = function () { };
    }
}


â¸»

3) loadGroupDataï¼šä¾ã€Œç›®å‰é¸å–ç¾¤çµ„ã€æ±ºå®šæ˜¯å¦é¡¯ç¤ºç®¡ç†ä½¿ç”¨è€…æŒ‰éˆ•ï¼ˆæ›¿æ›åŸæœ¬åœ¨æ­¤è™•åˆ¤æ–·é¡¯ç¤º/éš±è—æ–°å¢/åŒ¯å…¥çš„ç¨‹å¼ï¼‰

// ğŸ§­ åœ¨ loadGroupData() è£¡ã€è¨­å®šå®Œ currentGroup å¾Œå‘¼å«
function loadGroupData() {
    const newGroup = $('#groupSelect').val();
    // ...ï¼ˆç•¥ï¼‰åŸæœ¬çš„æœªå„²å­˜åˆ¤æ–·

    currentGroup = newGroup;
    hideSaveReminder();

    if (!currentGroup) { resetAllSections(); return; }

    // âœ… æ–°å¢ï¼šçµ±ä¸€ä¾è¦å‰‡é¡¯ç¤º/éš±è—ã€Œç®¡ç†ä½¿ç”¨è€…ã€ç›¸é—œæŒ‰éˆ•ï¼ˆèˆ‡ç™»å…¥èº«åˆ†ã€æ‰€é¸ç¾¤çµ„ç¶å®šï¼‰
    updateUserManagementUI();

    // å•Ÿç”¨æ‰€æœ‰æŒ‰éˆ•ï¼ˆapplyRoleGate æœƒå†éš±è—ä¸è©²å‡ºç¾è€…ï¼‰
    $('#editGroupBtn, #addUserBtn, #saveAllBtn, #deleteGroupBtn, #importUserBtn').prop('disabled', false);

    // 001 ç¾¤ä¸å¯åˆªé™¤
    const isLockedGroup = (currentGroup === '001');
    if (isLockedGroup) {
        $('#deleteGroupBtn').prop('disabled', true);
    } else {
        $('#editGroupBtn, #deleteGroupBtn').removeAttr('title');
    }

    loadUsers();
    loadPagePermissions();
}


â¸»

4) æ–°å¢ï¼šupdateUserManagementUIï¼ˆæ”¾åœ¨åŒä¸€æ”¯æª”æ¡ˆä»»ä¸€è™•å…¨åŸŸå‡½å¼å€ï¼‰

// âœ… æ–°å¢ï¼šä¾è¦å‰‡åˆ‡æ›ã€Œç®¡ç†ä½¿ç”¨è€…ã€æŒ‰éˆ•é¡¯ç¤ºï¼ˆæ–°å¢/æ‰¹æ¬¡åŒ¯å…¥ï¼‰
//  - 001 ç™»å…¥ï¼šä»»ä½•ç¾¤éƒ½é¡¯ç¤º
//  - é 001 ç™»å…¥ï¼šåœ¨ 001 ç¾¤éš±è—ï¼›å…¶å®ƒç¾¤é¡¯ç¤º
function updateUserManagementUI() {
    const show = canManageUsersHere(); // ä¾ç›®å‰ currentGroup èˆ‡ç™»å…¥èº«åˆ†æ±ºå®š
    $('#addUserBtn, #importUserBtn').toggle(show);
}


â¸»

5) loadUsersï¼šä¾è¦å‰‡æ±ºå®šæ˜¯å¦æ¸²æŸ“ã€Œè®Šæ›´ç¾¤çµ„ / åˆªé™¤ã€å…©é¡†æŒ‰éˆ•ï¼ˆåªæ›æ¸²æŸ“é‚£å¡Šï¼‰

// åœ¨ loadUsers() è£¡é¢ï¼Œçµ„ HTML çš„åœ°æ–¹æ”¹æˆï¼š
if (response.success) {
    let html = '';
    const canManageHere = canManageUsersHere(); // âœ… åŠ é€™è¡Œ

    if (response.data.length > 0) {
        response.data.forEach(function (user) {
            // âœ… é€™å¡Šæœƒä¾ canManageHere æ±ºå®šæ˜¯å¦é¡¯ç¤ºå…©é¡†æŒ‰éˆ•
            const manageBtns = canManageHere ? `
                <button type="button"
                        class="btn btn-sm btn-warning btn-small btn-change-group"
                        onclick="openChangeGroupModal('${user.U_ID}', '${user.U_NAME}', '${currentGroup}')">
                    è®Šæ›´ç¾¤çµ„
                </button>
                <button type="button" 
                        class="btn btn-sm btn-danger btn-small btn-delete-user"
                        onclick="deleteUser('${user.U_ID}', '${user.U_NAME}')">
                    åˆªé™¤
                </button>` : '';

            html += `
                <div class="user-item">
                    <div>
                        <strong>${user.U_ID}</strong><br>
                        <small>${user.U_NAME}</small><br>
                        <div class="extra-info">
                              å»ºç«‹äººå“¡:${user.CREATOR || ''}
                              å»ºç«‹æ—¥æœŸ:${user.CREATE_TIME || ''}<br>
                              ä¿®æ”¹äººå“¡:${user.EDITOR || ''}
                              ä¿®æ”¹æ—¥æœŸ:${user.EDIT_TIME || ''}
                        </div>
                    </div>
                    <div>
                        ${manageBtns}
                    </div>
                </div>`;
        });
    } else {
        html = '<div class="no-data">æ­¤ç¾¤çµ„æš«ç„¡ä½¿ç”¨è€…</div>';
    }
    $('#userList').html(html);
}

ğŸ”’ è¦å‰‡æ•ˆæœï¼š
	â€¢	é 001 ç™»å…¥ã€æª¢è¦– 001 ç¾¤ â†’ ä¸æœƒå‡ºç¾ã€Œè®Šæ›´ç¾¤çµ„ / åˆªé™¤ã€å…©é¡† per-user æŒ‰éˆ•ï¼Œä¹Ÿéš±è—ä¸Šæ–¹ã€Œæ–°å¢ä½¿ç”¨è€… / æ‰¹æ¬¡åŒ¯å…¥ã€ã€‚
	â€¢	é 001 ç™»å…¥ã€æª¢è¦–å…¶å®ƒç¾¤ â†’ å¯è¦‹ä¸¦å¯ç”¨ã€‚
	â€¢	001 ç™»å…¥ â†’ å…¨éƒ¨å¯è¦‹ä¸¦å¯ç”¨ã€‚

â¸»

6) openChangeGroupModalï¼šé 001 ç›®çš„ç¾¤ä¸å¾—é¸ 001ï¼ˆä½ å·²åšï¼Œä¿ç•™ï¼›é€™è£¡åªæé†’é—œéµåˆ¤æ–·ï¼‰

// ä¿ç•™ä½ åŸæœ¬é€™æ®µéæ¿¾ï¼šé 001 ä¸çµ¦é¸ 001
if (Array.isArray(response)) {
    response.forEach(function (group) {
        if (group.value !== currentGroup && (currentGroupID === '001' || group.value !== '001')) {
            options += `<option value="${group.value}">${group.text}</option>`;
        }
    });
}


â¸»

7) renderPageItemï¼šæ¢å¾©é¡è‰² + é 001 å”¯è®€ï¼ˆæ•´å€‹å‡½å¼æ›¿æ›ï¼‰

ä½ ä¹‹å‰å‡½å¼è£¡æœ‰å…©å€‹ returnï¼Œå¾ŒåŠæ®µï¼ˆå¸¶é¡è‰²ï¼‰è¢«æˆªæ–·äº†ã€‚æˆ‘å¹«ä½ åˆä½µä¸”å›ºå®šè‰²å½©ã€‚

function renderPageItem(func, isChild) {
    const funcId   = getFuncId(func);
    const funcName = getFuncName(func);

    const hasPermission = groupPermissions[funcId] && groupPermissions[funcId].hasPagePermission;
    const checkedAttr   = hasPermission ? 'checked' : '';

    const isParent = isParentPage(func);
    const isAdmin  = (currentGroupID === '001');

    // ğŸ¨ é¡è‰²è¦å‰‡
    // çˆ¶é é¢ï¼šæ·ºè—ï¼› FUNC_TYPE=1ï¼šæ·ºç¶ ï¼› FUNC_TYPE=2ï¼šæ·ºæ©˜ï¼›å…¶é¤˜ç™½åº•
    let bgStyle = '';
    if (isParent) {
        bgStyle = 'background-color:#e8f1fb;';
    } else if (func.FUNC_TYPE === '1') {
        bgStyle = 'background-color:#e8f5e8;';
    } else if (func.FUNC_TYPE === '2') {
        bgStyle = 'background-color:#fdf7e8;';
    }

    // é 001 â†’ å”¯è®€ï¼ˆç„¡ checkboxã€ä¸å¯è§¸ç™¼åˆ‡æ›ï¼‰
    const checkboxHtml = isAdmin ? `<input type="checkbox" class="permission-checkbox" ${checkedAttr}>` : '';
    const clickAttr    = isAdmin ? `onclick="togglePagePermissionByClick('${funcId}')" style="cursor:pointer;"` : 'style="cursor:default;"';

    const itemClass = `page-item ${hasPermission ? 'has-permission' : ''} ${isParent ? 'parent-page' : ''} ${isChild ? 'child-page-item' : ''}`;

    return `
      <div class="${itemClass}" data-func-id="${funcId}" ${clickAttr} style="${bgStyle}">
        <div class="permission-content">
            ${checkboxHtml}
            <span class="permission-title">${funcName}</span>
            <span class="permission-info">é é¢ID: ${funcId}</span>
        </div>
      </div>`;
}


â¸»

8) updateButtonListHierarchical / loadButtonsForPageï¼šæŒ‰éˆ•åˆ—å”¯è®€æ¢ä»¶ç”¨ã€Œç™»å…¥èº«åˆ†ã€åˆ¤æ–·ï¼ˆåªæ”¹æ¢ä»¶ï¼‰

æŠŠé€™å…©è™•çš„æ¢ä»¶éƒ½æ”¹æˆç›´æ¥åˆ¤æ–·ç™»å…¥èº«åˆ†ï¼š

${ (currentGroupID === '001') ? ` ... å¯æ“ä½œæŒ‰éˆ• ... ` : '' }

ä»¥åŠï¼š

if (currentGroupID === '001') {
    // å¯ç·¨è¼¯ç‰ˆï¼ˆå« checkbox / onclickï¼‰
} else {
    // å”¯è®€ç‰ˆï¼ˆç„¡ checkbox / ç„¡ onclickï¼‰
}


â¸»

9) CSSï¼šé é¢è¢«é»é¸é«˜äº®ï¼ˆå¦‚æœéœ€è¦ï¼‰

/* âœ… å¯é¸ï¼šé»é¸ç•¶å‰é é¢æ™‚çš„é«˜äº®å¤–æ¡† */
.page-item.active-page{
  border:2px solid #4a89dc;
  box-shadow:0 0 5px rgba(74,137,220,.6);
}


â¸»

âœ… è¦å‰‡é©—è­‰ï¼ˆå°ç…§ä½ çš„éœ€æ±‚ï¼‰
	â€¢	001 ç™»å…¥ï¼šç¾¤çµ„ç¶­è­· / ä½¿ç”¨è€…ç®¡ç† / é é¢æ¬Šé™ / æŒ‰éˆ•æ¬Šé™ â†’ å…¨éƒ¨å¯ç”¨
	â€¢	é 001 ç™»å…¥ï¼š
	â€¢	ã€Œé é¢æ¬Šé™ / æŒ‰éˆ•æ¬Šé™ã€â†’ å”¯è®€ï¼ˆä¸å¯å‹¾ã€ä¸å¯æ‰¹æ¬¡å…¨é¸/å…¨å–æ¶ˆï¼‰
	â€¢	ã€Œç®¡ç†ä½¿ç”¨è€…ã€â†’ åªèƒ½åœ¨é 001 ç¾¤åŸ·è¡Œï¼ˆæ–°å¢ã€åˆªé™¤ã€è®Šæ›´ç¾¤çµ„ï¼‰ï¼Œæª¢è¦– 001 ç¾¤æ™‚å®Œå…¨æ²’æœ‰ä»»ä½•ç®¡ç†æŒ‰éˆ•
	â€¢	è®Šæ›´ç¾¤çµ„ç›®æ¨™ â†’ ä¸å¯é¸ 001ï¼ˆå·²åœ¨ modal éæ¿¾ï¼‰

å¦‚æœä½ è¦ã€Œé 001 åœ¨ 001 ç¾¤é€£ä½¿ç”¨è€…æ¸…å–®ä¹Ÿä¸é¡¯ç¤ºã€ï¼Œæˆ‘ä¹Ÿå¯ä»¥å†è£œä¸€è¡Œ #userList åˆ‡æ›é¡¯ç¤ºï¼›ç›®å‰æ˜¯å¯çœ‹ä¸å¯ç®¡ã€‚