äº†è§£ âœ…
å¦‚æœä½ è¦ ä¸€é€²å» Modal å°±æœ‰å®Œæ•´å“¡å·¥æ¸…å–®ï¼Œé‚£å°±ä¸ç”¨ç­‰è¼¸å…¥ 3 ç¢¼å†æŸ¥ï¼Œè€Œæ˜¯ç›´æ¥æŠŠ VW_M1EMP_MAST å…¨éƒ¨å“¡å·¥ä¸Ÿé€² <datalist>ã€‚

â¸»

ğŸ”§ ä¿®æ”¹æ­¥é©Ÿ

1. å¾Œç«¯ï¼šGetEmployeeList

ä½ ç¾åœ¨æœ‰é€™å€‹æ–¹æ³•ï¼š

public List<EmployeeModel> GetEmployeeList(string keyword = "")
{
    string sql = @"
SELECT [EMP_NO], [EMP_NAME], [ORGAN_CAP], [POST_NAME]
FROM [HI_TMMAIN].[dbo].[VW_M1EMP_MAST]
WHERE 1=1";

    List<SqlParameter> parameters = new List<SqlParameter>();

    if (!string.IsNullOrWhiteSpace(keyword))
    {
        sql += " AND ([EMP_NO] LIKE @KEYWORD OR [EMP_NAME] LIKE @KEYWORD)";
        parameters.Add(new SqlParameter("@KEYWORD", $"%{keyword}%"));
    }

    sql += " ORDER BY [EMP_NO]";

    DataTable dt = SVS_DBmanager.QueryBySQL(sql, parameters);
    return SVS_DBmanager.ConvertToList<EmployeeModel>(dt);
}

ğŸ‘‰ æ”¹æ³•ï¼šå¦‚æœ keyword ç©ºï¼Œå°±å›å‚³æ‰€æœ‰å“¡å·¥ï¼ˆä¾‹å¦‚ TOP 1000ï¼Œé¿å…ä¸€æ¬¡å¡å¤ªå¤šï¼‰ã€‚

public List<EmployeeModel> GetEmployeeList(string keyword = "")
{
    string sql = @"
SELECT [EMP_NO], [EMP_NAME], [ORGAN_CAP], [POST_NAME]
FROM [HI_TMMAIN].[dbo].[VW_M1EMP_MAST]
WHERE 1=1";
    
    List<SqlParameter> parameters = new List<SqlParameter>();

    if (!string.IsNullOrWhiteSpace(keyword))
    {
        sql += " AND ([EMP_NO] LIKE @KEYWORD OR [EMP_NAME] LIKE @KEYWORD)";
        parameters.Add(new SqlParameter("@KEYWORD", $"%{keyword}%"));
    }

    // å»ºè­°åŠ ä¸Š TOP é™åˆ¶ï¼Œé¿å…è³‡æ–™éå¤šé€ æˆå‰ç«¯çˆ†ç‚¸
    sql = "SELECT TOP 1000 * FROM (" + sql + ") as T ORDER BY [EMP_NO]";

    DataTable dt = SVS_DBmanager.QueryBySQL(sql, parameters);
    return SVS_DBmanager.ConvertToList<EmployeeModel>(dt);
}


â¸»

2. å‰ç«¯ï¼šopenUserModal() â†’ ä¸€é€² Modal å°±è¼‰å…¥æ¸…å–®

function openUserModal() {
    $('#userForm')[0].reset();
    $('#empList').empty();

    // ğŸš€ ä¸€é€²å»å°±æ’ˆå…¨éƒ¨æ¸…å–®
    $.get('@Url.Action("GetEmployeeList", "AP")', {}, function (res) {
        if (res.success && Array.isArray(res.data)) {
            const options = res.data.map(emp =>
                `<option value="${emp.EMP_NO}">${emp.EMP_NO} - ${emp.EMP_NAME} (${emp.ORGAN_CAP || ''})</option>`
            ).join('');
            $('#empList').html(options);
        }
    });

    // ç¶å®šé¸æ“‡äº‹ä»¶ï¼ˆè‡ªå‹•å¸¶å§“å/éƒ¨é–€/è·ç¨±ï¼‰
    $('#userIdInput').off('change blur').on('change blur', function () {
        const empNo = this.value.trim();
        if (!empNo) return;
        $.get('@Url.Action("GetEmployeeInfo", "AP")', { emp_no: empNo }, function (r) {
            if (r.success && r.data) {
                const emp = r.data;
                $('#userName').val(emp.EMP_NAME || '');
                $('#userDept').val(emp.ORGAN_CAP || '');
                $('#userPost').val(emp.POST_NAME || '');
            } else {
                $('#userName,#userDept,#userPost').val('');
            }
        });
    });

    $('#userModal').modal('show');
}


â¸»

3. Modal HTML ä¿æŒä¸è®Š

<input type="text" class="form-control" id="userIdInput" list="empList" placeholder="è«‹è¼¸å…¥å“¡å·¥ç·¨è™Ÿ" required />
<datalist id="empList"></datalist>


â¸»

âœ… å®Œæˆæ•ˆæœ
	â€¢	æ‰“é–‹ã€Œæ–°å¢ä½¿ç”¨è€…ã€Modal â†’ ä¸‹æ‹‰æ¸…å–®ç›´æ¥å‡ºç¾å…¨éƒ¨å“¡å·¥ç·¨è™Ÿï¼ˆä¾‹å¦‚ TOP 1000 ç­†ï¼‰ã€‚
	â€¢	ä¹Ÿèƒ½è¼¸å…¥é—œéµå­—å¿«é€Ÿå®šä½ã€‚
	â€¢	é¸ä¸­å¾Œæœƒè‡ªå‹•å¸¶å‡ºå§“åã€éƒ¨é–€ã€è·ç¨±ã€‚

â¸»

è¦ä¸è¦æˆ‘å¹«ä½ å†åšå€‹ ã€Œå¦‚æœå“¡å·¥è¶…é 5000 ç­†ï¼Œå°±åªå…ˆè¼‰ 1000 ç­†ï¼Œè¼¸å…¥æ™‚å†è£œæŸ¥ã€ çš„ç‰ˆæœ¬ï¼Ÿé€™æ¨£å¯ä»¥é¿å… datalist å¤ªå¤§å¡ä½ã€‚