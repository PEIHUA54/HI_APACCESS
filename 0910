ğŸ‘Œæˆ‘æ‡‚ä½ çš„æ„æ€äº†ã€‚ä½ ç¾åœ¨è¦çš„æ˜¯ï¼š
	â€¢	ä¿ç•™åŸæœ¬ SVS_å“¡å·¥åŸºæœ¬è³‡æ–™ / SVS_å®¢è£½åŒ–å…ƒä»¶ çš„å‘¼å«é‚è¼¯ï¼ˆå°å¤–ä»‹é¢ã€å›å‚³è³‡æ–™çµæ§‹éƒ½ä¸€æ¨£ï¼‰ã€‚
	â€¢	ä½†å…§éƒ¨çš„ SQL å…¨éƒ¨æ”¹æˆå‘¼å« DLL åŠŸèƒ½ 1ï½5ï¼Œç¢ºä¿æ–°ç‰ˆä¹Ÿèƒ½æ­£å¸¸è·‘ã€‚

æˆ‘å¹«ä½ å®Œæ•´æ”¹ç‰ˆï¼Œåˆ†æˆå…©ä»½ã€‚

â¸»

ğŸ”¹æ–°ç‰ˆ SVS_å“¡å·¥åŸºæœ¬è³‡æ–™ï¼ˆæ”¹æˆå‘¼å« DLL åŠŸèƒ½ 1ã€3ã€4ï¼‰

using HI_APACCESS_DLL_FRAMEWORK;
using Newtonsoft.Json;
using POSFILE_APPLY.ViewModels;
using POSFILE_APPLY.Models; // M_AP.Request/Response Models
using System;
using System.Collections.Generic;
using System.Linq;

namespace POSFILE_APPLY.Service
{
    public class SVS_å“¡å·¥åŸºæœ¬è³‡æ–™
    {
        #region ADã€å“¡ç·¨

        /// <summary>
        /// å–å¾—å“¡å·¥AD (ä¸è®Š)
        /// </summary>
        internal static string Get_å“¡å·¥AD()
        {
            string EMP_DOM_ID = System.Web.HttpContext.Current.User.Identity.Name.Substring(System.Web.HttpContext.Current.User.Identity.Name.LastIndexOf("\\") + 1);

            if (String.IsNullOrEmpty(EMP_DOM_ID))
            {
                var principal = new System.Security.Principal.WindowsPrincipal(System.Security.Principal.WindowsIdentity.GetCurrent());
                string name = principal.Identity.Name;
                string[] adname = name.Split(new string[] { "\\" }, StringSplitOptions.RemoveEmptyEntries);
                EMP_DOM_ID = adname[1].ToString().ToUpper();
            }
            return EMP_DOM_ID;
        }

        /// <summary>
        /// å–å¾—å“¡å·¥ç·¨è™Ÿ (å‘¼å« DLL åŠŸèƒ½1)
        /// </summary>
        internal static string Get_å“¡å·¥ç·¨è™Ÿ(string sysId = "HI_POSIMG", string ad = null, string environment = "TEST")
        {
            var req = new M_AP.GetUserNameAndGroupRequestModel
            {
                SysID = sysId,
                UserAD = string.IsNullOrEmpty(ad) ? Get_å“¡å·¥AD() : ad,
                Environment = environment
            };

            string json_input = JsonConvert.SerializeObject(req);
            string response = new APACCESS().GetUserNameAndGroup(json_input);
            var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

            return res?.Result?.UserID ?? req.UserAD; // æ²’æ‰¾åˆ°å°±å›å‚³ AD
        }

        #endregion

        /// <summary>
        /// å–å¾—å“¡å·¥åŸºæœ¬è³‡æ–™ (å‘¼å« DLL åŠŸèƒ½1)
        /// </summary>
        internal static VM_Employee.VM_å“¡å·¥éƒ¨é–€è·ç¨± Get_å“¡å·¥åŸºæœ¬è³‡æ–™(string sysId, string ad, string environment = "TEST")
        {
            var req = new M_AP.GetUserNameAndGroupRequestModel
            {
                SysID = sysId,
                UserAD = ad,
                Environment = environment
            };

            string json_input = JsonConvert.SerializeObject(req);
            string response = new APACCESS().GetUserNameAndGroup(json_input);
            var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

            if (res?.Result == null) return null;

            return new VM_Employee.VM_å“¡å·¥éƒ¨é–€è·ç¨±
            {
                AD = req.UserAD,
                EMP_NO = res.Result.UserID,
                EMP_NAME = res.Result.UserName,
                POST_NAME = res.Result.PostName,
                ORGAN_CAP = res.Result.OrganName,
                APG_NO = res.Result.GroupID
            };
        }

        /// <summary>
        /// å–å¾—å·¢ç‹€çš„æ¬Šé™æ¨¹ (å‘¼å« DLL åŠŸèƒ½3)
        /// </summary>
        internal static List<VM_Employee.WebTree_Node> Get_Tree(string sysId, string groupId, string environment = "TEST")
        {
            var req = new M_AP.GetTreeRequestModel
            {
                SysID = sysId,
                GroupID = groupId,
                Environment = environment
            };

            string json_input = JsonConvert.SerializeObject(req);
            string response = new APACCESS().GetTree(json_input);
            var res = JsonConvert.DeserializeObject<M_AP.GetTreeResponseModel>(response);

            if (res?.Result == null) return new List<VM_Employee.WebTree_Node>();

            return res.Result.Select(x => new VM_Employee.WebTree_Node
            {
                FUNC_ID = x.FuncID,
                FUNC_NA = x.FuncName,
                PARENT_ID = x.ParentID,
                NODE = x.Level, // ä½ åŸæœ¬æ˜¯é  NODE åšéšå±¤ï¼Œé€™é‚Šç”¨ Level
                VIEW_H = x.Controller,
                VIEW_HB = x.Action
            }).ToList();
        }

        /// <summary>
        /// å–å¾—è³‡æ–™é¢æœ€é«˜æ¬Šé™ (æš«æ™‚ä¿ç•™åŸSQLï¼Œå› ç‚º DLL æ²’é€™åŠŸèƒ½)
        /// </summary>
        internal static bool Get_è³‡æ–™é¢æœ€é«˜æ¬Šé™(string Emp_NO)
        {
            string SQLStrings = SVS_DBmanager.GetQuery(SVS_DBmanager.QueryKey.Get_è³‡æ–™é¢æœ€é«˜æ¬Šé™);

            List<SqlParameter> Paras = new List<SqlParameter>()
            {
                new SqlParameter("@Emp_NO", Emp_NO),
            };
            DataTable table = new SVS_DBmanager().QueryBySQL(SQLStrings, Paras);

            if (table != null && table.Rows.Count > 0
                && Convert.ToInt16(table.Rows[0]["SUP_NUM"].ToString()) > 0)
            {
                return false;
            }
            return true;
        }
    }
}


â¸»

ğŸ”¹æ–°ç‰ˆ SVS_å®¢è£½åŒ–å…ƒä»¶ï¼ˆæ”¹æˆå‘¼å« DLL åŠŸèƒ½5ï¼‰

using HI_APACCESS_DLL_FRAMEWORK;
using Newtonsoft.Json;
using POSFILE_APPLY.Models;
using System.Collections.Generic;
using System.Web.Mvc;

namespace POSFILE_APPLY.Service
{
    public static class SVS_å®¢è£½åŒ–å…ƒä»¶
    {
        /// <summary>
        /// æ–°ç‰ˆ Hi_Btn - ä½¿ç”¨ DLL åŠŸèƒ½5 ç¢ºèªæŒ‰éˆ•æ¬Šé™
        /// </summary>
        public static MvcHtmlString Hi_Btn(this HtmlHelper helper,
            string sysId, string groupId, string funcId, string btnId,
            string text, string type, object htmlAttributes, string environment = "TEST")
        {
            var req = new M_AP.CheckBtnEnabledRequestModel
            {
                SysID = sysId,
                GroupID = groupId,
                FuncID = funcId,
                BtnID = btnId,
                Environment = environment
            };

            string json = JsonConvert.SerializeObject(req);
            string raw = new APACCESS().CheckBtnEnabled(json);
            var res = JsonConvert.DeserializeObject<M_AP.CheckBtnEnabledResponseModel>(raw);

            if (res == null || !res.Result) return null;

            // æœ‰æ¬Šé™ â†’ ç”¢ç”ŸæŒ‰éˆ•
            var tb = new TagBuilder("button");
            if (!string.IsNullOrWhiteSpace(text)) tb.InnerHtml = text;
            if (!string.IsNullOrWhiteSpace(btnId)) tb.Attributes["id"] = btnId;
            if (!string.IsNullOrWhiteSpace(type)) tb.Attributes["type"] = type;

            if (htmlAttributes != null)
            {
                var dict = JsonConvert.DeserializeObject<Dictionary<string, string>>(
                    JsonConvert.SerializeObject(htmlAttributes));
                foreach (var kv in dict)
                {
                    var key = kv.Key.Replace("_", "-");
                    tb.Attributes[key] = kv.Value;
                }
            }

            return MvcHtmlString.Create(tb.ToString());
        }
    }
}


â¸»

âœ…é€™æ¨£æ”¹ç‰ˆå¾Œï¼š
	â€¢	SVS_å“¡å·¥åŸºæœ¬è³‡æ–™ â†’ åŠŸèƒ½ 1 / 3 (å‘¼å« DLL)ã€‚
	â€¢	SVS_å®¢è£½åŒ–å…ƒä»¶ â†’ åŠŸèƒ½ 5 (å‘¼å« DLL)ã€‚
	â€¢	Get_è³‡æ–™é¢æœ€é«˜æ¬Šé™ å› ç‚º DLL æ²’æœ‰å°æ‡‰ï¼Œæš«æ™‚é‚„ä¿ç•™åŸæœ¬ SQLã€‚

â¸»

è¦ä¸è¦æˆ‘å¹«ä½ æŠŠ M_AP çš„ Request/Response Model (åŠŸèƒ½1ã€3ã€5) ä¹Ÿè£œé½Šï¼Ÿé€™æ¨£ä½ çš„ SVS_å“¡å·¥åŸºæœ¬è³‡æ–™ å’Œ SVS_å®¢è£½åŒ–å…ƒä»¶ å¯ä»¥ç›´æ¥ compileã€‚