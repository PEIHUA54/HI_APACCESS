å¥½ ğŸ‘Œ æˆ‘å…ˆå¹«ä½ è§£é‡‹ SQL ç‚ºä»€éº¼è¦é€™æ¨£å¯«ï¼Œç„¶å¾Œå†æé†’ä½ æ”¹ä¸»é¡åˆ¥çš„åœ°æ–¹ã€‚

â¸»

ğŸ”¹ FGetAllUser çš„ SQL

SELECT 
    U.U_ID   AS UserID,
    U.U_NAME AS UserName,
    ISNULL(LTRIM(RTRIM(E.EMP_DOM_ID)), '') AS UserAD
FROM [HI_AUTOS].[dbo].[AP_USER] U
LEFT JOIN [HILIFE_MTS].[HI_APUSER].dbo.[NT_EMP] E
    ON E.EMP_ID = U.U_ID
WHERE U.SYS_ID = @SysID
ORDER BY U.U_ID

ç‚ºä»€éº¼è¦é€™æ¨£å¯«ï¼š
	1.	AP_USER
	â€¢	å­˜æ”¾ç³»çµ±ä½¿ç”¨è€… (U_ID = å“¡å·¥ç·¨è™Ÿã€U_NAME = å“¡å·¥å§“å)ã€‚
	â€¢	é€™æ˜¯ AP ç³»çµ±æœ¬èº«çš„å¸³è™Ÿä¾†æºã€‚
	2.	NT_EMP (åœ¨ HILIFE_MTS è³‡æ–™åº«)
	â€¢	å­˜æ”¾å“¡å·¥çš„ç™»å…¥ AD å¸³è™Ÿ (EMP_DOM_ID)ã€‚
	â€¢	ä½† ä¸æ˜¯æ¯å€‹å“¡å·¥åœ¨ AP_USER éƒ½ä¸€å®šæœƒæœ‰å°æ‡‰çš„ ADï¼Œæ‰€ä»¥ç”¨ LEFT JOINã€‚
	3.	ISNULL(LTRIM(RTRIM(E.EMP_DOM_ID)), â€˜â€™) AS UserAD
	â€¢	ISNULLï¼šé¿å…æ²’æœ‰æ‰¾åˆ°å°æ‡‰ AD æ™‚å›å‚³ NULLï¼Œçµ±ä¸€çµ¦ç©ºå­—ä¸²ã€‚
	â€¢	LTRIM(RTRIM(...))ï¼šå»æ‰å¤šé¤˜çš„å‰å¾Œç©ºç™½ï¼Œé¿å…å› ç‚ºè³‡æ–™åº«è£¡å­˜æ”¾æ ¼å¼ä¸ä¸€è‡´ï¼Œå°è‡´æ¯”å°å•é¡Œã€‚

ğŸ‘‰ ç°¡å–®èªªï¼š
é€™æ®µ SQL å…ˆæŠ“å‡º AP_USER çš„æ‰€æœ‰äººï¼Œå†è£œä¸Š AD (å¦‚æœ NT_EMP æœ‰å°æ‡‰å°±é¡¯ç¤ºï¼Œæ²’æœ‰å°±ç©ºç™½)ã€‚

â¸»

ğŸ”¹ FGetGroupAllUser çš„ SQL

SELECT DISTINCT 
    U.U_ID   AS UserID,
    U.U_NAME AS UserName,
    ISNULL(LTRIM(RTRIM(E.EMP_DOM_ID)), '') AS UserAD
FROM [HI_AUTOS].[dbo].[AP_USER] U
LEFT JOIN [HILIFE_MTS].[HI_APUSER].dbo.[NT_EMP] E
    ON E.EMP_ID = U.U_ID
WHERE U.SYS_ID = @SysID 
  AND U.APG_NO IN (@Group0, @Group1, ...) -- ç¾¤çµ„æˆ–å­ç¾¤çµ„
ORDER BY U.U_ID

ç‚ºä»€éº¼è¦é€™æ¨£å¯«ï¼š
	1.	ç¾¤çµ„éæ¿¾
	â€¢	AP_USER æœ‰ä¸€å€‹æ¬„ä½ APG_NOï¼Œè¡¨ç¤ºä½¿ç”¨è€…éš¸å±¬çš„ç¾¤çµ„ã€‚
	â€¢	IN (@Group0, @Group1, ...) æ˜¯å› ç‚ºå¯èƒ½è¦åŒæ™‚æŸ¥è©¢ æ¯ç¾¤çµ„ + å­ç¾¤çµ„ã€‚
	2.	DISTINCT
	â€¢	é¿å…åŒä¸€å€‹äººåŒæ™‚è¢«æŸ¥å‡ºå¤šç­† (ä¾‹å¦‚æŸäººåŒæ™‚è¢«é…ç½®åˆ°æ¯ç¾¤çµ„å’Œå­ç¾¤çµ„)ã€‚
	3.	LEFT JOIN NT_EMP
	â€¢	åŒæ¨£ç†ç”±ï¼Œè£œä¸Šå“¡å·¥çš„ ADã€‚

ğŸ‘‰ ç°¡å–®èªªï¼š
é€™æ®µ SQL æ˜¯ã€ŒæŸ¥è©¢æŸå€‹ç¾¤çµ„ (å«å­ç¾¤çµ„) çš„æ‰€æœ‰æˆå“¡ï¼Œä¸¦è£œä¸Š ADã€ã€‚

â¸»

ğŸ”¹ ä¸»é¡åˆ¥è¦æ”¹ä»€éº¼ï¼Ÿ

åœ¨ HI_APACCESS ä¸»é¡åˆ¥ (ä½ é‚£é‚Šæ‡‰è©²æœ‰ GetAllUser() å’Œ GetGroupAllUser() æ–¹æ³•)ï¼ŒåŸæœ¬çš„ Response Result æ˜¯ å–®ç­†ç‰©ä»¶ï¼Œè¦æ”¹æˆ Listï¼Œè·Ÿå‰›å‰›çš„ Factory å°é½Šã€‚

ä¾‹å¦‚ï¼š

GetAllUser()

public string GetAllUser(string requestJson)
{
    var response = new GetAllUserModel.GetAllUserResponse();
    try
    {
        var request = JsonConvert.DeserializeObject<GetAllUserModel.GetAllUserRequest>(requestJson);
        FGetAllUser func = new FGetAllUser();
        response = func.Execute(request.SysID, request.Environment);
    }
    catch (Exception ex)
    {
        response.Result_code = Common.Codes.SYSTEM_ERROR;
        response.Msg = "ç³»çµ±éŒ¯èª¤ï¼š" + ex.Message;
    }
    return JsonConvert.SerializeObject(response);
}

GetGroupAllUser()

public string GetGroupAllUser(string requestJson)
{
    var response = new GetGroupAllUserModel.GetGroupAllUserResponse();
    try
    {
        var request = JsonConvert.DeserializeObject<GetGroupAllUserModel.GetGroupAllUserRequest>(requestJson);
        FGetGroupAllUser func = new FGetGroupAllUser();
        response = func.Execute(request.SysID, request.GroupID, request.IsIncludeChildGroups, request.Environment);
    }
    catch (Exception ex)
    {
        response.Result_code = Common.Codes.SYSTEM_ERROR;
        response.Msg = "ç³»çµ±éŒ¯èª¤ï¼š" + ex.Message;
    }
    return JsonConvert.SerializeObject(response);
}


â¸»

è¦ä¸è¦æˆ‘å¹«ä½ æŠŠ Model çš„ Response éƒ¨åˆ†å®Œæ•´æ›´æ–°ï¼ˆResult æ”¹æˆ Listï¼‰ç„¶å¾ŒæŠŠ WinForm æ¸¬è©¦ç¨‹å¼ä¹Ÿä¸€èµ·èª¿æ•´ï¼Œè®“ä½ æ¸¬è©¦çš„æ™‚å€™ç›´æ¥çœ‹åˆ°å¤šç­†çµæœï¼Ÿ