éå¸¸å¥½ ğŸ‘ï¼Œä½ çš„éœ€æ±‚æˆ‘å¹«ä½ æ•´ç†æˆæœ€ç²¾æº–çš„ç‰ˆæœ¬ï¼š

âœ… 001 ç®¡ç†å“¡ï¼ˆè³‡è¨Šï¼‰
	â€¢	å¯ä»¥ é–‹å•Ÿä¿®æ”¹ modal
	â€¢	å¯ä»¥ èª¿æ•´æ¯ç¾¤çµ„ (PARENT_APG_NO)
	â€¢	ä½† ç¾¤çµ„åç¨± (APG_NAME) æ¬„ä½é–ä½ä¸èƒ½æ”¹
	â€¢	ä¸å¯åˆªé™¤

â¸»

âœ… ä¿®æ”¹é‡é»ä¸€ï¼šeditGroup()ï¼ˆå‰ç«¯ï¼‰

åœ¨ä½ ç¾æœ‰çš„ editGroup() è£¡ï¼Œåªè¦åŠ ä¸‹é¢é€™æ®µå³å¯ã€‚
ä¸éœ€è¦æ”¹å…¶ä»–åœ°æ–¹ã€‚

function editGroup() {
    if (!currentGroup) return;

    // 001 ç¾¤çµ„å¯ç·¨è¼¯æ¯ç¾¤çµ„ï¼Œä½†ç¾¤çµ„åç¨±é–ä½
    const isLockedGroup = (currentGroup === '001');

    isEditMode = true;
    $('#groupModalTitle').text('ä¿®æ”¹ç¾¤çµ„');

    $.get('@Url.Action("GetGroupDetail", "AP")', { groupId: currentGroup, sysID: currentSysID }, function (response) {
        if (response.success) {
            const group = response.data;
            $('#groupId').val(group.APG_NO).prop('readonly', true);
            $('#groupName').val(group.APG_NAME);

            // ğŸ”¸ é–ä½ 001 åç¨±æ¬„ä½
            if (isLockedGroup) {
                $('#groupName').prop('readonly', true)
                               .css('background-color', '#f3f3f3')
                               .attr('title', 'æ­¤ç‚ºç³»çµ±å…§å»ºç¾¤çµ„ï¼Œåç¨±ä¸å¯ä¿®æ”¹');
            } else {
                $('#groupName').prop('readonly', false)
                               .css('background-color', '#ffffff')
                               .removeAttr('title');
            }

            $('#parentGroup').val(group.PARENT_APG_NO || '');
            $('#groupDesc').val(group.MEMO || '');

            $('#groupModal').modal('show');
        } else {
            alert('è¼‰å…¥ç¾¤çµ„è³‡æ–™å¤±æ•—ï¼š' + response.message);
        }
    });
}


â¸»

âœ… ä¿®æ”¹é‡é»äºŒï¼šdeleteGroup()ï¼ˆå‰ç«¯ï¼‰

ç›´æ¥åœ¨é–‹é ­æ“‹æ‰ 001ï¼Œä¸é–‹å•Ÿåˆªé™¤ç¢ºèªï¼š

function deleteGroup() {
    if (!currentGroup) return;

    if (currentGroup === '001') {
        alert('ã€Œ001 ç®¡ç†å“¡ï¼ˆè³‡è¨Šï¼‰ã€ç‚ºç³»çµ±å…§å»ºç¾¤çµ„ï¼Œç„¡æ³•åˆªé™¤ã€‚');
        return;
    }

    const groupName = $('#groupSelect option:selected').text();
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ç¾¤çµ„ã€Œ${groupName}ã€å—ï¼Ÿ`)) return;

    $.post('@Url.Action("DeleteGroup", "AP")', { apg_no: currentGroup, sysID: currentSysID }, function (response) {
        alert(response.message);
        if (response.success) {
            loadGroups();
            $('#userList').html('<div class="no-data">è«‹å…ˆé¸æ“‡ç¾¤çµ„</div>');
        }
    });
}


â¸»

âœ… ä¿®æ”¹é‡é»ä¸‰ï¼šå¾Œç«¯å®‰å…¨é˜²è­·ï¼ˆControllerï¼‰

é›–ç„¶å‰ç«¯å·²æ“‹ï¼Œä½†ä¿éšªèµ·è¦‹ï¼Œå¾Œç«¯ä¹ŸåŠ ä¸ŠåŒæ¨£æ¢ä»¶ï¼š

[HttpPost]
public JsonResult UpdateGroup(string APG_NO, string APG_NAME, string PARENT_APG_NO, string sysID)
{
    try
    {
        // ğŸ”¸ è‹¥ç‚º 001ï¼Œç¦æ­¢ä¿®æ”¹åç¨±ï¼Œä½†å…è¨±ä¿®æ”¹æ¯ç¾¤çµ„
        if (APG_NO == "001")
        {
            var service = GetAPService();
            service.UpdateParentGroupOnly(APG_NO, PARENT_APG_NO);
            return Json(new { success = true, message = "æ¯ç¾¤çµ„æ›´æ–°æˆåŠŸï¼ˆ001 ç¾¤çµ„åç¨±å·²é–å®šï¼‰" });
        }

        var result = GetAPService().UpdateGroup(APG_NO, APG_NAME, PARENT_APG_NO);
        if (result.Success)
            return Json(new { success = true, message = "ç¾¤çµ„ä¿®æ”¹æˆåŠŸ" });
        else
            return Json(new { success = false, message = result.Message ?? "ç¾¤çµ„ä¿®æ”¹å¤±æ•—" });
    }
    catch (Exception ex)
    {
        return Json(new { success = false, message = "ä¿®æ”¹ç¾¤çµ„æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š" + ex.Message });
    }
}

åœ¨ F_AP è£¡è£œä¸Šç°¡å–®æ–¹æ³•ï¼š

// åƒ…æ›´æ–°æ¯ç¾¤çµ„ï¼ˆä¾› 001 ä½¿ç”¨ï¼‰
public void UpdateParentGroupOnly(string apgNo, string parentApgNo)
{
    string sql = @"
        UPDATE [HI_AUTOS].[dbo].[AP_GROUP]
        SET PARENT_APG_NO = @PARENT_APG_NO
        WHERE APG_NO = @APG_NO AND SYS_ID = @SYS_ID";

    List<SqlParameter> parameters = new List<SqlParameter>
    {
        new SqlParameter("@PARENT_APG_NO", (object)parentApgNo ?? DBNull.Value),
        new SqlParameter("@APG_NO", apgNo),
        new SqlParameter("@SYS_ID", _sysId)
    };

    SVS_DBmanager.ExecuteSQL(sql, parameters);
}


â¸»

âœ… æœ€çµ‚è¡Œç‚ºä¸€è¦½ï¼š

å‹•ä½œ	çµæœ
ä¿®æ”¹ 001	å¯é–‹å•Ÿ modalï¼Œä½†ç¾¤çµ„åç¨±é–ä½ï¼Œåªèƒ½æ”¹æ¯ç¾¤çµ„
åˆªé™¤ 001	æç¤ºã€Œç³»çµ±å…§å»ºç¾¤çµ„ï¼Œç„¡æ³•åˆªé™¤ã€
ä¿®æ”¹å…¶ä»–ç¾¤çµ„	æ­£å¸¸å¯ç·¨è¼¯åç¨±èˆ‡æ¯ç¾¤çµ„
å¾Œç«¯ç›´æ¥ API å‘¼å«	UpdateGroup ä»æœƒä¿è­·åç¨±ä¸è¢«æ›´æ”¹


â¸»

æ˜¯å¦è¦æˆ‘å¹«ä½ é †ä¾¿æŠŠ ç¾¤çµ„åç¨±æ¬„ä½çš„ placeholder èˆ‡é–å®šæ¨£å¼ åšæˆç°åº• + é¡¯ç¤º ğŸ”’ åœ–ç¤ºï¼Ÿï¼ˆä¸æ”¹çµæ§‹ï¼ŒåªåŠ è¦–è¦ºæç¤ºï¼‰