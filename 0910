æ²’å•é¡Œï½æˆ‘å€‘å¾é ­æŠŠã€Œè¨­è¨ˆ â†’ è¦æ”¹å“ªäº›æª” â†’ å¯¦ä½œç¨‹å¼ç¢¼ â†’ æ€éº¼æ¸¬ã€ä¸€æ¬¡è¬›æ¸…æ¥šï¼Œè®“ä½ ä¸æœƒäº‚ ğŸ˜Š

â¸»

0) ä½ è¦é”æˆçš„ç›®æ¨™ï¼ˆä¸€å¥è©±ï¼‰
	â€¢	å¤–éƒ¨ç³»çµ±éƒ½åªå‚³ ADï¼ˆUserADï¼‰çµ¦ DLL
	â€¢	DLL å…ˆæŠŠ AD è½‰å“¡ç·¨ (EMP_NO)ï¼Œå†åŸ·è¡Œä½ è¦æ ¼ä¸­çš„åŠŸèƒ½ï¼ˆ1ï½5ï¼‰ã€‚
	â€¢	å°å¤– API çš„è³‡æ–™çµæ§‹ç¶­æŒä½ åŸæœ¬çš„è¦æ ¼ä¸è®Šï¼ˆåŠŸèƒ½1å›å‚³ UserID=å“¡ç·¨ï¼‰ã€‚

â¸»

1) å°ˆæ¡ˆå…§æª”æ¡ˆçµæ§‹ï¼ˆæ–°å¢èˆ‡èª¿æ•´ï¼‰

HI_APACCESS_DLL_FRAMEWORK/
â”œâ”€â”€ Common/
â”‚   â””â”€â”€ FCommon.cs                // å·²æœ‰ï¼šç’°å¢ƒé€£ç·šå­—ä¸²ã€æˆæ¬Šç³»çµ±æ¸…å–®
â”œâ”€â”€ Factory/
â”‚   â”œâ”€â”€ FIdentity.cs              // âœ… æ–°å¢ï¼šAD â†’ EMP_NO ä¸€ç«™å¼è½‰æ›
â”‚   â”œâ”€â”€ FGetUserNameAndGroup.cs   // âœ… ä¿®æ”¹ï¼šæ”¹æˆå…ˆæŠŠ AD è½‰ EMP_NO å†æŸ¥
â”‚   â”œâ”€â”€ FGetGroupAllUser.cs       // (å·²å®Œæˆ)
â”‚   â”œâ”€â”€ FGetTree.cs               // (å·²å®Œæˆ)
â”‚   â”œâ”€â”€ FGetFuncBtn.cs            // (å·²å®Œæˆ)
â”‚   â””â”€â”€ FCheckBtnEnabled.cs       // (å·²å®Œæˆ, å·²ä¿®æ­£ç”¨ FUNC_ID+BTNSEQ)
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ GetUserNameAndGroupModel.cs // âœ… ç¢ºèªæ¬„ä½ã€JsonPropertyã€DisplayName
â””â”€â”€ APACCESS.cs                   // âœ… ä¸»é¡åˆ¥ï¼šæ–°å¢ ResolveEmpNoByAD() å·¥å…·æ–¹æ³•ï¼›åŠŸèƒ½1ä½¿ç”¨å®ƒ


â¸»

2) å…±ç”¨å·¥å…·ï¼šADâ†’å“¡ç·¨æ”¾é€² DLLï¼ˆæ–°å¢ FIdentity.csï¼‰

ç”¨ä½ æä¾›çš„ SQLï¼Œç›´æ¥åœ¨ DLL å…§åšè½‰æ›ã€‚
ä¹‹å¾Œä¸ç®¡åŠŸèƒ½1æˆ–åˆ¥çš„ï¼Œéœ€è¦å“¡ç·¨å°±ç”¨é€™å€‹æ–¹æ³•ã€‚

// Factory/FIdentity.cs
using System.Data.SqlClient;
using HI_APACCESS_DLL_FRAMEWORK.Common;

namespace HI_APACCESS_DLL_FRAMEWORK.Factory
{
    internal static class FIdentity
    {
        /// <summary>AD â†’ å“¡ç·¨ï¼ˆæŸ¥ä¸åˆ°æ™‚å›å‚³åŸ ADï¼‰</summary>
        internal static string GetEmpNoByAD(string ad, string environment)
        {
            if (string.IsNullOrWhiteSpace(ad)) return ad;

            // ä½ çš„ SQLï¼ˆè·¨ DB join åœ¨åŒä¸€ SQL Server ä¸Šï¼‰
            string sql = @"
SELECT EMP_ID 
FROM [HILIFE_MTS].[HI_APUSER].dbo.[NT_EMP] 
WHERE EMP_ID != EMP_DOM_ID
  AND LTRIM(RTRIM(EMP_DOM_ID)) <> '' 
  AND EMP_ID IN (
        SELECT EMP_NO 
        FROM [HILIFE_DB3].[DB_SHARE].dbo.[M1EMP_MAST] 
        WHERE END_DT IS NULL
  ) 
  AND EMP_DOM_ID = @AD";

            string empNo = null;
            using (var conn = new SqlConnection(FCommon.BuildConnectionString(environment)))
            using (var cmd  = new SqlCommand(sql, conn))
            {
                cmd.Parameters.AddWithValue("@AD", ad);
                conn.Open();
                var o = cmd.ExecuteScalar();
                empNo = o?.ToString();
            }

            return string.IsNullOrWhiteSpace(empNo) ? ad : empNo;
        }
    }
}

âœ… å‡è¨­ TEST/PROD å…©å€‹ç’°å¢ƒçš„ åŒä¸€å° SQL Server ä¸Šéƒ½èƒ½å­˜å–é€™ä¸‰å€‹ DBï¼ˆHILIFE_MTSã€HILIFE_DB3ã€HI_TMMAINï¼‰ã€‚
è‹¥ PROD è¦ç”¨ä¸åŒ DataSourceï¼Œè«‹åœ¨ FCommon.BuildConnectionString(environment) å·²ç¶“å®Œæˆåˆ‡æ›ï¼ˆä½ å‰é¢æœ‰åšï¼‰ã€‚

â¸»

3) ä¸»é¡åˆ¥æ–°å¢å·¥å…·æ–¹æ³•ï¼ˆAPACCESS.csï¼‰

é€™ä¸æ˜¯æ–°çš„æ¥­å‹™ APIï¼Œåªæ˜¯å·¥å…·æ–¹æ³•ï¼ˆç›´æ¥å›å‚³å­—ä¸²ï¼‰ï¼Œæ–¹ä¾¿å…§å¤–éƒ¨ç¨‹å¼åœ¨å¿…è¦æ™‚å–®ç´”è½‰æ› ADâ†’å“¡ç·¨ã€‚

// APACCESS.cs (ç¯€éŒ„)
using HI_APACCESS_DLL_FRAMEWORK.Factory;

namespace HI_APACCESS_DLL_FRAMEWORK
{
    public class APACCESS
    {
        /// <summary>å·¥å…·æ–¹æ³•ï¼šAD è½‰å“¡ç·¨</summary>
        public string ResolveEmpNoByAD(string userAd, string environment)
        {
            return FIdentity.GetEmpNoByAD(userAd, environment);
        }

        // ... å…¶é¤˜åŠŸèƒ½1ï½6
    }
}


â¸»

4) åŠŸèƒ½ 1 çš„ Modelï¼ˆGetUserNameAndGroupModel.csï¼‰

ä¿æŒä½ è¦æ ¼ï¼›å›å‚³ UserID=å“¡ç·¨ã€‚
ï¼ˆä¸‹é¢ç¤ºç¯„ç”¨ Pascal å‘½åï¼‹JsonPropertyï¼Œé¿å…å¤§å°å¯«ä¸ä¸€è‡´ï¼‰

// Models/GetUserNameAndGroupModel.cs
using Newtonsoft.Json;
using System.Collections.Generic;
using System.ComponentModel;

namespace HI_APACCESS_DLL_FRAMEWORK.Models
{
    internal class GetUserNameAndGroupModel
    {
        internal class GetUserNameAndGroupRequest
        {
            [JsonProperty("SysID")]
            [DisplayName("ç³»çµ±ID")]
            internal string SysID { get; set; }

            [JsonProperty("UserAD")]
            [DisplayName("ä½¿ç”¨è€…AD")]
            internal string UserAD { get; set; }

            [JsonProperty("Environment")]
            [DisplayName("ç’°å¢ƒ")]
            internal string Environment { get; set; }
        }

        internal class GetUserNameAndGroupResponse
        {
            [JsonProperty("Result_code")]
            [DisplayName("å›è¦†ä»£ç¢¼")]
            internal string Result_code { get; set; }

            [JsonProperty("Msg")]
            [DisplayName("è¨Šæ¯")]
            internal string Msg { get; set; }

            [JsonProperty("Result")]
            [DisplayName("å›æ‡‰å…§å®¹")]
            internal ResultData Result { get; set; }
        }

        internal class ResultData
        {
            [JsonProperty("UserID")]
            [DisplayName("å“¡ç·¨")]
            internal string UserID { get; set; }

            [JsonProperty("UserName")]
            [DisplayName("å§“å")]
            internal string UserName { get; set; }

            [JsonProperty("GroupID")]
            [DisplayName("ç¾¤çµ„ä»£ç¢¼")]
            internal string GroupID { get; set; }

            [JsonProperty("GroupName")]
            [DisplayName("ç¾¤çµ„åç¨±")]
            internal string GroupName { get; set; }

            [JsonProperty("ParentGroupID")]
            [DisplayName("æ¯ç¾¤çµ„æ¸…å–®")]
            internal List<string> ParentGroupID { get; set; }

            [JsonProperty("ChildGroupID")]
            [DisplayName("å­ç¾¤çµ„æ¸…å–®")]
            internal List<string> ChildGroupID { get; set; }

            [JsonProperty("SensitiveDataAccess")]
            [DisplayName("æ©Ÿæ•è³‡æ–™æ¬Šé™")]
            internal bool SensitiveDataAccess { get; set; }

            [JsonProperty("OrganName")]
            [DisplayName("éƒ¨é–€")]
            internal string OrganName { get; set; }

            [JsonProperty("PostName")]
            [DisplayName("è·ç¨±")]
            internal string PostName { get; set; }
        }
    }
}


â¸»

5) åŠŸèƒ½ 1 Factoryï¼ˆFGetUserNameAndGroup.csï¼‰

é‡é»ï¼šå…ˆæŠŠ AD è½‰å“¡ç·¨ï¼Œå†æŸ¥ã€‚æ¯ç¾¤çµ„ç›´æ¥ç”¨æ¬„ä½ï¼ˆè‹¥ä½ é‚£é‚Šå­˜çš„æ˜¯ã€Œ001,002ã€å°± splitï¼‰ï¼Œå­ç¾¤çµ„ç”¨ä½ å®šç¾©çš„é‚è¼¯æŸ¥ã€‚

// Factory/FGetUserNameAndGroup.cs
using System;
using System.Collections.Generic;
using System.Data.SqlClient;
using HI_APACCESS_DLL_FRAMEWORK.Models;
using HI_APACCESS_DLL_FRAMEWORK.Common;

namespace HI_APACCESS_DLL_FRAMEWORK.Factory
{
    internal class FGetUserNameAndGroup
    {
        internal GetUserNameAndGroupModel.GetUserNameAndGroupResponse Execute(string sysId, string userAd, string environment)
        {
            var res = new GetUserNameAndGroupModel.GetUserNameAndGroupResponse();

            try
            {
                // 0) ç’°å¢ƒæª¢æŸ¥
                if (environment != "TEST" && environment != "PROD")
                {
                    res.Result_code = Codes.ENV_ERROR;
                    res.Msg = "ç’°å¢ƒéŒ¯èª¤ï¼Œåªæ¥å— TEST æˆ– PROD";
                    return res;
                }

                // 1) ç³»çµ±æˆæ¬Šæª¢æŸ¥
                var authorized = FCommon.GetAuthorizedSystemsList(environment);
                if (!authorized.Contains(sysId))
                {
                    res.Result_code = Codes.SYS_UNAUTHORIZED;
                    res.Msg = "ç³»çµ±æœªæˆæ¬Š";
                    return res;
                }

                // 2) AD â†’ å“¡ç·¨
                string empNo = FIdentity.GetEmpNoByAD(userAd, environment);

                // 3) æŸ¥ä½¿ç”¨è€…åŸºæœ¬ï¼‹ç¾¤çµ„ï¼ˆç”¨å“¡ç·¨ï¼‰
                string groupId = null;
                string groupName = null;
                bool sensitive = false;
                string userName = null;
                string parentRaw = null;
                string organ = null;
                string post = null;

                using (var conn = new SqlConnection(FCommon.BuildConnectionString(environment)))
                {
                    conn.Open();

                    // 3-1 ä¸»è¦è³‡æ–™ï¼ˆUserName, GroupID/Name, Sensitive, ParentGroup raw, éƒ¨é–€/è·ç¨±ï¼‰
                    string sqlMain = @"
SELECT TOP 1
    B.U_ID           AS UserID,
    B.U_NAME         AS UserName,
    A.APG_NO         AS GroupID,
    A.APG_NAME       AS GroupName,
    A.PARENT_APG_NO  AS ParentRaw,
    A.SENSITIVE_DATA_ACCESS AS SensitiveDataAccess,
    M.ORGAN_CAP      AS OrganName,
    M.POST_NAME      AS PostName
FROM [HI_TMMAIN].[dbo].[AP_GROUP] A
LEFT JOIN [HI_TMMAIN].[dbo].[AP_USER] B  ON A.APG_NO = B.APG_NO
LEFT JOIN [HILIFE_DB3].[DB_SHARE].dbo.[M1EMP_MAST] M ON B.U_ID = M.EMP_NO
WHERE A.SYS_ID=@SYS_ID AND B.U_ID=@EMP_NO";

                    using (var cmd = new SqlCommand(sqlMain, conn))
                    {
                        cmd.Parameters.AddWithValue("@SYS_ID", sysId);
                        cmd.Parameters.AddWithValue("@EMP_NO", empNo);

                        using (var r = cmd.ExecuteReader())
                        {
                            if (r.Read())
                            {
                                // ä¸»è¦æ¬„ä½
                                userName  = r["UserName"]?.ToString();
                                groupId   = r["GroupID"]?.ToString();
                                groupName = r["GroupName"]?.ToString();
                                parentRaw = r["ParentRaw"]?.ToString();
                                sensitive = r["SensitiveDataAccess"] != DBNull.Value && Convert.ToBoolean(r["SensitiveDataAccess"]);
                                organ     = r["OrganName"]?.ToString();
                                post      = r["PostName"]?.ToString();
                            }
                        }
                    }

                    if (string.IsNullOrWhiteSpace(groupId))
                    {
                        res.Result_code = Codes.NO_PERMISSION;
                        res.Msg = "æŸ¥ç„¡æ¬Šé™";
                        return res;
                    }

                    // 3-2 æ¯ç¾¤çµ„ï¼šå¦‚æœè³‡æ–™è¡¨ç›´æ¥å­˜ "003,002" é€™ç¨®ï¼Œå°± splitï¼›å¦‚æœæ˜¯å–®ä¸€å€¼å°±åŒ…æˆæ¸…å–®
                    var parentList = new List<string>();
                    if (!string.IsNullOrWhiteSpace(parentRaw))
                    {
                        foreach (var s in parentRaw.Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries))
                            parentList.Add(s.Trim());
                    }

                    // 3-3 å­ç¾¤çµ„ï¼šåŒ SYS_IDï¼ŒPARENT_APG_NO åŒ…å«æˆ‘çš„ GroupID çš„ç¾¤çµ„
                    // è‹¥ PARENT_APG_NO å¯èƒ½å­˜å¤šç¢¼ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰ï¼Œç”¨ like åŒ…é€—è™Ÿé˜²æ­¢èª¤åˆ¤
                    var childList = new List<string>();
                    string sqlChild = @"
SELECT APG_NO 
FROM [HI_TMMAIN].[dbo].[AP_GROUP]
WHERE SYS_ID=@SYS_ID
  AND (',' + LTRIM(RTRIM(PARENT_APG_NO)) + ',') LIKE '%,' + @MY_GID + ',%'";

                    using (var cmd2 = new SqlCommand(sqlChild, conn))
                    {
                        cmd2.Parameters.AddWithValue("@SYS_ID", sysId);
                        cmd2.Parameters.AddWithValue("@MY_GID", groupId);

                        using (var r2 = cmd2.ExecuteReader())
                        {
                            while (r2.Read())
                            {
                                childList.Add(r2["APG_NO"].ToString());
                            }
                        }
                    }

                    // 4) çµ„å›æ‡‰
                    res.Result_code = Codes.SUCCESS;
                    res.Msg = "æˆåŠŸ";
                    res.Result = new GetUserNameAndGroupModel.ResultData
                    {
                        UserID             = empNo,      // âœ… å›å‚³å“¡ç·¨
                        UserName           = userName,
                        GroupID            = groupId,
                        GroupName          = groupName,
                        ParentGroupID      = parentList,
                        ChildGroupID       = childList,
                        SensitiveDataAccess= sensitive,
                        OrganName          = organ,
                        PostName           = post
                    };
                }
            }
            catch (Exception ex)
            {
                res.Result_code = Codes.SYSTEM_ERROR;
                res.Msg = "ç³»çµ±éŒ¯èª¤ï¼š" + ex.Message;
            }

            return res;
        }
    }
}


â¸»

6) åŠŸèƒ½ 1 ä¸»é¡åˆ¥å‘¼å«ï¼ˆAPACCESS.csï¼‰

é€™é‚è¼¯ç¶­æŒç°¡å–®ï¼šååºåˆ—åŒ– â†’ äº¤çµ¦ Factory â†’ åºåˆ—åŒ–å›å‚³ã€‚
Factory è£¡é¢å·²ç¶“æœƒæŠŠ AD è½‰å“¡ç·¨äº†ã€‚

// APACCESS.cs (ç¯€éŒ„)
using Newtonsoft.Json;
using HI_APACCESS_DLL_FRAMEWORK.Models;
using HI_APACCESS_DLL_FRAMEWORK.Factory;
using HI_APACCESS_DLL_FRAMEWORK.Common;

namespace HI_APACCESS_DLL_FRAMEWORK
{
    public class APACCESS
    {
        public string GetUserNameAndGroup(string requestJson)
        {
            var response = new GetUserNameAndGroupModel.GetUserNameAndGroupResponse();

            try
            {
                var request = JsonConvert.DeserializeObject<GetUserNameAndGroupModel.GetUserNameAndGroupRequest>(requestJson);
                var func = new FGetUserNameAndGroup();
                response = func.Execute(request.SysID, request.UserAD, request.Environment);
            }
            catch (Exception ex)
            {
                response = new GetUserNameAndGroupModel.GetUserNameAndGroupResponse
                {
                    Result_code = Codes.SYSTEM_ERROR,
                    Msg = "ç³»çµ±éŒ¯èª¤ï¼š" + ex.Message
                };
            }

            return JsonConvert.SerializeObject(response);
        }

        // å·¥å…·ï¼šADâ†’å“¡ç·¨
        public string ResolveEmpNoByAD(string userAd, string environment)
        {
            return FIdentity.GetEmpNoByAD(userAd, environment);
        }
    }
}


â¸»

7) Web å°ˆæ¡ˆï¼šæ¸¬è©¦ç”¨ Controller + Model

Controllerï¼ˆAPController.csï¼‰

using System.Web.Mvc;
using Newtonsoft.Json;
using HI_APACCESS_DLL_FRAMEWORK;
using POSFILE_APPLY.Models;

public class APController : Controller
{
    // æ¸¬è©¦ï¼šåŠŸèƒ½1 å–å¾—ä½¿ç”¨è€…ç¾¤çµ„èˆ‡åç¨±ï¼ˆè¼¸å…¥ ADï¼‰
    public ActionResult Test_GetUserNameAndGroup()
    {
        var req = new M_AP.GetUserNameAndGroupRequestModel
        {
            SysID = "HI_POSIMG",
            UserAD = "3A001",   // æ¸¬è©¦ AD
            Environment = "TEST"
        };

        string jsonInput = JsonConvert.SerializeObject(req);
        string response = new APACCESS().GetUserNameAndGroup(jsonInput);
        var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

        return Content($"<pre>{JsonConvert.SerializeObject(res, Formatting.Indented)}</pre>", "text/html");
    }
}

Web æ¸¬è©¦ç”¨ Modelï¼ˆPOSFILE_APPLY.Models.M_APï¼‰

using System.Collections.Generic;

namespace POSFILE_APPLY.Models
{
    public class M_AP
    {
        // åŠŸèƒ½1ï¼šRequest
        public class GetUserNameAndGroupRequestModel
        {
            public string SysID { get; set; }
            public string UserAD { get; set; }
            public string Environment { get; set; }
        }

        // åŠŸèƒ½1ï¼šResponse
        public class GetUserNameAndGroupResponseModel
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public ResultData Result { get; set; }

            public class ResultData
            {
                public string UserID { get; set; }               // å“¡ç·¨
                public string UserName { get; set; }
                public string GroupID { get; set; }
                public string GroupName { get; set; }
                public List<string> ParentGroupID { get; set; }
                public List<string> ChildGroupID { get; set; }
                public bool SensitiveDataAccess { get; set; }
                public string OrganName { get; set; }
                public string PostName { get; set; }
            }
        }
    }
}


â¸»

8) Hi_Btn ä»¥å¾Œæ€éº¼å¯«ï¼Ÿï¼ˆé‡é»é‚è¼¯ï¼‰

ã€Œè¦ä¸è¦é¡¯ç¤ºæŸé¡†æŒ‰éˆ•ã€ï¼ã€Œç¾¤çµ„æ˜¯å¦å°é‚£å€‹é é¢çš„é‚£é¡†æŒ‰éˆ•æœ‰æ¬Šé™ã€ã€‚
ç›´æ¥å‘¼å« DLL åŠŸèƒ½ 5ï¼ˆCheckBtnEnabledï¼‰å³å¯ï¼Œä¸è¦è‡ªå·±æ‰“ SQLã€‚

// ç¯„ä¾‹ HtmlHelperï¼š@Html.Hi_Btn("POS1001", "001", "EDIT", "ç·¨è¼¯", "button", new { @class="btn" })
public static class CustomHtmlHelpers
{
    public static MvcHtmlString Hi_Btn(this HtmlHelper helper,
        string funcId, string groupId, string btnId,
        string text, string type, object htmlAttributes)
    {
        // å‘¼å« DLL åŠŸèƒ½5
        var req = new POSFILE_APPLY.Models.M_AP.CheckBtnEnabledRequestModel
        {
            SysID = "HI_POSIMG",
            GroupID = groupId,
            FuncID = funcId,
            BtnID = btnId,
            Environment = "TEST"
        };

        string json = JsonConvert.SerializeObject(req);
        string raw  = new HI_APACCESS_DLL_FRAMEWORK.APACCESS().CheckBtnEnabled(json);
        var res     = JsonConvert.DeserializeObject<POSFILE_APPLY.Models.M_AP.CheckBtnEnabledResponseModel>(raw);

        if (!res.Result) return null; // æ²’æ¬Šé™å°±ä¸é¡¯ç¤º

        // æœ‰æ¬Šé™ â†’ ç”¢ button
        var tb = new TagBuilder("button");
        if (!string.IsNullOrWhiteSpace(text)) tb.InnerHtml = text;
        if (!string.IsNullOrWhiteSpace(btnId)) tb.Attributes["id"] = btnId;
        if (!string.IsNullOrWhiteSpace(type)) tb.Attributes["type"] = type;

        if (htmlAttributes != null)
        {
            var dict = JsonConvert.DeserializeObject<Dictionary<string,string>>(
                JsonConvert.SerializeObject(htmlAttributes));
            foreach (var kv in dict)
            {
                var key = kv.Key.Replace("_", "-");
                tb.Attributes[key] = kv.Value;
            }
        }
        return MvcHtmlString.Create(tb.ToString());
    }
}

âœ… é€™æ¨£æ”¹å®Œå¾Œï¼ŒButton æ¬Šé™å®Œå…¨äº¤çµ¦ DLL ç®¡ï¼ŒWeb ä¸å†æ‰“ä»»ä½•æ¬Šé™ SQLã€‚

â¸»

9) ã€ŒGet_è³‡æ–™é¢æœ€é«˜æ¬Šé™ã€ä¸æ˜¯åŠŸèƒ½ 5

ä½ çš„ SQLï¼ˆMRSUPPERï¼‰æ˜¯è³‡æ–™å±¤ç´šçš„æ¬Šé™ï¼Œä¸æ˜¯æŒ‰éˆ•æ¬Šé™ã€‚
â†’ å®ƒæ‡‰è©²æ˜¯å¦ä¸€æ”¯ APIï¼ˆä¾‹å¦‚åŠŸèƒ½ 7ï¼‰ï¼šè¼¸å…¥ Emp_NOï¼Œå›å‚³ true/falseã€‚
ç›®å‰å…ˆä¸å‹•ï¼ˆç­‰ä½ ç¢ºèªè¦ä¸è¦ä¹Ÿæ”¾é€² DLLï¼‰ã€‚

â¸»

10) æ¸¬è©¦æµç¨‹ï¼ˆä¸€æ­¥æ­¥ï¼‰
	1.	å»ºç½® DLLï¼ˆHI_APACCESS_DLL_FRAMEWORKï¼‰â†’ ç¢ºèª .dll å‡ºç¾åœ¨ Web å°ˆæ¡ˆ binã€‚
	2.	Web åŠ ä¸Š APController.Test_GetUserNameAndGroup èˆ‡ Web æ¨¡å‹ã€‚
	3.	ç€è¦½å™¨æ‰“ï¼š/AP/Test_GetUserNameAndGroup
	â€¢	æˆåŠŸæœƒçœ‹åˆ°ï¼š

{
  "Result_code": "0000",
  "Msg": "æˆåŠŸ",
  "Result": {
    "UserID": "E12345",
    "UserName": "ç‹å°æ˜",
    "GroupID": "001",
    "GroupName": "ç®¡ç†å“¡(è³‡è¨Š)",
    "ParentGroupID": ["003","002"],
    "ChildGroupID": ["004","005"],
    "SensitiveDataAccess": false,
    "OrganName": "ç¨‹å¼èª²",
    "PostName": "é«˜ç´šå°ˆå“¡"
  }
}


	â€¢	æŸ¥ä¸åˆ° â†’ 0001 æŸ¥ç„¡æ¬Šé™
	â€¢	ç’°å¢ƒéŒ¯èª¤ â†’ 1003 ç’°å¢ƒéŒ¯èª¤

	4.	é é¢æŒ‰éˆ•ï¼ˆHi_Btnï¼‰é©—è­‰ï¼šæŠŠä½ é é¢çš„ @Html.Hi_Btn(...) æ”¹æˆæ–°ç‰ˆæœ¬ï¼Œå°ç…§åŠŸèƒ½ 5 çš„è³‡æ–™æª”ã€‚

â¸»

æœ€å¾Œçš„æé†’
	â€¢	ç’°å¢ƒé€£ç·šå­—ä¸²ï¼šFCommon.BuildConnectionString(environment) è¦èƒ½å­˜å–ä½ ä¸‰å€‹ DBï¼Œå¦å‰‡ FIdentity æŸ¥ä¸åˆ°å“¡ç·¨ã€‚
	â€¢	æ¯ç¾¤çµ„ï¼šä½ èªªã€Œæ¯ç¾¤çµ„å¯ä»¥ç›´æ¥æ’ˆã€â†’ ç”¨ PARENT_APG_NOï¼›è‹¥æ˜¯é€—è™Ÿåˆ†éš”ï¼Œå°± splitã€‚
	â€¢	å­ç¾¤çµ„ï¼šç”¨ LIKE åŒ…é€—è™Ÿé¿å…èª¤åˆ¤ï¼ˆå¦‚æœ PARENT_APG_NO å…è¨±å¤šå€¼ï¼‰ã€‚

â¸»

å¦‚æœä½ æƒ³ï¼Œæˆ‘ä¹Ÿå¯ä»¥æŠŠ åŠŸèƒ½ 2ï½5 å…¨éƒ¨å†æƒä¸€éï¼Œç¢ºèªæ˜¯å¦ä¹Ÿéœ€è¦ ADâ†’å“¡ç·¨ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼Œå› ç‚º 2ï½5 éƒ½æ˜¯ GroupID é©…å‹•ï¼‰ï¼Œä¸¦è£œä¸Šæ¸¬è©¦ Controllerã€‚


