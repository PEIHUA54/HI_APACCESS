   #region AD、員編、 基本資料

   /// <summary>
   /// 權限管理-取得員工AD
   /// </summary>
   /// <returns>AD</returns>
   internal static string Get_員工AD()
   {
       string EMP_DOM_ID = System.Web.HttpContext.Current.User.Identity.Name.Substring(System.Web.HttpContext.Current.User.Identity.Name.LastIndexOf("\\") + 1);

       if (String.IsNullOrEmpty(EMP_DOM_ID))
       {
           System.Security.Principal.WindowsPrincipal principal = new System.Security.Principal.WindowsPrincipal(System.Security.Principal.WindowsIdentity.GetCurrent());
           string name = principal.Identity.Name;
           string[] adname = name.Split(new string[] { "\\" }, StringSplitOptions.RemoveEmptyEntries);
           EMP_DOM_ID = adname[1].ToString().ToUpper();
       }

       return EMP_DOM_ID;
   }

   /// <summary>
   /// 權限管理-取得員工編號 (呼叫 DLL 功能1)
   /// </summary>
   /// <returns>員編</returns>
   internal static string Get_員工編號(string ad = null)
   {
       var req = new M_AP.GetUserNameAndGroupRequestModel
       {
           SysID = "HI_POSIMG",
           UserAD = string.IsNullOrEmpty(ad) ? Get_員工AD() : ad,
           Environment = "TEST",
       };

       string json_input = JsonConvert.SerializeObject(req);
       string response = new APACCESS().GetUserNameAndGroup(json_input);
       var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

       return res?.Result?.UserID ?? req.UserAD; // 沒找到就回傳 AD
   }

   /// <summary>
   /// 取得員工基本資料 (呼叫 DLL 功能1)
   /// </summary>
   /// <param name="Emp_NO">員編</param>
   /// <returns></returns>
   internal static VM_Employee.VM_員工部門職稱 Get_員工基本資料(string ad)
   {
       var req = new M_AP.GetUserNameAndGroupRequestModel
       {
           SysID = "HI_POSIMG",
           UserAD = ad,
           Environment = "TEST"
       };

       string json_input = JsonConvert.SerializeObject(req);
       string response = new APACCESS().GetUserNameAndGroup(json_input);
       var res = JsonConvert.DeserializeObject<M_AP.GetUserNameAndGroupResponseModel>(response);

       if (res?.Result == null) return null;

       return new VM_Employee.VM_員工部門職稱
       {
           AD = req.UserAD,
           EMP_NO = res.Result.UserID,
           EMP_NAME = res.Result.UserName,
           POST_NAME = res.Result.PostName,
           ORGAN_CAP = res.Result.OrganName,
           APG_NO = res.Result.GroupID
       };
   }

   /// <summary>
   /// AD轉換為員編
   /// </summary>
   /// <param name="AD">取得工作站登入AD</param>
   /// <returns>員編</returns>
   private static string GetEmpNoByAD(string AD)
   {
       string EMP_NO = null;
       string sql = SVS_DBmanager.GetQuery(SVS_DBmanager.QueryKey.GetEmpNoByAD);
       List<SqlParameter> paras = new List<SqlParameter>
         {
             new SqlParameter("@AD",AD)
         };
       DataTable table = new SVS_DBmanager().QueryBySQL(sql, paras);
       if (table.Rows.Count > 0)
       {
           EMP_NO = table.Rows[0]["EMP_ID"].ToString();
       }

       EMP_NO = String.IsNullOrEmpty(EMP_NO) ? AD : EMP_NO;
       return EMP_NO;
   }

   #endregion
