👏 你觀察得很仔細，沒錯！我剛剛給的 SQL 邏輯是「判斷這個群組在這個功能頁是否有任一筆按鈕權限」，但 忽略了「不同按鈕的對應關係」。

來，我把資料表結構拆給你看，這樣會比較清楚：

⸻

📌 相關資料表
	1.	AP_RFUNC（按鈕定義表）
	•	SYS_ID
	•	FUNC_ID
	•	BTNSEQ
	•	BTNID
	•	BTN_NAME
	•	CONTROLLER
	•	ACTION
	•	LOC
	•	ONCLICK

👉 每個功能頁 (FUNC_ID) 底下，可能有多個按鈕 (BTNID)，但它們的 唯一識別 不是 BTNID，而是 (FUNC_ID + BTNSEQ)。

⸻

	2.	AP_USER_RFUNC_CONFIG（群組按鈕權限表）
	•	SYS_ID
	•	FUNC_ID
	•	BTNSEQ
	•	APG_NO

👉 這裡紀錄「哪個群組 (APG_NO) 可以用某功能頁 (FUNC_ID) 的哪個按鈕 (BTNSEQ)」。

⸻

📌 正確的比對方式
	1.	先在 AP_RFUNC 找到 FUNC_ID + BTNID → 找到對應的 BTNSEQ。
	2.	再去 AP_USER_RFUNC_CONFIG 查這個群組 (APG_NO) 是否有這個 BTNSEQ。

⸻

📌 修正後 SQL

SELECT COUNT(*) AS Cnt
FROM [HI_TMMAIN].[dbo].[AP_USER_RFUNC_CONFIG] a
INNER JOIN [HI_TMMAIN].[dbo].[AP_RFUNC] b 
    ON a.FUNC_ID = b.FUNC_ID 
   AND a.BTNSEQ = b.BTNSEQ
WHERE a.SYS_ID = @SysID
  AND a.APG_NO = @GroupID
  AND a.FUNC_ID = @FuncID
  AND b.BTNID = @BtnID;

👉 這樣才能精準對應「群組 007 有沒有 infolist 功能頁下的 btninsert」。

⸻

📌 C# Factory 修正版

string sql = @"
SELECT COUNT(*) AS Cnt
FROM [HI_TMMAIN].[dbo].[AP_USER_RFUNC_CONFIG] a
INNER JOIN [HI_TMMAIN].[dbo].[AP_RFUNC] b 
    ON a.FUNC_ID = b.FUNC_ID 
   AND a.BTNSEQ = b.BTNSEQ
WHERE a.SYS_ID=@SysID
  AND a.APG_NO=@GroupID
  AND a.FUNC_ID=@FuncID
  AND b.BTNID=@BtnID";


⸻

✅ 總結
	•	原本的 SQL 只判斷「有沒有權限紀錄」，但沒有細到「哪個按鈕」
	•	正確做法 → 用 FUNC_ID + BTNSEQ 跟群組權限比對，BTNID 只是「按鈕代號」
	•	Model 回傳 true / false 還是正確的，因為這個功能就是檢查「有沒有這個按鈕權限」

⸻

要不要我幫你更新 功能 5 的完整 Factory + 主類別程式（用正確的 FUNC_ID + BTNSEQ）？