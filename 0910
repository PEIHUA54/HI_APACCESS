å®Œç¾ ğŸ‘ï¼Œä½ é€™ä»½ PageManagement å·²ç¶“çµæ§‹å®Œæ•´ï¼Œæˆ‘å¹«ä½ åŠ ä¸Šã€Œé é¢é¡å‹ FUNC_TYPEã€çš„æ•´åˆï¼š
ğŸ‘‰ åŒ…å«ï¼š
	1.	å¾Œç«¯å‚³å› FUNC_TYPE è³‡æ–™çš„æ¥æ”¶
	2.	Modal ä¸­æ–°å¢æ¬„ä½ï¼ˆä¸‹æ‹‰é¸å–® 1:Tree, 2:PartialViewï¼‰
	3.	æ–°å¢èˆ‡ä¿®æ”¹æ™‚å¸¶å…¥ FUNC_TYPE
	4.	æª¢æŸ¥å¿…å¡«
	5.	å­é é¢åœ¨åˆ—è¡¨é¡¯ç¤ºä¸åŒåº•è‰²ï¼š
â€ƒâ€ƒTree â†’ ç¶ è‰² #DFFFD6
â€ƒâ€ƒPartialView â†’ æ·ºè— #E8F5FD

â¸»

âœ… ä¸€ã€åœ¨ Modal æ–°å¢ FUNC_TYPE æ¬„ä½

è«‹åœ¨ä½ çš„ Modal ä¸­ çš„é€™æ®µï¼š

<div class="row">
    <div class="col-md-6">
        <div class="form-group">
            <label for="isShow">æ˜¯å¦é¡¯ç¤º</label>
            <select class="form-control" id="isShow">
                <option value="Y">æ˜¯</option>
                <option value="N">å¦</option>
            </select>
        </div>
    </div>

ä¸Šæ–¹ æ’å…¥ä»¥ä¸‹æ–°æ¬„ä½ ğŸ‘‡ï¼š

<div class="col-md-6">
    <div class="form-group">
        <label for="funcType">é é¢é¡å‹ <span class="text-danger">*</span></label>
        <select class="form-control" id="funcType" required>
            <option value="1">1 - Tree</option>
            <option value="2">2 - PartialView</option>
        </select>
    </div>
</div>

âœ… é€™æ¨£ Modal é¡¯ç¤ºé †åºç‚ºï¼š
ä¸Šå±¤ID / é é¢åç¨± / Controller / Action / é é¢é¡å‹ / æ˜¯å¦é¡¯ç¤º / å‚™è¨»

â¸»

âœ… äºŒã€åœ¨ JS ä¸­åŠ å…¥ FUNC_TYPE è™•ç†é‚è¼¯

(1) openPageModal()

function openPageModal() {
    isPageEditMode = false;
    $('#pageModalTitle').text('æ–°å¢é é¢');
    $('#pageForm')[0].reset();
    $('#isShow').val('Y');
    $('#funcId').prop('readonly', false).css('background-color', '#ffffff');
    $('#viewH').val('');
    $('#viewHB').val('');
    $('#funcType').val('1'); // é è¨­ç‚º Tree

    loadParentPageOptions();
    $('#pageModal').modal('show');
}


â¸»

(2) editPage(funcId)

åœ¨è¼‰å…¥è³‡æ–™å¾ŒåŠ å…¥ï¼š

$('#funcType').val(page.FUNC_TYPE || '1');

ä¿®æ”¹å¾Œç‰ˆæœ¬ï¼ˆç¯€éŒ„ï¼‰ï¼š

if (page) {
    $('#funcId').val(page.FUNC_ID).prop('readonly', false);
    $('#funcName').val(page.FUNC_NA);
    $('#sortNo').val(page.SORT_NO || '');
    $('#isShow').val(page.IS_SHOW || 'Y');
    $('#memo').val(page.MEMO || '');
    $('#viewH').val(page.VIEW_H || '');
    $('#viewHB').val(page.VIEW_HB || '');
    $('#funcType').val(page.FUNC_TYPE || '1'); // æ–°å¢


â¸»

(3) savePage()

åœ¨çµ„åˆ formData æ™‚åŠ å…¥ FUNC_TYPEï¼š

const funcType = ($('#funcType').val() || '').trim();

if (!funcType) {
    alert('è«‹é¸æ“‡é é¢é¡å‹');
    return;
}

const formData = {
    FUNC_ID: funcId,
    FUNC_NA: funcName,
    PARENT_ID: parentId || null,
    SORT_NO: sortNo,
    IS_SHOW: isShow,
    MEMO: memo,
    VIEW_H: viewH === '' ? null : viewH,
    VIEW_HB: viewHB === '' ? null : viewHB,
    FUNC_TYPE: funcType // æ–°å¢
};


â¸»

âœ… ä¸‰ã€åœ¨ renderPageListHierarchical() é¡¯ç¤ºä¸åŒåº•è‰²

æ‰¾åˆ°é€™ä¸€æ®µï¼š

// é¡¯ç¤ºå…¶å­é é¢
const children = childPages.filter(c => c.PARENT_ID === parentPage.FUNC_ID);
children.forEach(function (childPage, childIndex) {
    html += renderPageItem(childPage, true, childIndex, children.length, parentPage.FUNC_ID);
});

ä¸æ”¹é€™è£¡ï¼Œè€Œåœ¨ renderPageItem() ä¸­åŠ å…¥åº•è‰²é‚è¼¯ã€‚

åœ¨ return HTML ä¹‹å‰åŠ é€™æ®µï¼ˆåœ¨ function é–‹é ­å€æ®µï¼‰ï¼š

let bgStyle = '';
if (isChild) {
    if (page.FUNC_TYPE === '1') {
        bgStyle = 'background-color:#DFFFD6;'; // ç¶ è‰² tree
    } else if (page.FUNC_TYPE === '2') {
        bgStyle = 'background-color:#E8F5FD;'; // æ·ºè— partialview
    }
}

ç„¶å¾Œä¿®æ”¹åŸæœ¬å›å‚³ HTML çš„æœ€å¤–å±¤ <div class="page-item ..."> åŠ ä¸Š styleï¼š

return `
<div class="page-item ${selectedClass} ${hierarchyClass} ${hiddenClass}"
     style="${bgStyle}"
     onclick="selectPage('${page.FUNC_ID}', '${page.FUNC_NA}', ${isChild})">


â¸»

âœ… å››ã€å¾Œç«¯ FuncModel å·²ç¶“åŠ é FUNC_TYPE (å‰é¢æ•™é)

Controller ä¸ç”¨æ”¹ï¼Œå› ç‚º model ç¶è‡ªå‹•å¸¶ FUNC_TYPEã€‚

â¸»

âœ… äº”ã€å®Œæˆå¾Œæ•ˆæœ

é é¢å±¤ç´š	FUNC_TYPE	é¡è‰²	å‚™è¨»
çˆ¶é é¢	â€”	æ·ºè—ï¼ˆåŸæ¨£ï¼‰	ä¸è®Š
å­é é¢ (Tree)	1	æ·¡ç¶  #DFFFD6	åŠŸèƒ½ä¸»ç•«é¢
å­é é¢ (PartialView)	2	æ·ºè— #E8F5FD	åµŒå…¥é é¢/Modal é¡


â¸»

æ˜¯å¦è¦æˆ‘å¹«ä½ åŠ ä¸Š Modal è£¡ FUNC_TYPE çš„ã€Œä¸‹æ‹‰ä¸­æ–‡é¡¯ç¤ºã€æ”¹æˆæ›´æ˜é¡¯ï¼ˆä¾‹å¦‚ã€ŒTree çµæ§‹é ã€ã€ŒPartialView éƒ¨åˆ†é ã€ï¼‰ï¼Œ
ä¸¦è®“ä¿®æ”¹æ™‚åœ¨ç•«é¢ä¸Šè‡ªå‹•é¡¯ç¤ºå°æ‡‰åº•è‰²é è¦½ï¼Ÿ

éå¸¸å¥½ ğŸ‘
ä½ çš„ GroupManagement å‰ç«¯æ¶æ§‹æˆ‘å®Œå…¨çœ‹æ‡‚äº†ï¼Œ
æˆ‘å€‘è¦åœ¨ã€Œé é¢æ¬Šé™æ¸…å–®ã€é‚£é‚Šï¼ˆrenderPageListHierarchical() / renderPageItem()ï¼‰
æ ¹æ“š FUNC_TYPE ä¾†åšé¡è‰²å€åˆ¥ï¼ˆä¾‹å¦‚ Tree=ç¶ ã€PartialView=è—ï¼‰ï¼Œ
é€™æ¨£åœ¨ç¾¤çµ„ç®¡ç†ç•«é¢ä¹Ÿèƒ½ä¸€çœ¼åˆ†è¾¨ä¸åŒé é¢é¡å‹ã€‚

â¸»

âœ… ä¿®æ”¹é‡é»

æˆ‘å€‘åªéœ€è¦å‹•åˆ°å…©å€‹åœ°æ–¹ï¼š

(1) åœ¨ renderPageItem() ä¸­åŠ ä¸Šåº•è‰²åˆ¤æ–·

æ‰¾åˆ°åŸå§‹çš„ï¼š

function renderPageItem(func, isChild) {
    const funcId = getFuncId(func);
    const funcName = getFuncName(func);

    const hasPermission = groupPermissions[funcId] && groupPermissions[funcId].hasPagePermission;
    const checkedAttr = hasPermission ? 'checked' : '';

    // åˆ¤æ–·æ˜¯å¦ç‚ºçˆ¶å±¤é é¢ä¸¦æ·»åŠ ç›¸æ‡‰æ¨£å¼
    const isParent = isParentPage(func);
    let itemClass = hasPermission ? 'page-item has-permission' : 'page-item';
    if (isParent) {
        itemClass += ' parent-page';
    }

    const childClass = isChild ? 'child-page-item' : '';

ğŸ‘‰ åœ¨é€™æ®µå¾Œé¢åŠ å…¥ï¼š

    // æ ¹æ“š FUNC_TYPE æ±ºå®šåº•è‰²
    let bgStyle = '';
    if (func.FUNC_TYPE === '1') {
        bgStyle = 'background-color:#DFFFD6;'; // Tree â†’ æ·¡ç¶ 
    } else if (func.FUNC_TYPE === '2') {
        bgStyle = 'background-color:#E8F5FD;'; // PartialView â†’ æ·ºè—
    }

ç„¶å¾Œåœ¨å›å‚³çš„ HTML è£¡ï¼ŒæŠŠå¤–å±¤ <div> åŠ ä¸Š style="${bgStyle}"ï¼š

return `
    <div class="${itemClass} ${childClass}" data-func-id="${funcId}"
         style="${bgStyle}"
         onclick="togglePagePermissionByClick('${funcId}')">
        <div class="permission-content">
            <input type="checkbox" class="permission-checkbox" ${checkedAttr}>
            <span class="permission-title">${funcName}</span>
            <span class="permission-info">é é¢ID: ${funcId}</span>
        </div>
    </div>`;


â¸»

(2) ç¢ºä¿ FUNC_TYPE å¾å¾Œç«¯æœ‰è¢«æ’ˆå‡º

åœ¨ loadAllFunctions() ä¸­ï¼Œå¾Œç«¯å›å‚³çš„ response.data æ‡‰è©²å·²åŒ…å« FUNC_TYPEï¼ˆå¦‚æœä½ ä¹‹å‰å·²ç¶“åœ¨ AP_FUNC åŠ äº†é‚£å€‹æ¬„ä½ï¼‰ã€‚
ä¸éœ€ä¿®æ”¹é€™æ®µï¼Œä½†ä½ å¯ä»¥é©—è­‰çœ‹çœ‹ Console logï¼š

console.log(`${index}: ${f.FUNC_ID} - ${f.FUNC_NA} (Type: ${f.FUNC_TYPE}, Parent: ${f.PARENT_ID})`);

ç¢ºèªæœ‰å°å‡º Type=1/2 å³å¯ã€‚

â¸»

âœ… é¡è‰²æ•ˆæœä¸€è¦½

é¡å‹	FUNC_TYPE	é¡è‰²	æ„ç¾©
Tree	1	æ·¡ç¶  #DFFFD6	æ¨¹ç‹€ä¸»è¦é é¢
PartialView	2	æ·ºè— #E8F5FD	åµŒå…¥å­é é¢


â¸»

âœ… å®Œæˆå¾Œæ•ˆæœ
ç¾¤çµ„æ¬Šé™é  â†’ å·¦å´é é¢æ¸…å–®
	â€¢	Tree é¡å‹å­é æœƒé¡¯ç¤ºæ·¡ç¶ è‰²åº•ã€‚
	â€¢	PartialView é¡å‹å­é æœƒé¡¯ç¤ºæ·¡è—è‰²åº•ã€‚
	â€¢	çˆ¶å±¤ï¼ˆHome å±¤ï¼‰ä¿æŒåŸæ¨£ã€‚

â¸»

æ˜¯å¦å¸Œæœ›æˆ‘å¹«ä½ åŠ ä¸€å€‹ legendï¼ˆå°æç¤ºï¼‰åœ¨é é¢ä¸Šæ–¹ï¼Œä¾‹å¦‚é¡¯ç¤ºï¼š

ğŸŸ© Tree é é¢â€ƒğŸŸ¦ PartialView é é¢
é€™æ¨£æ–¹ä¾¿è¾¨è­˜ï¼Ÿ