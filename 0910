好的，我幫你把「取得員工主檔 GetEmpMast」一次改好：
新增參數 Type、EmpNoList，並在 Factory 依 Type 做對應的 SQL 篩選。下面直接給你可用的完整程式碼（主類別、Model、Factory 三份）。

⸻

1) APACCESS 主類別 – 方法改版

// APACCESS.cs 內
public string GetEmpMast(string requestJson)
{
    var response = new GetEmpMastModel.GetEmpMastResponse();

    try
    {
        var request = JsonConvert.DeserializeObject<GetEmpMastModel.GetEmpMastRequest>(requestJson);

        // 參數基本檢核
        if (request == null)
        {
            response.Result_code = Common.Codes.PARAM_ERROR;
            response.Msg = "參數格式錯誤";
            return JsonConvert.SerializeObject(response);
        }
        if (request.Environment != "TEST" && request.Environment != "PROD" && request.Environment != "DEV")
        {
            response.Result_code = Common.Codes.ENV_ERROR;
            response.Msg = "環境錯誤，只接受 TEST、PROD、DEV";
            return JsonConvert.SerializeObject(response);
        }
        if (request.Type != "1" && request.Type != "2" && request.Type != "3")
        {
            response.Result_code = Common.Codes.PARAM_ERROR;
            response.Msg = "Type 只接受 1/2/3";
            return JsonConvert.SerializeObject(response);
        }
        if (request.Type == "3" && (request.EmpNoList == null || request.EmpNoList.Count == 0))
        {
            response.Result_code = Common.Codes.PARAM_ERROR;
            response.Msg = "Type=3 時 EmpNoList 不可為空";
            return JsonConvert.SerializeObject(response);
        }

        var func = new FGetEmpMast();
        response = func.Execute(request.Type, request.EmpNoList, request.Environment);
    }
    catch (Exception ex)
    {
        response = new GetEmpMastModel.GetEmpMastResponse
        {
            Result_code = Common.Codes.SYSTEM_ERROR,
            Msg = "系統錯誤：" + ex.Message
        };
    }

    return JsonConvert.SerializeObject(response);
}


⸻

2) Model – 加上 Type、EmpNoList

using Newtonsoft.Json;
using System.Collections.Generic;
using System.ComponentModel;

namespace HI_APACCESS_DLL.Models
{
    internal class GetEmpMastModel
    {
        // 請求參數 
        internal class GetEmpMastRequest
        {
            [JsonProperty]
            [DisplayName("查詢類型")] // 1:全部(在職+離職)  2:在職  3:指定名單
            internal string Type { get; set; }

            [JsonProperty]
            [DisplayName("指定名單")]  // 僅 Type=3 需要
            internal List<string> EmpNoList { get; set; }

            [JsonProperty]
            [DisplayName("環境")]
            internal string Environment { get; set; }
        }

        // 回應結果
        internal class GetEmpMastResponse
        {
            [JsonProperty]
            [DisplayName("回覆代碼")]
            internal string Result_code { get; set; }

            [JsonProperty]
            [DisplayName("訊息")]
            internal string Msg { get; set; }

            [JsonProperty("Result")]
            [DisplayName("回覆結果")]
            public List<ResultData> Result { get; set; }
        }

        public class ResultData
        {
            [JsonProperty] public string EmpNo { get; set; }
            [JsonProperty] public string EmpName { get; set; }
            [JsonProperty] public string OrganNo { get; set; }
            [JsonProperty] public string OrganName { get; set; }
            [JsonProperty] public string PostNo { get; set; }
            [JsonProperty] public string PostName { get; set; }
            [JsonProperty] public string EnterDate { get; set; }
            [JsonProperty] public string EndDate { get; set; }
        }
    }
}


⸻

3) Factory – 依 Type 組條件、參數化 IN 子句

資料表我以你們一貫使用的人事主檔為準：[HILIFE_DB3].[DB_SHARE].dbo.[M1EMP_MAST]
如果你確定要用別的 schema，只要改 FROM 那一行即可。

using HI_APACCESS_DLL.Models;
using Microsoft.Data.SqlClient;
using System;
using System.Collections.Generic;
using System.Linq;

namespace HI_APACCESS_DLL.Factory
{
    internal class FGetEmpMast
    {
        internal GetEmpMastModel.GetEmpMastResponse Execute(
            string type, List<string> empNoList, string environment)
        {
            var response = new GetEmpMastModel.GetEmpMastResponse();

            try
            {
                // 1. 環境檢查
                if (environment != "TEST" && environment != "PROD" && environment != "DEV")
                {
                    response.Result_code = Common.Codes.ENV_ERROR;
                    response.Msg = "環境錯誤，只接受 TEST、PROD、DEV";
                    return response;
                }

                var resultList = new List<GetEmpMastModel.ResultData>();

                using (SqlConnection conn = new SqlConnection(FCommon.BuildConnectionString(environment)))
                {
                    conn.Open();

                    // 基本 SELECT
                    var sql = @"
SELECT 
    M.[EMP_NO]     AS EmpNo,
    M.[EMP_NAME]   AS EmpName,
    M.[ORGAN_NO]   AS OrganNo,
    M.[ORGAN_CAP]  AS OrganName,
    M.[POST_NO]    AS PostNo,
    M.[POST_NAME]  AS PostName,
    M.[ENTER_DT]   AS EnterDate,
    M.[END_DT]     AS EndDate
FROM [HILIFE_DB3].[DB_SHARE].dbo.[M1EMP_MAST] M
WHERE 1=1
";

                    var cmd = new SqlCommand();
                    cmd.Connection = conn;

                    // 依 Type 增加條件
                    switch (type)
                    {
                        case "1": // 全部（在職+離職）→ 不加條件
                            break;

                        case "2": // 在職（無 EndDate）
                            sql += @"
AND (M.[END_DT] IS NULL OR LTRIM(RTRIM(M.[END_DT])) = '')
";
                            break;

                        case "3": // 指定名單
                            if (empNoList == null || empNoList.Count == 0)
                            {
                                response.Result_code = Common.Codes.PARAM_ERROR;
                                response.Msg = "Type=3 時 EmpNoList 不可為空";
                                return response;
                            }

                            // 清理名單（去空白、轉大寫、去重複）
                            var cleaned = empNoList
                                .Where(s => !string.IsNullOrWhiteSpace(s))
                                .Select(s => s.Trim().ToUpper())
                                .Distinct()
                                .ToList();

                            if (cleaned.Count == 0)
                            {
                                response.Result_code = Common.Codes.PARAM_ERROR;
                                response.Msg = "EmpNoList 內容為空";
                                return response;
                            }

                            // 參數化 IN 子句
                            var inParams = new List<string>();
                            for (int i = 0; i < cleaned.Count; i++)
                            {
                                string p = $"@EMP{i}";
                                inParams.Add(p);
                                cmd.Parameters.AddWithValue(p, cleaned[i]);
                            }
                            sql += $" AND M.[EMP_NO] IN ({string.Join(",", inParams)})";
                            break;

                        default:
                            response.Result_code = Common.Codes.PARAM_ERROR;
                            response.Msg = "Type 只接受 1/2/3";
                            return response;
                    }

                    // 排序（可自行調整）
                    sql += " ORDER BY M.[EMP_NO]";

                    cmd.CommandText = sql;

                    using (var reader = cmd.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            resultList.Add(new GetEmpMastModel.ResultData
                            {
                                EmpNo     = reader["EmpNo"]?.ToString(),
                                EmpName   = reader["EmpName"]?.ToString(),
                                OrganNo   = reader["OrganNo"]?.ToString(),
                                OrganName = reader["OrganName"]?.ToString(),
                                PostNo    = reader["PostNo"]?.ToString(),
                                PostName  = reader["PostName"]?.ToString(),
                                EnterDate = reader["EnterDate"]?.ToString(),
                                EndDate   = reader["EndDate"]?.ToString(),
                            });
                        }
                    }
                }

                if (resultList.Count == 0)
                {
                    response.Result_code = Common.Codes.NO_DATA;
                    response.Msg = "查無資料";
                }
                else
                {
                    response.Result_code = Common.Codes.SUCCESS;
                    response.Msg = "成功";
                    response.Result = resultList;
                }
            }
            catch (Exception ex)
            {
                response.Result_code = Common.Codes.SYSTEM_ERROR;
                response.Msg = "系統錯誤：" + ex.Message;
            }

            return response;
        }
    }
}


⸻

使用範例（給 WinForm / 測試工具）
	•	取全部（在職+離職）

{
  "Type": "1",
  "EmpNoList": null,
  "Environment": "TEST"
}

	•	取在職

{
  "Type": "2",
  "EmpNoList": null,
  "Environment": "TEST"
}

	•	取指定人員

{
  "Type": "3",
  "EmpNoList": ["3B750","3A717"],
  "Environment": "TEST"
}


⸻

如果你要把表名改回你們另一個 schema（例如之前某些程式是用 [HI-AUTOS].[dbo].[M1EMP_MAST]），只要在 Factory 把 FROM 那行換掉就好，其他不用動。