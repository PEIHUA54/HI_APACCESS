æ˜ç™½äº† ğŸ‘
å¦‚æœä½ çš„ Model ä¸æƒ³å…±ç”¨ DLL è£¡é¢çš„ M_APï¼Œè€Œæ˜¯è¦ç¨ç«‹å»ºç«‹åœ¨ HI_APACCESS_DLL_TEST WinForm å°ˆæ¡ˆè£¡ï¼Œé‚£æˆ‘å€‘å°±ç›´æ¥åœ¨ WinForm å°ˆæ¡ˆ å»ºä¸€å€‹ Models è³‡æ–™å¤¾ï¼ŒæŠŠæ‰€æœ‰ ä¸ƒå€‹åŠŸèƒ½çš„ Request/Response å„è‡ªå®šç¾©å‡ºä¾†ã€‚

â¸»

ğŸ“‚ çµæ§‹

HI_APACCESS_DLL_TEST
 â”£ Models
 â”ƒ â”— ApiModels.cs   â† å…¨éƒ¨çš„ Model æ”¾é€™è£¡
 â”£ Form1.cs
 â”£ Form2.cs


â¸»

ğŸ“Œ ApiModels.cs

using System.Collections.Generic;

namespace HI_APACCESS_DLL_TEST.Models
{
    public class ApiModels
    {
        // åŠŸèƒ½ 1: GetUserNameAndGroup
        public class GetUserNameAndGroupRequest
        {
            public string SysID { get; set; }
            public string UserAD { get; set; }
            public string Environment { get; set; }
        }

        public class GetUserNameAndGroupResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public ResultData Result { get; set; }

            public class ResultData
            {
                public string UserID { get; set; }
                public string UserName { get; set; }
                public string PostName { get; set; }
                public string OrganName { get; set; }
                public string GroupID { get; set; }
            }
        }

        // åŠŸèƒ½ 2: GetGroupAllUser
        public class GetGroupAllUserRequest
        {
            public string SysID { get; set; }
            public string GroupID { get; set; }
            public bool IsIncludeChildGroups { get; set; }
            public string Environment { get; set; }
        }

        public class GetGroupAllUserResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public List<ResultData> Result { get; set; }

            public class ResultData
            {
                public string UserID { get; set; }
                public string UserName { get; set; }
            }
        }

        // åŠŸèƒ½ 3: GetTree
        public class GetTreeRequest
        {
            public string SysID { get; set; }
            public string GroupID { get; set; }
            public string Environment { get; set; }
        }

        public class GetTreeResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public List<ResultData> Result { get; set; }

            public class ResultData
            {
                public string FuncID { get; set; }
                public string FuncName { get; set; }
                public string Controller { get; set; }
                public string Action { get; set; }
                public int Sort { get; set; }
                public string ParentID { get; set; }
                public string Level { get; set; }
                public string Memo { get; set; }
            }
        }

        // åŠŸèƒ½ 4: GetFuncBtn
        public class GetFuncBtnRequest
        {
            public string SysID { get; set; }
            public string GroupID { get; set; }
            public string FuncID { get; set; }
            public string Environment { get; set; }
        }

        public class GetFuncBtnResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public List<ResultData> Result { get; set; }

            public class ResultData
            {
                public string BtnID { get; set; }
                public string BtnName { get; set; }
                public string Controller { get; set; }
                public string Action { get; set; }
                public string BtnLocation { get; set; }
                public string BtnOnclick { get; set; }
            }
        }

        // åŠŸèƒ½ 5: CheckBtnEnabled
        public class CheckBtnEnabledRequest
        {
            public string SysID { get; set; }
            public string GroupID { get; set; }
            public string FuncID { get; set; }
            public string BtnID { get; set; }
            public string Environment { get; set; }
        }

        public class CheckBtnEnabledResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public bool Result { get; set; }
        }

        // åŠŸèƒ½ 6: GetFunctionAndAccessUrl
        public class GetFunctionAndAccessUrlRequest
        {
            public string SysID { get; set; }
            public string UserAD { get; set; }
            public string Environment { get; set; }
        }

        public class GetFunctionAndAccessUrlResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public string Url { get; set; }
        }

        // åŠŸèƒ½ 7: GetAllUser
        public class GetAllUserRequest
        {
            public string SysID { get; set; }
            public string Environment { get; set; }
        }

        public class GetAllUserResponse
        {
            public string Result_code { get; set; }
            public string Msg { get; set; }
            public List<ResultData> Result { get; set; }

            public class ResultData
            {
                public string UserID { get; set; }
                public string UserName { get; set; }
            }
        }
    }
}


â¸»

ğŸ“Œ Form1.cs ä½¿ç”¨æ–¹å¼

åœ¨ Form1.cs ä½ å°±æ”¹æˆå¼•ç”¨ WinForm å°ˆæ¡ˆå…§çš„ Modelï¼š

using HI_APACCESS_DLL_TEST.Models; // æ”¹æˆè‡ªå·±å°ˆæ¡ˆ Models

ç„¶å¾Œå‘¼å«æ™‚ç”¨ï¼š

var req = new ApiModels.GetAllUserRequest
{
    SysID = txtSysID.Text,
    Environment = txtEnv.Text
};

string json_input = JsonConvert.SerializeObject(req, Formatting.Indented);
string json_output = new APACCESS().GetAllUser(json_input);

var res = JsonConvert.DeserializeObject<ApiModels.GetAllUserResponse>(json_output);


â¸»

âœ… é€™æ¨£ä½ çš„ Model å®Œå…¨ç¨ç«‹åœ¨ WinForm å°ˆæ¡ˆï¼Œä¸æœƒä¾è³´ DLL å…§å»ºçš„ M_APã€‚
âœ… Result éƒ½æ˜¯ List<T>ï¼Œæ‰€ä»¥ååºåˆ—åŒ–ä¸æœƒå†å™´éŒ¯ã€‚

â¸»

è¦ä¸è¦æˆ‘å¹«ä½ æŠŠ Form1.cs ä¸ƒå€‹æŒ‰éˆ•éƒ½å¥—ä¸Šé€™å€‹ ApiModels çš„å®Œæ•´ç¨‹å¼ç¢¼ï¼Ÿ

å¥½ ğŸ‘ é‚£æˆ‘ç›´æ¥å¹«ä½ æŠŠ Form1.cs ä¸ƒå€‹æŒ‰éˆ•éƒ½æ”¹æˆç”¨ä½  WinForm å°ˆæ¡ˆè‡ªå·±å®šç¾©çš„ ApiModelsã€‚
é€™æ¨£æ¯å€‹æŒ‰éˆ•æŒ‰ä¸‹å»éƒ½æœƒåºåˆ—åŒ– Request â†’ å‘¼å« DLL â†’ ååºåˆ—åŒ– Response â†’ ä¸Ÿåˆ° Form2 é¡¯ç¤ºã€‚

â¸»

ğŸ“Œ Form1.cs (å®Œæ•´ç‰ˆç¯„ä¾‹)

using HI_APACCESS_DLL;                // DLL
using HI_APACCESS_DLL_TEST.Models;    // ä½ åœ¨ WinForm è£¡å»ºçš„ ApiModels
using Newtonsoft.Json;
using System;
using System.Windows.Forms;

namespace HI_APACCESS_DLL_TEST
{
    public partial class Form1 : Form
    {
        private APACCESS ARC = new APACCESS(); // DLL ä¸»é¡åˆ¥

        public Form1()
        {
            InitializeComponent();
        }

        // åŠŸèƒ½1: GetUserNameAndGroup
        private void btnGetUserData_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.GetUserNameAndGroupRequest
            {
                SysID = txtSysID.Text,
                UserAD = txtUserAD.Text,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.GetUserNameAndGroup<ApiModels.GetUserNameAndGroupResponse>);
        }

        // åŠŸèƒ½2: GetGroupAllUser
        private void btnGetGroupAllUser_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.GetGroupAllUserRequest
            {
                SysID = txtSysID.Text,
                GroupID = txtGroupID.Text,
                IsIncludeChildGroups = chkChildGroup.Checked,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.GetGroupAllUser<ApiModels.GetGroupAllUserResponse>);
        }

        // åŠŸèƒ½3: GetTree
        private void btnGetTree_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.GetTreeRequest
            {
                SysID = txtSysID.Text,
                GroupID = txtGroupID.Text,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.GetTree<ApiModels.GetTreeResponse>);
        }

        // åŠŸèƒ½4: GetFuncBtn
        private void btnGetFuncBtn_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.GetFuncBtnRequest
            {
                SysID = txtSysID.Text,
                GroupID = txtGroupID.Text,
                FuncID = txtFuncID.Text,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.GetFuncBtn<ApiModels.GetFuncBtnResponse>);
        }

        // åŠŸèƒ½5: CheckBtnEnabled
        private void btnCheckBtnEnabled_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.CheckBtnEnabledRequest
            {
                SysID = txtSysID.Text,
                GroupID = txtGroupID.Text,
                FuncID = txtFuncID.Text,
                BtnID = txtBtnID.Text,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.CheckBtnEnabled<ApiModels.CheckBtnEnabledResponse>);
        }

        // åŠŸèƒ½6: GetFunctionAndAccessUrl
        private void btnGetFunctionAndAccessUrl_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.GetFunctionAndAccessUrlRequest
            {
                SysID = txtSysID.Text,
                UserAD = txtUserAD.Text,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.GetFunctionAndAccessUrl<ApiModels.GetFunctionAndAccessUrlResponse>);
        }

        // åŠŸèƒ½7: GetAllUser
        private void btnGetAllUser_Click(object sender, EventArgs e)
        {
            var req = new ApiModels.GetAllUserRequest
            {
                SysID = txtSysID.Text,
                Environment = txtEnv.Text
            };

            RunApi(req, ARC.GetAllUser<ApiModels.GetAllUserResponse>);
        }

        // é€šç”¨åŸ·è¡Œ API çš„æ–¹æ³•
        private void RunApi<TReq, TRes>(TReq req, Func<string, string> apiMethod)
        {
            string json_input = JsonConvert.SerializeObject(req, Formatting.Indented);
            string json_output = apiMethod(json_input);

            var res = JsonConvert.DeserializeObject<TRes>(json_output);

            Form2 obj = new Form2
            {
                TextBoxMsg1 = json_input,
                TextBoxMsg2 = json_output
            };
            obj.Show();
        }
    }
}


â¸»

ğŸ“Œ èªªæ˜
	1.	RunApi<TReq, TRes> æ˜¯å…±ç”¨æ–¹æ³•ï¼š
	â€¢	æŠŠ Request è½‰æˆ JSON
	â€¢	å‘¼å« DLL
	â€¢	é¡¯ç¤º Request/Response åœ¨ Form2
	2.	æ¯å€‹æŒ‰éˆ•åªè¦å»ºç«‹ Request Model â†’ ä¸Ÿçµ¦ RunApiã€‚
	3.	Form2 åªè¦æœ‰å…©å€‹ TextBox (TextBoxMsg1, TextBoxMsg2) å°±å¯ä»¥ç›´æ¥çœ‹åˆ° Request å’Œ Responseã€‚

â¸»

è¦ä¸è¦æˆ‘å¹«ä½ æŠŠ Form2.cs ä¹Ÿç”Ÿå‡ºä¾†ï¼Œè®“å®ƒå¯ä»¥ç›´æ¥é¡¯ç¤º Request / Responseï¼Ÿ
