 #region AD、員編

        /// <summary>
        /// 權限管理-取得員工AD
        /// </summary>
        /// <returns>AD</returns>
        internal static string Get_員工AD()
        {
            string EMP_DOM_ID = System.Web.HttpContext.Current.User.Identity.Name.Substring(System.Web.HttpContext.Current.User.Identity.Name.LastIndexOf("\\") + 1);

            if (String.IsNullOrEmpty(EMP_DOM_ID))
            {
                System.Security.Principal.WindowsPrincipal principal = new System.Security.Principal.WindowsPrincipal(System.Security.Principal.WindowsIdentity.GetCurrent());
                string name = principal.Identity.Name;
                string[] adname = name.Split(new string[] { "\\" }, StringSplitOptions.RemoveEmptyEntries);
                EMP_DOM_ID = adname[1].ToString().ToUpper();
            }

            return EMP_DOM_ID;
        }

        /// <summary>
        /// 權限管理-取得員工編號
        /// </summary>
        /// <returns>員編</returns>
        internal static string Get_員工編號(string AD = null)
        {
            string EMP_NO = string.IsNullOrEmpty(AD) ? Get_員工AD() : AD;
            //AD轉換為員編
            EMP_NO = GetEmpNoByAD(EMP_NO);
            return EMP_NO;
        }

        /// <summary>
        /// AD轉換為員編
        /// </summary>
        /// <param name="AD">取得工作站登入AD</param>
        /// <returns>員編</returns>
        private static string GetEmpNoByAD(string AD)
        {
            string EMP_NO = null;
            string sql = "SELECT EMP_ID FROM [HILIFE_MTS].[HI_APUSER].dbo.[NT_EMP] " +
                "WHERE EMP_ID!= EMP_DOM_ID " +
                "AND LTRIM(RTRIM(EMP_DOM_ID)) != '' " +
                "AND EMP_ID IN (SELECT EMP_NO AS 'EMP_ID' FROM [HILIFE_DB3].[DB_SHARE].dbo.[M1EMP_MAST] WHERE END_DT IS NULL) " +
                "AND EMP_DOM_ID = @AD ";
            List<SqlParameter> paras = new List<SqlParameter>
            {
                new SqlParameter("@AD",AD)
            };
            DataTable table = new SVS_DBmanager().QueryBySQL(sql, paras);
            if (table.Rows.Count > 0)
            {
                EMP_NO = table.Rows[0]["EMP_ID"].ToString();
            }

            EMP_NO = String.IsNullOrEmpty(EMP_NO) ? AD : EMP_NO;
            return EMP_NO;
        }

        #endregion AD、員編

        /// <summary>
        /// 取得員工基本資料
        /// </summary>
        /// <param name="Emp_NO">員編</param>
        /// <returns></returns>
        internal static VM_Employee.VM_員工部門職稱 Get_員工基本資料(string Emp_NO)
        {
            string SQLStrings = @"

  SELECT EMP_NO,EMP_NAME,ORGAN_NO,ORGAN_CAP,POST_NO,POST_NAME,APG_NO 
  FROM DB_SHARE.DBO.M1EMP_MAST M 
  LEFT JOIN(SELECT U_ID, APG_NO, U_NAME FROM AP_USER WHERE SYS_ID = @SYS_ID AND U_ID = @EMP_NO) A
  ON M.EMP_NO = A.U_ID 
  WHERE EMP_NO = @EMP_NO
";
            List<SqlParameter> Paras = new List<SqlParameter>()
            {
                new SqlParameter("@SYS_ID","HI_APACCESS"),
                new SqlParameter("@EMP_NO",Get_員工編號(Emp_NO)),
            };
            DataTable table = new SVS_DBmanager().QueryBySQL(SQLStrings, Paras);

            //員編姓名
            List<VM_Employee.VM_員工部門職稱> list_所有員編姓名 = new List<VM_Employee.VM_員工部門職稱>();
            if (table != null && table.Rows.Count > 0)
            {
                list_所有員編姓名 = SVS_DBmanager.ConvertToList<VM_Employee.VM_員工部門職稱>(table);
            }
            return list_所有員編姓名.AsEnumerable().FirstOrDefault();
        }
