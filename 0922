我幫你把目前的重點逐條檢查，因為你說還是 0 筆匯入成功，代表 Excel → 臨時表 (#TEMP_IMPORT) 這段沒有資料進來。

⸻

1️⃣ Extended Properties 是否正確？

你現在的檔案是 批次匯入使用者範本.xlsx，工作表名稱是 DATA。
那 SQL 必須是這樣：

FROM OpenDataSource(
    'Microsoft.ACE.OLEDB.12.0',
    'Data Source=' + REPLACE(@filePath, '''', '''''') + ';
    Extended properties="Excel 12.0 Xml;HDR=YES"'
)...[DATA$] AS t

👉 確認 Xml、HDR=YES 都有加上。
如果還是 Excel 12.0 沒有 Xml，就一定會讀不到 .xlsx。

⸻

2️⃣ Excel 檔案表頭

你說表頭已經改成 「員工編號」，所以 SQL 的 SELECT 是：

SELECT CAST(t.[員工編號] AS VARCHAR(20))

⚠️ 注意：表頭必須完全一樣，不能有空白、隱藏字元。
建議你開 Excel，按 F2 編輯那個欄位，看是不是其實是 "員工編號 "（多了一個全形/半形空格）。

⸻

3️⃣ Excel 檔案儲存格型別

OLEDB 讀 Excel 的時候，會「猜型別」，如果前幾列是空白或文字，OLEDB 會把整欄判成 NULL。
例如：
	•	如果前 8 列都是空的，第 9 列才有員工編號 → 可能整欄都被當 NULL。
	•	如果有人員工編號是 000123 → 可能被轉成 123。

✅ 解法：
在 SQL 的 WHERE 裡面你已經寫：

WHERE t.[員工編號] IS NOT NULL AND t.[員工編號] <> ''

這是對的，但建議把 CAST 拿掉，先直接塞進去看看：

SELECT t.[員工編號]

這樣比較容易 debug。

⸻

4️⃣ Debug 方法

我建議你先在 SQL Server Management Studio 裡，直接執行下面這段：

SELECT *
FROM OpenDataSource(
    'Microsoft.ACE.OLEDB.12.0',
    'Data Source=C:\你的路徑\批次匯入使用者範本.xlsx;
    Extended properties="Excel 12.0 Xml;HDR=YES"'
)...[DATA$]

👉 看看能不能真的抓到資料。
如果這邊都沒有東西，那問題就是 Excel 檔案本身（表頭或格式）。

⸻

5️⃣ 你的 SQL 結構

你現在 BuildUserImportSql() 裡面的邏輯本身沒問題，流程是：
	1.	建 #TEMP_IMPORT
	2.	用 OLEDB 匯入 Excel
	3.	檢查員工是否存在 (VW_M1EMP_MAST)
	4.	檢查是否已存在群組 (AP_USER)
	5.	插入 AP_USER
	6.	回傳成功/失敗筆數

這一整段唯一會導致 **「0 筆成功匯入」**的，就是 Step 2 匯入失敗（但沒進 CATCH 區塊）。

⸻

✅ 我建議你：
先照 Step 4 在 SSMS 裡跑 OpenDataSource，確定能抓到 員工編號 的值。

要不要我直接幫你修改 BuildUserImportSql()，讓它在匯入完 #TEMP_IMPORT 之後，先 SELECT * FROM #TEMP_IMPORT 出來，方便你看到 Excel 到底有沒有被讀進來？