å¥½çš„!ä½ æ˜¯å…§éƒ¨ç³»çµ±å¯ä»¥ç”¨ EPPlus å…è²»ç‰ˆ,è€Œä¸”è¦ç”¨**æˆæ¬Šç¢¼ç•¶ä½œ Excel çš„é–‹å•Ÿå¯†ç¢¼**ã€‚

-----

## ğŸ” å®Œæ•´å¯¦ä½œæ–¹æ¡ˆ

### ğŸ“‹ éœ€æ±‚ç¢ºèª:

1. âœ… ä½¿ç”¨ HI_CODEGUARD_DLL ç”¢ç”Ÿ8ç¢¼æˆæ¬Šç¢¼
1. âœ… æˆæ¬Šç¢¼ = Excel é–‹å•Ÿå¯†ç¢¼
1. âœ… ä½¿ç”¨è€…å¿…é ˆè¼¸å…¥æˆæ¬Šç¢¼æ‰èƒ½é–‹å•Ÿ Excel
1. âœ… æˆæ¬Šç¢¼é¡¯ç¤ºåœ¨ Modal ä¸­

-----

## ğŸ“ å®Œæ•´ç¨‹å¼ç¢¼

### 1. Controller (å·²ç¶“æ­£ç¢ºäº†!)

```csharp
using OfficeOpenXml;
using System;
using System.Collections.Generic;
using System.IO;
using System.Web.Mvc;
using HI_CODEGUARD_DLL;
using Newtonsoft.Json;

#region åŒ¯å‡ºå¸³è™Ÿæ¸…å–®

/// <summary>
/// åŒ¯å‡ºå¸³è™Ÿæ¸…å–® (ExcelåŠ å¯† - ä½¿ç”¨ EPPlus)
/// </summary>
[HttpGet]
public ActionResult ExportUserList()
{
    try
    {
        string systemId = Session["CurrentSystemId"] as string;

        // 1. ç”¢ç”Ÿæˆæ¬Šç¢¼ (é€™å€‹æˆæ¬Šç¢¼å°±æ˜¯ Excel çš„å¯†ç¢¼)
        CODE_GUARD codeGuard = new CODE_GUARD();
        string getCodeRequest = JsonConvert.SerializeObject(new
        {
            SysID = systemId,
            Data = this.Emp_NO,
            CodeLength = 8
        });

        string getCodeResponse = codeGuard.GetCode(getCodeRequest);
        dynamic codeResult = JsonConvert.DeserializeObject(getCodeResponse);

        if (codeResult.Result_code != "0000")
        {
            return Content($"<script>alert('ç”¢ç”Ÿæˆæ¬Šç¢¼å¤±æ•—: {codeResult.Msg}'); window.history.back();</script>", "text/html");
        }

        string authCode = codeResult.Code.ToString();

        // 2. å–å¾—å¸³è™Ÿæ¸…å–®
        var service = GetAPService();
        var userList = service.GetAllUsersForExport(systemId);

        if (userList == null || userList.Count == 0)
        {
            return Content("<script>alert('æŸ¥ç„¡è³‡æ–™'); window.history.back();</script>", "text/html");
        }

        // 3. ç”¢ç”ŸåŠ å¯† Excel (ä½¿ç”¨æˆæ¬Šç¢¼ä½œç‚ºå¯†ç¢¼)
        string fileName = $"{DateTime.Now:yyyyMMddHHmmss}_åŒ¯å‡ºå¸³è™Ÿæ¸…å–®";
        byte[] excelBytes = CreateEncryptedExcelWithEPPlus(userList, systemId, authCode);

        // 4. å„²å­˜è¨˜éŒ„åˆ°è³‡æ–™åº«
        var recordModel = new CodeGuardRecordModel
        {
            FILE_NAME = fileName,
            CODE_GUARD = authCode,
            CREATOR = this.Emp_NO,
            SYS_ID = systemId
        };

        service.SaveCodeGuardRecord(recordModel);

        // 5. åˆªé™¤è¶…é3å€‹æœˆçš„èˆŠè¨˜éŒ„
        service.DeleteOldRecords();

        // 6. å„²å­˜æˆæ¬Šç¢¼åˆ° TempData (ä¾›å‰ç«¯é¡¯ç¤º)
        TempData["AuthCode"] = authCode;
        TempData["FileName"] = fileName;

        // 7. å›å‚³åŠ å¯†çš„ Excel æª”æ¡ˆ
        return File(excelBytes, "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            $"{fileName}.xlsx");
    }
    catch (Exception ex)
    {
        return Content($"<script>alert('åŒ¯å‡ºå¤±æ•—: {ex.Message}'); window.history.back();</script>", "text/html");
    }
}

/// <summary>
/// ä½¿ç”¨ EPPlus å»ºç«‹åŠ å¯† Excel (æˆæ¬Šç¢¼ = Excel å¯†ç¢¼)
/// </summary>
private byte[] CreateEncryptedExcelWithEPPlus(List<UserExportModel> userList, string systemId, string password)
{
    // è¨­å®š EPPlus æˆæ¬Š (éå•†æ¥­ç”¨é€”)
    ExcelPackage.LicenseContext = LicenseContext.NonCommercial;

    using (var package = new ExcelPackage())
    {
        // å»ºç«‹å·¥ä½œè¡¨
        var worksheet = package.Workbook.Worksheets.Add("å¸³è™Ÿæ¸…å–®");

        // è¨­å®šæ¨™é¡Œåˆ—
        var headers = new string[] 
        { 
            "ç³»çµ±", "å¸³è™Ÿ", "å§“å", "ç¾¤çµ„ä»£è™Ÿ", "ç¾¤çµ„åç¨±",
            "éƒ¨é–€ä»£è™Ÿ", "éƒ¨é–€åç¨±", "å»ºç«‹äººå“¡", "å»ºç«‹æ—¥æœŸ", "ä¿®æ”¹äººå“¡", "ä¿®æ”¹æ—¥æœŸ" 
        };

        for (int i = 0; i < headers.Length; i++)
        {
            worksheet.Cells[1, i + 1].Value = headers[i];
        }

        // æ¨™é¡Œåˆ—æ¨£å¼
        using (var range = worksheet.Cells[1, 1, 1, headers.Length])
        {
            range.Style.Font.Bold = true;
            range.Style.Font.Size = 11;
            range.Style.Font.Name = "å¾®è»Ÿæ­£é»‘é«”";
            range.Style.Fill.PatternType = OfficeOpenXml.Style.ExcelFillStyle.Solid;
            range.Style.Fill.BackgroundColor.SetColor(System.Drawing.Color.LightGray);
            range.Style.HorizontalAlignment = OfficeOpenXml.Style.ExcelHorizontalAlignment.Center;
            range.Style.VerticalAlignment = OfficeOpenXml.Style.ExcelVerticalAlignment.Center;
            range.Style.Border.Top.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
            range.Style.Border.Bottom.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
            range.Style.Border.Left.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
            range.Style.Border.Right.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
        }

        // å¡«å…¥è³‡æ–™
        int row = 2;
        foreach (var user in userList)
        {
            worksheet.Cells[row, 1].Value = systemId;
            worksheet.Cells[row, 2].Value = user.U_ID;
            worksheet.Cells[row, 3].Value = user.U_NAME;
            worksheet.Cells[row, 4].Value = user.APG_NO;
            worksheet.Cells[row, 5].Value = user.APG_NAME;
            worksheet.Cells[row, 6].Value = user.ORGAN_NO;
            worksheet.Cells[row, 7].Value = user.ORGAN_CAP;
            worksheet.Cells[row, 8].Value = user.CREATOR;
            worksheet.Cells[row, 9].Value = user.CREATE_TIME;
            worksheet.Cells[row, 10].Value = user.EDITOR;
            worksheet.Cells[row, 11].Value = user.EDIT_TIME;

            // è³‡æ–™åˆ—æ¨£å¼
            using (var dataRange = worksheet.Cells[row, 1, row, headers.Length])
            {
                dataRange.Style.Font.Name = "å¾®è»Ÿæ­£é»‘é«”";
                dataRange.Style.VerticalAlignment = OfficeOpenXml.Style.ExcelVerticalAlignment.Center;
                dataRange.Style.Border.Top.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
                dataRange.Style.Border.Bottom.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
                dataRange.Style.Border.Left.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
                dataRange.Style.Border.Right.Style = OfficeOpenXml.Style.ExcelBorderStyle.Thin;
            }

            row++;
        }

        // è‡ªå‹•èª¿æ•´æ¬„å¯¬
        worksheet.Cells[worksheet.Dimension.Address].AutoFitColumns();
        
        // åŠ ä¸€é»é¡å¤–å¯¬åº¦
        for (int i = 1; i <= headers.Length; i++)
        {
            worksheet.Column(i).Width += 2;
        }

        // å‡çµé¦–åˆ—
        worksheet.View.FreezePanes(2, 1);

        // â­â­â­ é—œéµ:ä½¿ç”¨æˆæ¬Šç¢¼ä½œç‚º Excel é–‹å•Ÿå¯†ç¢¼ â­â­â­
        package.Encryption.Password = password;

        // è½‰æ›æˆ byte array
        return package.GetAsByteArray();
    }
}

/// <summary>
/// å–å¾—æˆæ¬Šç¢¼è³‡è¨Š (Ajax)
/// </summary>
[HttpGet]
public JsonResult GetAuthCodeInfo()
{
    try
    {
        if (TempData["AuthCode"] != null && TempData["FileName"] != null)
        {
            var authCode = TempData["AuthCode"].ToString();
            var fileName = TempData["FileName"].ToString();

            // ä¿ç•™ TempData ä¾›ä¸‹æ¬¡ä½¿ç”¨
            TempData.Keep("AuthCode");
            TempData.Keep("FileName");

            return Json(new
            {
                success = true,
                authCode = authCode,
                fileName = fileName
            }, JsonRequestBehavior.AllowGet);
        }

        return Json(new { success = false }, JsonRequestBehavior.AllowGet);
    }
    catch (Exception ex)
    {
        return Json(new { success = false, message = ex.Message }, JsonRequestBehavior.AllowGet);
    }
}

/// <summary>
/// å–å¾—åŒ¯å‡ºè¨˜éŒ„ (Ajax)
/// </summary>
[HttpGet]
public JsonResult GetExportRecords()
{
    try
    {
        string systemId = Session["CurrentSystemId"] as string;

        var service = GetAPService();
        var records = service.GetMyExportRecords(this.Emp_NO, systemId);

        if (records != null && records.Count > 0)
        {
            return Json(new
            {
                success = true,
                records = records
            }, JsonRequestBehavior.AllowGet);
        }
        else
        {
            return Json(new
            {
                success = false,
                message = "ç›®å‰æ²’æœ‰åŒ¯å‡ºè¨˜éŒ„"
            }, JsonRequestBehavior.AllowGet);
        }
    }
    catch (Exception ex)
    {
        return Json(new
        {
            success = false,
            message = $"æŸ¥è©¢å¤±æ•—: {ex.Message}"
        }, JsonRequestBehavior.AllowGet);
    }
}

#endregion
```

-----

### 2. Factory - F_AP.cs (æŸ¥è©¢è¦åŒ…å« CODE_GUARD)

```csharp
/// <summary>
/// å–å¾—å€‹äººåŒ¯å‡ºè¨˜éŒ„(æœ€è¿‘3å€‹æœˆ) - åŒ…å«æˆæ¬Šç¢¼
/// </summary>
public List<ExportRecordViewModel> GetMyExportRecords(string creator, string systemId)
{
    try
    {
        string sql = @"
            SELECT 
                [ID],
                [FILE_NAME],
                [CODE_GUARD],
                [CREATOR],
                CONVERT(varchar, [CREATE_TIME], 120) as CREATE_TIME,
                ISNULL([SYS_ID], '') as SYS_ID
            FROM [HI_TMMAIN].[dbo].[CODEGUARD_RECORD]
            WHERE [CREATOR] = @CREATOR
              AND ([SYS_ID] = @SYS_ID OR @SYS_ID IS NULL)
              AND [CREATE_TIME] >= DATEADD(MONTH, -3, GETDATE())
            ORDER BY [CREATE_TIME] DESC
        ";

        List<SqlParameter> parameters = new List<SqlParameter>
        {
            new SqlParameter("@CREATOR", creator ?? (object)DBNull.Value),
            new SqlParameter("@SYS_ID", string.IsNullOrEmpty(systemId) ? (object)DBNull.Value : systemId)
        };

        DataTable dt = SVS_DBmanager.QueryBySQL(sql, parameters);
        return SVS_DBmanager.ConvertToList<ExportRecordViewModel>(dt);
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine($"æŸ¥è©¢åŒ¯å‡ºè¨˜éŒ„å¤±æ•—: {ex.Message}");
        return new List<ExportRecordViewModel>();
    }
}
```

-----

### 3. Model - ExportRecordViewModel (è¦æœ‰ CODE_GUARD)

```csharp
/// <summary>
/// åŒ¯å‡ºè¨˜éŒ„é¡¯ç¤ºæ¨¡å‹
/// </summary>
public class ExportRecordViewModel
{
    public int ID { get; set; }
    public string FILE_NAME { get; set; }
    public string CODE_GUARD { get; set; }  // â­ æˆæ¬Šç¢¼æ¬„ä½
    public string CREATOR { get; set; }
    public string CREATE_TIME { get; set; }
    public string SYS_ID { get; set; }
}
```

-----

### 4. View - GroupManagement.cshtml (å®Œæ•´ç‰ˆ)

```html
<!-- æˆæ¬Šç¢¼é¡¯ç¤º Modal -->
<div class="modal fade" id="authCodeModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-gradient-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-key"></i> Excel æª”æ¡ˆæˆæ¬Šç¢¼
                </h5>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <p class="mb-1"><strong>æª”æ¡ˆåç¨±:</strong></p>
                    <p class="text-muted small" id="displayFileName"></p>
                </div>
                
                <div class="alert alert-warning text-center mb-3">
                    <i class="fas fa-lock"></i>
                    <strong>æª”æ¡ˆå·²åŠ å¯†,è«‹ä½¿ç”¨ä»¥ä¸‹æˆæ¬Šç¢¼é–‹å•Ÿ:</strong>
                </div>
                
                <div class="auth-code-container">
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="auth-code-box">
                            <span id="displayAuthCode" class="auth-code-text"></span>
                        </div>
                        <button type="button" class="btn btn-outline-primary ml-3" id="btnCopyAuthCode">
                            <i class="fas fa-copy"></i> è¤‡è£½
                        </button>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <small>
                        <i class="fas fa-info-circle"></i> 
                        è«‹å¦¥å–„ä¿ç®¡æ­¤æˆæ¬Šç¢¼,éºå¤±å°‡ç„¡æ³•é–‹å•Ÿæª”æ¡ˆ!
                    </small>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times"></i> é—œé–‰
                </button>
            </div>
        </div>
    </div>
</div>

<!-- åŒ¯å‡ºè¨˜éŒ„ Modal -->
<div class="modal fade" id="exportRecordsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-gradient-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-history"></i> åŒ¯å‡ºè¨˜éŒ„ (æœ€è¿‘3å€‹æœˆ)
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" id="exportRecordsContent">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>è¼‰å…¥ä¸­...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times"></i> é—œé–‰
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    $(document).ready(function() {
        
        // ========================================
        // åŒ¯å‡ºå¸³è™Ÿæ¸…å–®
        // ========================================
        $('#btnExportUsers').click(function () {
            // ç›´æ¥é–‹å§‹ä¸‹è¼‰
            var downloadUrl = '@Url.Action("ExportUserList", "AP")';
            
            // å»ºç«‹éš±è—çš„ iframe ä¾†ä¸‹è¼‰æª”æ¡ˆ
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = downloadUrl;
            document.body.appendChild(iframe);
            
            // å»¶é²é¡¯ç¤ºæˆæ¬Šç¢¼ Modal
            setTimeout(function() {
                checkAndShowAuthCode();
            }, 1000);
        });

        // ========================================
        // æª¢æŸ¥ä¸¦é¡¯ç¤ºæˆæ¬Šç¢¼
        // ========================================
        function checkAndShowAuthCode() {
            $.ajax({
                url: '@Url.Action("GetAuthCodeInfo", "AP")',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        $('#displayAuthCode').text(response.authCode);
                        $('#displayFileName').text(response.fileName + '.xlsx');
                        $('#authCodeModal').modal('show');
                    }
                },
                error: function() {
                    console.log('ç„¡æ³•å–å¾—æˆæ¬Šç¢¼è³‡è¨Š');
                }
            });
        }

        // ========================================
        // è¤‡è£½æˆæ¬Šç¢¼
        // ========================================
        $('#btnCopyAuthCode').click(function() {
            var authCode = $('#displayAuthCode').text();
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(authCode).then(function() {
                    showCopySuccess();
                }).catch(function() {
                    fallbackCopy(authCode);
                });
            } else {
                fallbackCopy(authCode);
            }
        });

        function showCopySuccess() {
            var btn = $('#btnCopyAuthCode');
            var originalHtml = btn.html();
            btn.html('<i class="fas fa-check"></i> å·²è¤‡è£½!');
            btn.removeClass('btn-outline-primary').addClass('btn-success');
            
            setTimeout(function() {
                btn.html(originalHtml);
                btn.removeClass('btn-success').addClass('btn-outline-primary');
            }, 2000);
        }

        function fallbackCopy(text) {
            var $temp = $('<textarea>');
            $('body').append($temp);
            $temp.val(text).select();
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                alert('è¤‡è£½å¤±æ•—,è«‹æ‰‹å‹•è¤‡è£½æˆæ¬Šç¢¼');
            }
            $temp.remove();
        }

        // ========================================
        // æŸ¥çœ‹åŒ¯å‡ºè¨˜éŒ„
        // ========================================
        $('#btnExportRecords').click(function () {
            $('#exportRecordsModal').modal('show');
            loadExportRecords();
        });

        function loadExportRecords() {
            $.ajax({
                url: '@Url.Action("GetExportRecords", "AP")',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        displayRecords(response.records);
                    } else {
                        $('#exportRecordsContent').html(
                            '<div class="alert alert-warning text-center">' +
                            '<i class="fas fa-exclamation-triangle"></i> ' +
                            response.message +
                            '</div>'
                        );
                    }
                },
                error: function() {
                    $('#exportRecordsContent').html(
                        '<div class="alert alert-danger text-center">' +
                        '<i class="fas fa-times-circle"></i> è¼‰å…¥å¤±æ•—' +
                        '</div>'
                    );
                }
            });
        }

        function displayRecords(records) {
            if (records && records.length > 0) {
                var html = '<div class="table-responsive">' +
                           '<table class="table table-striped table-hover mb-0">' +
                           '<thead class="thead-light">' +
                           '<tr>' +
                           '<th class="text-center" style="width: 5%;">åºè™Ÿ</th>' +
                           '<th style="width: 30%;">æª”æ¡ˆåç¨±</th>' +
                           '<th class="text-center" style="width: 15%;">æˆæ¬Šç¢¼</th>' +
                           '<th class="text-center" style="width: 10%;">ç³»çµ±ID</th>' +
                           '<th class="text-center" style="width: 12%;">åŒ¯å‡ºäººå“¡</th>' +
                           '<th class="text-center" style="width: 18%;">åŒ¯å‡ºæ™‚é–“</th>' +
                           '<th class="text-center" style="width: 10%;">æ“ä½œ</th>' +
                           '</tr>' +
                           '</thead>' +
                           '<tbody>';
                
                for (var i = 0; i < records.length; i++) {
                    html += '<tr>' +
                            '<td class="text-center">' + (i + 1) + '</td>' +
                            '<td><i class="fas fa-file-excel text-success"></i> ' + records[i].FILE_NAME + '.xlsx</td>' +
                            '<td class="text-center"><code class="auth-code-small">' + records[i].CODE_GUARD + '</code></td>' +
                            '<td class="text-center"><span class="badge badge-primary">' + records[i].SYS_ID + '</span></td>' +
                            '<td class="text-center">' + records[i].CREATOR + '</td>' +
                            '<td class="text-center">' + records[i].CREATE_TIME + '</td>' +
                            '<td class="text-center">' +
                            '<button class="btn btn-sm btn-outline-primary btn-copy-code" data-code="' + records[i].CODE_GUARD + '" title="è¤‡è£½æˆæ¬Šç¢¼">' +
                            '<i class="fas fa-copy"></i> è¤‡è£½' +
                            '</button>' +
                            '</td>' +
                            '</tr>';
                }
                
                html += '</tbody></table></div>';
                $('#exportRecordsContent').html(html);
                
                // ç¶å®šè¤‡è£½æŒ‰éˆ•äº‹ä»¶
                $('.btn-copy-code').click(function() {
                    var code = $(this).data('code');
                    copyCodeFromTable(code, $(this));
                });
            } else {
                $('#exportRecordsContent').html(
                    '<div class="alert alert-info text-center py-5">' +
                    '<i class="fas fa-inbox fa-3x mb-3 d-block"></i>' +
                    '<h5>ç›®å‰æ²’æœ‰åŒ¯å‡ºè¨˜éŒ„</h5>' +
                    '<p class="text-muted mb-0">æœ€è¿‘ 3 å€‹æœˆå…§æ²’æœ‰åŒ¯å‡ºå¸³è™Ÿæ¸…å–®çš„è¨˜éŒ„</p>' +
                    '</div>'
                );
            }
        }

        function copyCodeFromTable(code, btn) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(code).then(function() {
                    var originalHtml = btn.html();
                    btn.html('<i class="fas fa-check"></i> å·²è¤‡è£½');
                    btn.removeClass('btn-outline-primary').addClass('btn-success');
                    
                    setTimeout(function() {
                        btn.html(originalHtml);
                        btn.removeClass('btn-success').addClass('btn-outline-primary');
                    }, 1500);
                });
            } else {
                var $temp = $('<textarea>');
                $('body').append($temp);
                $temp.val(code).select();
                try {
                    document.execCommand('copy');
                    var originalHtml = btn.html();
                    btn.html('<i class="fas fa-check"></i> å·²è¤‡è£½');
                    btn.removeClass('btn-outline-primary').addClass('btn-success');
                    setTimeout(function() {
                        btn.html(originalHtml);
                        btn.removeClass('btn-success').addClass('btn-outline-primary');
                    }, 1500);
                } catch (err) {
                    alert('è¤‡è£½å¤±æ•—');
                }
                $temp.remove();
            }
        }
    });
</script>

<style>
    /* æˆæ¬Šç¢¼é¡¯ç¤ºæ¡† */
    .auth-code-container {
        padding: 20px 0;
    }
    
    .auth-code-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        display: inline-block;
    }
    
    .auth-code-text {
        font-family: 'Courier New', monospace;
        font-size: 28px;
        font-weight: bold;
        letter-spacing: 4px;
        color: #ffffff;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        user-select: all;
    }
    
    .auth-code-small {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        font-weight: bold;
        letter-spacing: 1px;
        background-color: #f8f9fa;
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        color: #495057;
    }
    
    /* Modal æ¨£å¼ */
    .bg-gradient-primary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    }
    
    .bg-gradient-info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
    }
    
    /* è¡¨æ ¼æ¨£å¼ */
    .table-responsive {
        max-height: 500px;
        overflow-y: auto;
    }
    
    .table thead th {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 10;
        border-bottom: 2px solid #dee2e6;
    }
    
    .table tbody tr:hover {
        background-color: #f1f3f5;
    }
</style>
}
```

-----

## ğŸ¯ å®Œæ•´æµç¨‹èªªæ˜

### 1. **ç”¢ç”Ÿæˆæ¬Šç¢¼**

```csharp
// Controller ä¸­
string authCode = codeResult.Code.ToString();  // ä¾‹å¦‚: "A99F24F2"
```

### 2. **æˆæ¬Šç¢¼ä½œç‚º Excel å¯†ç¢¼**

```csharp
// CreateEncryptedExcelWithEPPlus æ–¹æ³•ä¸­
package.Encryption.Password = password;  // password = "A99F24F2"
```

### 3. **å„²å­˜è¨˜éŒ„åˆ°è³‡æ–™åº«**

```csharp
var recordModel = new CodeGuardRecordModel
{
    FILE_NAME = fileName,
    CODE_GUARD = authCode,  // å„²å­˜æˆæ¬Šç¢¼
    CREATOR = this.Emp_NO,
    SYS_ID = systemId
};
```

### 4. **é¡¯ç¤ºæˆæ¬Šç¢¼çµ¦ä½¿ç”¨è€…**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”‘ Excel æª”æ¡ˆæˆæ¬Šç¢¼            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æª”æ¡ˆåç¨±:                      â”‚
â”‚ 20251125120000_åŒ¯å‡ºå¸³è™Ÿæ¸…å–®.xlsxâ”‚
â”‚                                â”‚
â”‚ âš ï¸ æª”æ¡ˆå·²åŠ å¯†,è«‹ä½¿ç”¨ä»¥ä¸‹æˆæ¬Šç¢¼é–‹å•Ÿâ”‚
â”‚                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ â”‚ A99F24F2 â”‚ [è¤‡è£½]            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                â”‚
â”‚ â„¹ï¸ è«‹å¦¥å–„ä¿ç®¡æ­¤æˆæ¬Šç¢¼!          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. **ä½¿ç”¨è€…é–‹å•Ÿ Excel**

1. é›™æ“Š Excel æª”æ¡ˆ
1. Excel æç¤º:ã€Œæ­¤æª”æ¡ˆå—å¯†ç¢¼ä¿è­·ã€
1. è¼¸å…¥æˆæ¬Šç¢¼:ã€ŒA99F24F2ã€
1. æˆåŠŸé–‹å•Ÿæª”æ¡ˆ

### 6. **æŸ¥çœ‹æ­·å²è¨˜éŒ„**

```
åºè™Ÿ | æª”æ¡ˆåç¨±              | æˆæ¬Šç¢¼   | ç³»çµ±ID | åŒ¯å‡ºäººå“¡ | åŒ¯å‡ºæ™‚é–“        | æ“ä½œ
â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
 1   | ğŸ“Š 20251125_åŒ¯å‡º.xlsx | A99F24F2 | HI_POS | E001    | 2024-11-25 12:00| [è¤‡è£½]
```

-----

## âœ… é—œéµè¦é»

1. **æˆæ¬Šç¢¼ = Excel å¯†ç¢¼**
   
   ```csharp
   package.Encryption.Password = authCode;  // ç›´æ¥ä½¿ç”¨æˆæ¬Šç¢¼
   ```
1. **EPPlus å…è²»æˆæ¬Šè¨­å®š**
   
   ```csharp
   ExcelPackage.LicenseContext = LicenseContext.NonCommercial;
   ```
1. **æˆæ¬Šç¢¼å„²å­˜åˆ°è³‡æ–™åº«**

- å¯ä»¥æŸ¥è©¢æ­·å²è¨˜éŒ„
- å¯ä»¥é‡æ–°è¤‡è£½æˆæ¬Šç¢¼

1. **çœŸæ­£çš„æª”æ¡ˆåŠ å¯†**

- âœ… é–‹å•Ÿæª”æ¡ˆéœ€è¦å¯†ç¢¼
- âœ… ç„¡æ³•ç›´æ¥æŸ¥çœ‹å…§å®¹
- âœ… è¤‡è£½æª”æ¡ˆä¹Ÿéœ€è¦å¯†ç¢¼

-----

å®Œæˆ! ğŸ‰ ç¾åœ¨æˆæ¬Šç¢¼å°±æ˜¯ Excel çš„é–‹å•Ÿå¯†ç¢¼äº†!â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹