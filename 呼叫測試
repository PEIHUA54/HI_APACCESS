å¤ªå¥½äº† ğŸ‘Œ ä½ çµ¦çš„ åŠŸèƒ½ 6 æ¸¬è©¦ç¨‹å¼ å¾ˆæ¸…æ¥šï¼Œæˆ‘å¹«ä½ ç”¨ä¸€æ¨£çš„å¯«æ³•åšä¸€å€‹ åŠŸèƒ½ 1 (GetUserNameAndGroup) çš„æ¸¬è©¦æ–¹æ³•ã€‚

â¸»

ğŸ“Œ Controller æ¸¬è©¦æ–¹æ³•ï¼ˆåŠŸèƒ½ 1ï¼‰

using POSFILE_APPLY.Factory;
using POSFILE_APPLY.Service;
using System;
using System.Web.Mvc;
using HI_APACCESS_DLL_FRAMEWORK;
using Newtonsoft.Json; // DLL åƒè€ƒ

namespace POSFILE_APPLY.Controllers
{
    public class APController : POSFILE_APPLYBaseController
    {
        // åŠŸèƒ½1 æ¸¬è©¦ï¼šå–å¾—ä½¿ç”¨è€…ç¾¤çµ„èˆ‡åç¨±
        public ActionResult AP_ACCESS_USERINFO()
        {
            try
            {
                // æ¸¬è©¦åƒæ•¸
                var req_para = new POSFILE_APPLY.Models.M_AP.GetUserNameAndGroupRequestModel()
                {
                    sys_id = "HI_POSIMG",    // ç³»çµ±ID
                    user_ad = "3A001",       // ä½¿ç”¨è€…ADå¸³è™Ÿ
                    environment = "TEST"     // ç’°å¢ƒ
                };

                // è½‰æˆ JSONï¼Œå‘¼å« DLL
                string json_input = JsonConvert.SerializeObject(req_para);
                string response = new HI_APACCESS_DLL_FRAMEWORK.APACCESS().GetUserNameAndGroup(json_input);

                // è½‰æˆ Response Model
                var response_ = JsonConvert.DeserializeObject<POSFILE_APPLY.Models.M_AP.GetUserNameAndGroupResponseModel>(response);

                if (response_.code == "0000")
                {
                    // æ¸¬è©¦æ™‚ç›´æ¥é¡¯ç¤ºåœ¨ç¶²é ä¸Š
                    string script = $@"
                    <script>
                        alert('ä½¿ç”¨è€…è³‡è¨Šå–å¾—æˆåŠŸ\n\n' +
                              'UserID: {response_.result.UserID}\n' +
                              'UserName: {response_.result.UserName}\n' +
                              'GroupID: {response_.result.GroupID}\n' +
                              'GroupName: {response_.result.GroupName}\n' +
                              'ParentGroupID: {string.Join(",", response_.result.ParentGroupID)}\n' +
                              'ChildGroupID: {string.Join(",", response_.result.ChildGroupID)}\n' +
                              'SensitiveDataAccess: {response_.result.SensitiveDataAccess}\n' +
                              'OrganName: {response_.result.OrganName}\n' +
                              'PostName: {response_.result.PostName}');
                        window.location.href='{Url.Action("Main", "Home")}';
                    </script>";
                    return Content(script, "text/html");
                }
                else
                {
                    return Content($"<script>alert('å–å¾—ä½¿ç”¨è€…è³‡è¨Šå¤±æ•—ï¼š{response_.message}');</script>", "text/html");
                }
            }
            catch (Exception ex)
            {
                return Content($"<script>alert('å‘¼å«ä½¿ç”¨è€…è³‡è¨ŠAPIéŒ¯èª¤ï¼š{ex.Message}');</script>", "text/html");
            }
        }
    }
}


â¸»

ğŸ“Œ æ¸¬è©¦ç”¨ Modelï¼ˆPOSFILE_APPLY.Models.M_APï¼‰

åœ¨ M_AP è£¡åŠ ä¸ŠåŠŸèƒ½ 1 å°ˆç”¨çš„ Request/Response æ¨¡å‹ï¼š

namespace POSFILE_APPLY.Models
{
    public class M_AP
    {
        // ===== åŠŸèƒ½6 å·²æœ‰ =====
        public class GetUrlRequsetModel
        {
            public string sys_id { get; set; }
            public string type { get; set; }
            public string environment { get; set; }
        }

        public class GetUrlResponseModel
        {
            public string code { get; set; }
            public string message { get; set; }
            public string url { get; set; }
        }

        // ===== åŠŸèƒ½1 æ–°å¢ =====
        public class GetUserNameAndGroupRequestModel
        {
            public string sys_id { get; set; }
            public string user_ad { get; set; }
            public string environment { get; set; }
        }

        public class GetUserNameAndGroupResponseModel
        {
            public string code { get; set; }
            public string message { get; set; }
            public ResultData result { get; set; }

            public class ResultData
            {
                public string UserID { get; set; }
                public string UserName { get; set; }
                public string GroupID { get; set; }
                public string GroupName { get; set; }
                public List<string> ParentGroupID { get; set; }
                public List<string> ChildGroupID { get; set; }
                public bool SensitiveDataAccess { get; set; }
                public string OrganName { get; set; }
                public string PostName { get; set; }
            }
        }
    }
}


â¸»

âœ… æ¸¬è©¦çµæœï¼ˆé æœŸï¼‰

å‡è¨­ 3A001 åœ¨ HI_POSIMG ç³»çµ±çš„ç¾¤çµ„æ˜¯ã€Œ001 ç®¡ç†å“¡ã€ï¼š
å‘¼å« AP_ACCESS_USERINFO Action å¾Œï¼Œæ‡‰è©²è·³å‡º alert é¡¯ç¤ºï¼š

UserID: 3A001
UserName: ç‹å°æ˜
GroupID: 001
GroupName: ç®¡ç†å“¡(è³‡è¨Š)
ParentGroupID: 003,002
ChildGroupID: 004,005
SensitiveDataAccess: False
OrganName: ç¨‹å¼èª²
PostName: é«˜ç´šå°ˆå“¡


â¸»

è¦ä¸è¦æˆ‘å¹«ä½ æ¥è‘—æŠŠ åŠŸèƒ½ 2 (GetGroupAllUser) çš„æ¸¬è©¦ç”¨æ–¹æ³• ä¹Ÿå¯«å¥½ï¼ˆController + Modelï¼‰ï¼Ÿ