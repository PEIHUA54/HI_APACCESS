Request_ 取到的是字串{sys_id=hi_posimg,type=1,environment=test}
要解析取sys_id、type、environment (model)
然後再傳回字串結果
{
code=0000
message=成功
url:"http://10.8.254.68/HI_APACCESS_TEST/Home/TokenEntry_FUNC?token=123
}

HI_APACCESS_DLL_FRAMEWORK
要改成以下寫法
// 取得功能連結
  public string GetFunctionAndAccessUrl(string Request_)
  {
      var response = new GetFunctionAndAccessUrlResponse();
      try
      {
              
          GetFunctionAndAccessUrlRequest request = JsonConvert.DeserializeObject<GetFunctionAndAccessUrlRequest>(Request_);
          // 檢查類型是否正確
          if (!TypeActions.ContainsKey(request.type))
          {
              response = new GetFunctionAndAccessUrlResponse
              {
                  code = "1002",
                  message = "類型錯誤，只接受 1 或 2",
                  url = ""
              };
              return JsonConvert.SerializeObject(response);
          }

          // 檢查環境是否正確
          if (!EnvironmentUrls.ContainsKey(request.environment))
          {
              response = new GetFunctionAndAccessUrlResponse
              {
                  code = "1003",
                  message = "環境錯誤，只接受 TEST、PROD",
                  url = ""
              };
              return JsonConvert.SerializeObject(response);
          }

          // 檢查系統權限
          if (!AuthorizedSystems.Contains(request.sys_id))
          {
              response  = new GetFunctionAndAccessUrlResponse
              {
                 code = "0001",
                  message = "查無權限",
                  url = ""
              }; 
              return JsonConvert.SerializeObject(response);
          }

          // 產 JWT Token
          string token = GenerateJwtToken(request.sys_id);

          // 組合最終 URL（含 Token）
          string baseUrl = EnvironmentUrls[request.environment];
          string action = TypeActions[request.type];
          string finalUrl = $"{baseUrl}/Home/{action}?token={token}";

          // 回傳成功結果
          response = new GetFunctionAndAccessUrlResponse
          {
              code = "0000",
              message = "成功",
              url = finalUrl
          };
          return JsonConvert.SerializeObject(response);
      }
      catch (Exception ex)
      {
          response = new GetFunctionAndAccessUrlResponse
          {
              code = "####",
              message = "系統錯誤：" + ex.Message,
              url = ""
          };
          return JsonConvert.SerializeObject(response);
      }
  }

呼叫dll寫法
public ActionResult AP_ACCESS_SYS()
{
     try

     {
         var req_para = new GetUrlRequsetModel()
         {
             sys_id = "HI_APLOG",
             environment="TEST",
             type = "2"
         };
         string json_input = JsonConvert.SerializeObject(req_para);
         string response = new AccessUrlService().GetFunctionAndAccessUrl(json_input);
         GetUrlResponseModel response_ = JsonConvert.DeserializeObject<GetUrlResponseModel>(response);
         string script = $@"
             <script>
                window.open('{response_.url}', '_blank');                       
                      
             </script>";
         return Content(script, "text/html");
     }
     catch (Exception ex)
     {
         return Content($"<script>alert('導向權限管理系統發生錯誤：{ex.Message}');</script>", "text/html");
     }
}
然後
     // 授權系統清單 
     private readonly HashSet<string> AuthorizedSystems = new HashSet<string>
       {
            "HI_POS" , "HI_POSIMG" , "POS_LOG"
       };
用資料表
/****** Script for SelectTopNRows command from SSMS  ******/
SELECT [SYS_ID]
      ,[SYS_NAME]
      ,[CREATE_TIME]
      ,[CREATOR]
      ,[EDIT_TIME]
      ,[EDITOR]
  FROM [HI_TMMAIN].[dbo].[AP_SYS]
取系統ID做授權系統清單
要寫到SQL語法
要用
       var service = GetAPService();  //去F_AB方法區取得SQL
       var result = service.授權系統清單(model, Emp_NO);
舉例
  // 根據群組編號取得群組名稱
  public GroupModel GetGroupByNo(string apg_no)
  {
      string sql = @"
      SELECT [SYS_ID], [APG_NO], [APG_NAME],[PARENT_APG_NO],  [CREATOR], [CREATE_TIME], [EDITOR], [EDIT_TIME]
      FROM [HI_TMMAIN].[dbo].[AP_GROUP] 
      WHERE [SYS_ID] = @SYS_ID AND [APG_NO] = @APG_NO"; 

      List<SqlParameter> parameters = new List<SqlParameter>
      {
          new SqlParameter("@SYS_ID", _sysId),
          new SqlParameter("@APG_NO", apg_no)
      };

      DataTable dt = SVS_DBmanager.QueryBySQL(sql, parameters);  //用QueryBySQL
      var groups = SVS_DBmanager.ConvertToList<GroupModel>(dt); //引用SVS_DBmanager
      return groups.FirstOrDefault();
  }
