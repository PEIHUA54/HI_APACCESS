
        // 導向群組管理
        [HttpPost]
        public JsonResult RedirectToGroupManagement(string sysId)
        {
            try
            {
                if (string.IsNullOrEmpty(sysId))
                {
                    return Json(new { success = false, message = "請選擇系統" });
                }

                // 更新Session
                Session["CurrentSystemId"] = sysId;
                Session["FromInternalSite"] = true;  // 從站台進來

                // 建立重導向 URL
                string redirectUrl = Url.Action("GroupManagement", "AP", new { systemId = sysId });

                // 驗證 URL
                if (!IsValidLocalUrl(redirectUrl))
                {
                    return Json(new { success = false, message = "無效的導向路徑" });
                }

                return Json(new { success = true, redirectUrl = redirectUrl });

                //return Json(new { success = true, redirectUrl = Url.Action("GroupManagement", "AP", new { systemId = sysId }) });
            }
            catch (Exception ex)
            {
                return Json(new { success = false, message = "導向失敗：" + ex.Message });
            }
        }



     // 導向群組管理
     function goToGroupManagement() {
         var sysId = $('#systemSelect').val();
         if (!sysId) {
             alert('請選擇系統');
             return;
         }

         $.ajax({
             url: '@Url.Action("RedirectToGroupManagement", "SYS")',
             type: 'POST',
             data: { sysId: sysId },
             dataType: 'json',
             success: function (response) {
                 if (response.success) {
                     window.location.href = response.redirectUrl;
                 } else {
                     alert(response.message);
                 }
             },
             error: function () {
                 alert('導向時發生錯誤');
             }
         });
     }
